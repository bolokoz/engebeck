/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{433:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return lr})),n.d(e,"b",(function(){return pr})),n.d(e,"c",(function(){return dr})),n.d(e,"d",(function(){return yr})),n.d(e,"e",(function(){return vr})),n.d(e,"f",(function(){return gr})),n.d(e,"g",(function(){return cr})),n.d(e,"h",(function(){return fr}));var r=function(t,b){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,b){t.__proto__=b}||function(t,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(t[p]=b[p])})(t,b)};function o(t){var s="function"==typeof Symbol&&Symbol.iterator,e=s&&t[s],i=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}var c,h="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},f=f||{},l=h||self;function d(){}function y(a){var b=typeof a;return"array"==(b="object"!=b?b:a?Array.isArray(a)?"array":b:"null")||"object"==b&&"number"==typeof a.length}function v(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}var m="closure_uid_"+(1e9*Math.random()>>>0),w=0;function E(a,b,t){return a.call.apply(a.bind,arguments)}function T(a,b,t){if(!a)throw Error();if(2<arguments.length){var e=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,e),a.apply(b,t)}}return function(){return a.apply(b,arguments)}}function p(a,b,t){return(p=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?E:T).apply(null,arguments)}function I(a,b){var t=Array.prototype.slice.call(arguments,1);return function(){var e=t.slice();return e.push.apply(e,arguments),a.apply(this,e)}}function q(){return Date.now()}function _(a,b){function t(){}t.prototype=b.prototype,a.X=b.prototype,a.prototype=new t,a.prototype.constructor=a,a.Kb=function(t,e,n){for(var g=Array(arguments.length-2),r=2;r<arguments.length;r++)g[r-2]=arguments[r];return b.prototype[e].apply(t,g)}}function O(){this.j=this.j,this.i=this.i}O.prototype.j=!1,O.prototype.ja=function(){if(!this.j&&(this.j=!0,this.G(),0))(function(a){Object.prototype.hasOwnProperty.call(a,m)&&a[m]||(a[m]=++w)})(this)},O.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var S=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if("string"==typeof a)return"string"!=typeof b||1!=b.length?-1:a.indexOf(b,0);for(var t=0;t<a.length;t++)if(t in a&&a[t]===b)return t;return-1},D=Array.prototype.forEach?function(a,b,t){Array.prototype.forEach.call(a,b,t)}:function(a,b,t){for(var e=a.length,n="string"==typeof a?a.split(""):a,r=0;r<e;r++)r in n&&b.call(t,n[r],r,a)};function A(a){return Array.prototype.concat.apply([],arguments)}function N(a){var b=a.length;if(0<b){for(var t=Array(b),e=0;e<b;e++)t[e]=a[e];return t}return[]}function C(a){return/^[\s\xa0]*$/.test(a)}var j,k=String.prototype.trim?function(a){return a.trim()}:function(a){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(a)[1]};function x(a,b){return-1!=a.indexOf(b)}function R(a,b){return a<b?-1:a>b?1:0}t:{var L=l.navigator;if(L){var P=L.userAgent;if(P){j=P;break t}}j=""}function M(a,b,t){for(var e in a)b.call(t,a[e],e,a)}function F(a){var b={};for(var t in a)b[t]=a[t];return b}var V="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function U(a,b){for(var t,e,n=1;n<arguments.length;n++){for(t in e=arguments[n])a[t]=e[t];for(var r=0;r<V.length;r++)t=V[r],Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=e[t])}}function B(a){return B[" "](a),a}B[" "]=d;var K,a,G=x(j,"Opera"),z=x(j,"Trident")||x(j,"MSIE"),Q=x(j,"Edge"),H=Q||z,W=x(j,"Gecko")&&!(x(j.toLowerCase(),"webkit")&&!x(j,"Edge"))&&!(x(j,"Trident")||x(j,"MSIE"))&&!x(j,"Edge"),Y=x(j.toLowerCase(),"webkit")&&!x(j,"Edge");function X(){var a=l.document;return a?a.documentMode:void 0}t:{var J="",$=(a=j,W?/rv:([^\);]+)(\)|;)/.exec(a):Q?/Edge\/([\d\.]+)/.exec(a):z?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a):Y?/WebKit\/(\S+)/.exec(a):G?/(?:Version)[ \/]?(\S+)/.exec(a):void 0);if($&&(J=$?$[1]:""),z){var Z=X();if(null!=Z&&Z>parseFloat(J)){K=String(Z);break t}}K=J}var tt,et={};function nt(a){return function(a,b){var t=et;return Object.prototype.hasOwnProperty.call(t,a)?t[a]:t[a]=b(a)}(a,(function(){for(var b=0,t=k(String(K)).split("."),e=k(String(a)).split("."),g=Math.max(t.length,e.length),n=0;0==b&&n<g;n++){var r=t[n]||"",o=e[n]||"";do{if(r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],0==r[0].length&&0==o[0].length)break;b=R(0==r[1].length?0:parseInt(r[1],10),0==o[1].length?0:parseInt(o[1],10))||R(0==r[2].length,0==o[2].length)||R(r[2],o[2]),r=r[3],o=o[3]}while(0==b)}return 0<=b}))}if(l.document&&z){var it=X();tt=it||(parseInt(K,10)||void 0)}else tt=void 0;var ot=tt,st=!z||9<=Number(ot),at=z&&!nt("9"),ut=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{l.addEventListener("test",d,b),l.removeEventListener("test",d,b)}catch(t){}return a}();function ct(a,b){this.type=a,this.a=this.target=b,this.defaultPrevented=!1}function ht(a,b){if(ct.call(this,a?a.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,a){var t=this.type=a.type,e=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.a=b,b=a.relatedTarget){if(W){t:{try{B(b.nodeName);var n=!0;break t}catch(t){}n=!1}n||(b=null)}}else"mouseover"==t?b=a.fromElement:"mouseout"==t&&(b=a.toElement);this.relatedTarget=b,e?(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType="string"==typeof a.pointerType?a.pointerType:ft[a.pointerType]||"",this.c=a,a.defaultPrevented&&this.b()}}ct.prototype.b=function(){this.defaultPrevented=!0},_(ht,ct);var ft={2:"touch",3:"pen",4:"mouse"};ht.prototype.b=function(){ht.X.b.call(this);var a=this.c;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,at)try{(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)&&(a.keyCode=-1)}catch(t){}};var lt="closure_listenable_"+(1e6*Math.random()|0),pt=0;function yt(a,b,t,e,n){this.listener=a,this.proxy=null,this.src=b,this.type=t,this.capture=!!e,this.ca=n,this.key=++pt,this.Y=this.Z=!1}function vt(a){a.Y=!0,a.listener=null,a.proxy=null,a.src=null,a.ca=null}function gt(a){this.src=a,this.a={},this.b=0}function mt(a,b){var t=b.type;if(t in a.a){var e,n=a.a[t],r=S(n,b);(e=0<=r)&&Array.prototype.splice.call(n,r,1),e&&(vt(b),0==a.a[t].length&&(delete a.a[t],a.b--))}}function bt(a,b,t,e){for(var n=0;n<a.length;++n){var r=a[n];if(!r.Y&&r.listener==b&&r.capture==!!t&&r.ca==e)return n}return-1}gt.prototype.add=function(a,b,t,e,n){var r=a.toString();(a=this.a[r])||(a=this.a[r]=[],this.b++);var g=bt(a,b,e,n);return-1<g?(b=a[g],t||(b.Z=!1)):((b=new yt(b,this.src,r,!!e,n)).Z=t,a.push(b)),b};var wt="closure_lm_"+(1e6*Math.random()|0),Et={};function Tt(a,b,t,e,n){if(e&&e.once)return _t(a,b,t,e,n);if(Array.isArray(b)){for(var r=0;r<b.length;r++)Tt(a,b[r],t,e,n);return null}return t=kt(t),a&&a[lt]?a.va(b,t,v(e)?!!e.capture:!!e,n):It(a,b,t,!1,e,n)}function It(a,b,t,e,n,r){if(!b)throw Error("Invalid event type");var g=v(n)?!!n.capture:!!n;if(g&&!st)return null;var o=Ct(a);if(o||(a[wt]=o=new gt(a)),(t=o.add(b,t,e,g,r)).proxy)return t;if(e=function(){var a=Nt,b=st?function(t){return a.call(b.src,b.listener,t)}:function(t){if(!(t=a.call(b.src,b.listener,t)))return t};return b}(),t.proxy=e,e.src=a,e.listener=t,a.addEventListener)ut||(n=g),void 0===n&&(n=!1),a.addEventListener(b.toString(),e,n);else if(a.attachEvent)a.attachEvent(Dt(b.toString()),e);else{if(!a.addListener||!a.removeListener)throw Error("addEventListener and attachEvent are unavailable.");a.addListener(e)}return t}function _t(a,b,t,e,n){if(Array.isArray(b)){for(var r=0;r<b.length;r++)_t(a,b[r],t,e,n);return null}return t=kt(t),a&&a[lt]?a.wa(b,t,v(e)?!!e.capture:!!e,n):It(a,b,t,!0,e,n)}function Ot(a,b,t,e,n){if(Array.isArray(b))for(var r=0;r<b.length;r++)Ot(a,b[r],t,e,n);else e=v(e)?!!e.capture:!!e,t=kt(t),a&&a[lt]?(a=a.c,(b=String(b).toString())in a.a&&(-1<(t=bt(r=a.a[b],t,e,n))&&(vt(r[t]),Array.prototype.splice.call(r,t,1),0==r.length&&(delete a.a[b],a.b--)))):a&&(a=Ct(a))&&(b=a.a[b.toString()],a=-1,b&&(a=bt(b,t,e,n)),(t=-1<a?b[a]:null)&&St(t))}function St(a){if("number"!=typeof a&&a&&!a.Y){var b=a.src;if(b&&b[lt])mt(b.c,a);else{var t=a.type,e=a.proxy;b.removeEventListener?b.removeEventListener(t,e,a.capture):b.detachEvent?b.detachEvent(Dt(t),e):b.addListener&&b.removeListener&&b.removeListener(e),(t=Ct(b))?(mt(t,a),0==t.b&&(t.src=null,b[wt]=null)):vt(a)}}}function Dt(a){return a in Et?Et[a]:Et[a]="on"+a}function At(a,b){var t=a.listener,e=a.ca||a.src;return a.Z&&St(a),t.call(e,b)}function Nt(a,b){if(a.Y)return!0;if(!st){if(!b)t:{b=["window","event"];for(var t=l,e=0;e<b.length;e++)if(null==(t=t[b[e]])){b=null;break t}b=t}return At(a,b=new ht(b,this))}return At(a,new ht(b,this))}function Ct(a){return(a=a[wt])instanceof gt?a:null}var jt="__closure_events_fn_"+(1e9*Math.random()>>>0);function kt(a){return"function"==typeof a?a:(a[jt]||(a[jt]=function(b){return a.handleEvent(b)}),a[jt])}function xt(){O.call(this),this.c=new gt(this),this.J=this,this.C=null}function Rt(a,b){var t,e=a.C;if(e)for(t=[];e;e=e.C)t.push(e);if(a=a.J,e=b.type||b,"string"==typeof b)b=new ct(b,a);else if(b instanceof ct)b.target=b.target||a;else{var n=b;U(b=new ct(e,a),n)}if(n=!0,t)for(var r=t.length-1;0<=r;r--){var g=b.a=t[r];n=Lt(g,e,!0,b)&&n}if(n=Lt(g=b.a=a,e,!0,b)&&n,n=Lt(g,e,!1,b)&&n,t)for(r=0;r<t.length;r++)n=Lt(g=b.a=t[r],e,!1,b)&&n}function Lt(a,b,t,e){if(!(b=a.c.a[String(b)]))return!0;b=b.concat();for(var n=!0,r=0;r<b.length;++r){var g=b[r];if(g&&!g.Y&&g.capture==t){var o=g.listener,c=g.ca||g.src;g.Z&&mt(a.c,g),n=!1!==o.call(c,e)&&n}}return n&&!e.defaultPrevented}_(xt,O),xt.prototype[lt]=!0,(c=xt.prototype).addEventListener=function(a,b,t,e){Tt(this,a,b,t,e)},c.removeEventListener=function(a,b,t,e){Ot(this,a,b,t,e)},c.G=function(){if(xt.X.G.call(this),this.c){var t,a=this.c;for(t in a.a){for(var e=a.a[t],n=0;n<e.length;n++)vt(e[n]);delete a.a[t],a.b--}}this.C=null},c.va=function(a,b,t,e){return this.c.add(String(a),b,!1,t,e)},c.wa=function(a,b,t,e){return this.c.add(String(a),b,!0,t,e)};var Pt=l.JSON.stringify;function Mt(){this.b=this.a=null}var Ft,qt=new(function(){function t(a,b){this.c=a,this.f=b,this.b=0,this.a=null}return t.prototype.get=function(){var a;return 0<this.b?(this.b--,a=this.a,this.a=a.next,a.next=null):a=this.c(),a},t}())((function(){return new Ut}),(function(a){a.reset()}));function Vt(){var a=zt,b=null;return a.a&&(b=a.a,a.a=a.a.next,a.a||(a.b=null),b.next=null),b}function Ut(){this.next=this.b=this.a=null}function Bt(a){l.setTimeout((function(){throw a}),0)}function Kt(a,b){Ft||function(){var a=l.Promise.resolve(void 0);Ft=function(){a.then(Qt)}}(),Gt||(Ft(),Gt=!0),zt.add(a,b)}Mt.prototype.add=function(a,b){var t=qt.get();t.set(a,b),this.b?this.b.next=t:this.a=t,this.b=t},Ut.prototype.set=function(a,b){this.a=a,this.b=b,this.next=null},Ut.prototype.reset=function(){this.next=this.b=this.a=null};var Gt=!1,zt=new Mt;function Qt(){for(var a;a=Vt();){try{a.a.call(a.b)}catch(t){Bt(t)}var b=qt;b.f(a),100>b.b&&(b.b++,a.next=b.a,b.a=a)}Gt=!1}function Ht(a,b){xt.call(this),this.b=a||1,this.a=b||l,this.f=p(this.Za,this),this.g=q()}function Wt(a){a.aa=!1,a.M&&(a.a.clearTimeout(a.M),a.M=null)}function Yt(a,b,t){if("function"==typeof a)t&&(a=p(a,t));else{if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=p(a.handleEvent,a)}return 2147483647<Number(b)?-1:l.setTimeout(a,b||0)}function Xt(a){a.a=Yt((function(){a.a=null,a.c&&(a.c=!1,Xt(a))}),a.h);var b=a.b;a.b=null,a.g.apply(null,b)}_(Ht,xt),(c=Ht.prototype).aa=!1,c.M=null,c.Za=function(){if(this.aa){var a=q()-this.g;0<a&&a<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-a):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Rt(this,"tick"),this.aa&&(Wt(this),this.start()))}},c.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=q())},c.G=function(){Ht.X.G.call(this),Wt(this),delete this.a};var Jt=function(t){function e(a,b){var e=t.call(this)||this;return e.g=a,e.h=b,e.b=null,e.c=!1,e.a=null,e}return function(t,b){function e(){this.constructor=t}r(t,b),t.prototype=null===b?Object.create(b):(e.prototype=b.prototype,new e)}(e,t),e.prototype.f=function(a){this.b=arguments,this.a?this.c=!0:Xt(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(l.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(O);function $t(a){O.call(this),this.b=a,this.a={}}_($t,O);var Zt=[];function te(a,b,t,e){Array.isArray(t)||(t&&(Zt[0]=t.toString()),t=Zt);for(var n=0;n<t.length;n++){var r=Tt(b,t[n],e||a.handleEvent,!1,a.b||a);if(!r)break;a.a[r.key]=r}}function ee(a){M(a.a,(function(b,t){this.a.hasOwnProperty(t)&&St(b)}),a),a.a={}}function ne(){this.a=!0}function re(a,b,t,e){a.info((function(){return"XMLHTTP TEXT ("+b+"): "+function(a,b){if(!a.a)return b;if(!b)return null;try{var t=JSON.parse(b);if(t)for(a=0;a<t.length;a++)if(Array.isArray(t[a])){var e=t[a];if(!(2>e.length)){var n=e[1];if(Array.isArray(n)&&!(1>n.length)){var r=n[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var g=1;g<n.length;g++)n[g]=""}}}return Pt(t)}catch(t){return b}}(a,t)+(e?" "+e:"")}))}$t.prototype.G=function(){$t.X.G.call(this),ee(this)},$t.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ne.prototype.info=function(){};var ie={},oe=null;function se(){return oe=oe||new xt}function ae(a){ct.call(this,ie.Fa,a)}function ue(a){var b=se();Rt(b,new ae(b,a))}function ce(a,b){ct.call(this,ie.STAT_EVENT,a),this.stat=b}function he(a){var b=se();Rt(b,new ce(b,a))}function fe(a){ct.call(this,ie.Ga,a)}function le(a,b){if("function"!=typeof a)throw Error("Fn must not be null and must be a function");return l.setTimeout((function(){a()}),b)}ie.Fa="serverreachability",_(ae,ct),ie.STAT_EVENT="statevent",_(ce,ct),ie.Ga="timingevent",_(fe,ct);var de={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},pe={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function ye(){}function ve(a){var b;return(b=a.a)||(b=a.a={}),b}function ge(){}ye.prototype.a=null;var me,be={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function we(){ct.call(this,"d")}function Ee(){ct.call(this,"c")}function Te(){}function Ie(a,b,t,e){this.g=a,this.c=b,this.f=t,this.S=e||1,this.J=new $t(this),this.P=_e,a=H?125:void 0,this.R=new Ht(a),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}_(we,ct),_(Ee,ct),_(Te,ye),me=new Te;var _e=45e3,Oe={},Se={};function De(a,b,t){a.H=1,a.i=Ye(Ke(b)),a.j=t,a.I=!0,Ae(a,null)}function Ae(a,b){a.u=q(),je(a),a.l=Ke(a.i);var t=a.l,e=a.S;Array.isArray(e)||(e=[String(e)]),un(t.b,"t",e),a.D=0,a.a=nr(a.g,a.g.C?b:null),0<a.O&&(a.F=new Jt(p(a.Ca,a,a.a),a.O)),te(a.J,a.a,"readystatechange",a.Xa),b=a.B?F(a.B):{},a.j?(a.m||(a.m="POST"),b["Content-Type"]="application/x-www-form-urlencoded",a.a.ba(a.l,a.m,a.j,b)):(a.m="GET",a.a.ba(a.l,a.m,null,b)),ue(1),function(a,b,t,e,n,r){a.info((function(){if(a.a)if(r)for(var g="",o=r.split("&"),c=0;c<o.length;c++){var u=o[c].split("=");if(1<u.length){var h=u[0];u=u[1];var f=h.split("_");g=2<=f.length&&"type"==f[1]?g+(h+"=")+u+"&":g+(h+"=redacted&")}}else g=null;else g=r;return"XMLHTTP REQ ("+e+") [attempt "+n+"]: "+b+"\n"+t+"\n"+g}))}(a.c,a.m,a.l,a.f,a.S,a.j)}function Ne(a,b,t){for(var e=!0;!a.A&&a.D<t.length;){var n=Ce(a,t);if(n==Se){4==b&&(a.h=4,he(14),e=!1),re(a.c,a.f,null,"[Incomplete Response]");break}if(n==Oe){a.h=4,he(15),re(a.c,a.f,t,"[Invalid Chunk]"),e=!1;break}re(a.c,a.f,n,null),Pe(a,n)}4==b&&0==t.length&&(a.h=1,he(16),e=!1),a.b=a.b&&e,e?0<t.length&&!a.V&&(a.V=!0,(b=a.g).a==a&&b.U&&!b.F&&(b.c.info("Great, no buffering proxy detected. Bytes received: "+t.length),Hn(b),b.F=!0,he(11))):(re(a.c,a.f,t,"[Invalid Chunked Response]"),Le(a),Re(a))}function Ce(a,b){var t=a.D,e=b.indexOf("\n",t);return-1==e?Se:(t=Number(b.substring(t,e)),isNaN(t)?Oe:(e+=1)+t>b.length?Se:(b=b.substr(e,t),a.D=e+t,b))}function je(a){a.T=q()+a.P,ke(a,a.P)}function ke(a,b){if(null!=a.o)throw Error("WatchDog timer not null");a.o=le(p(a.Va,a),b)}function xe(a){a.o&&(l.clearTimeout(a.o),a.o=null)}function Re(a){0==a.g.v||a.A||Xn(a.g,a)}function Le(a){xe(a);var b=a.F;b&&"function"==typeof b.ja&&b.ja(),a.F=null,Wt(a.R),ee(a.J),a.a&&(b=a.a,a.a=null,b.abort(),b.ja())}function Pe(a,b){try{var t=a.g;if(0!=t.v&&(t.a==a||yn(t.b,a)))if(t.I=a.N,!a.C&&yn(t.b,a)&&3==t.v){try{var e=t.ka.a.parse(b)}catch(t){e=null}if(Array.isArray(e)&&3==e.length){var n=e;if(0==n[0]){t:if(!t.j){if(t.a){if(!(t.a.u+3e3<a.u))break t;Yn(t),Fn(t)}Qn(t),he(18)}}else t.oa=n[1],0<t.oa-t.P&&37500>n[2]&&t.H&&0==t.o&&!t.m&&(t.m=le(p(t.Sa,t),6e3));if(1>=pn(t.b)&&t.ea){try{t.ea()}catch(t){}t.ea=void 0}}else $n(t,11)}else if((a.C||t.a==a)&&Yn(t),!C(b))for(b=e=t.ka.a.parse(b),e=0;e<b.length;e++)if(n=b[e],t.P=n[0],n=n[1],2==t.v)if("c"==n[0]){t.J=n[1],t.ga=n[2];var r=n[3];null!=r&&(t.ha=r,t.c.info("VER="+t.ha));var g=n[4];null!=g&&(t.pa=g,t.c.info("SVER="+t.pa));var o=n[5];if(null!=o&&"number"==typeof o&&0<o){var c=1.5*o;t.D=c,t.c.info("backChannelRequestTimeoutMs_="+c)}c=t;var u=a.a;if(u){var h=u.a?u.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var f=c.b;!f.a&&(x(h,"spdy")||x(h,"quic")||x(h,"h2"))&&(f.f=f.g,f.a=new Set,f.b&&(vn(f,f.b),f.b=null))}if(c.A){var l=u.a?u.a.getResponseHeader("X-HTTP-Session-Id"):null;l&&(c.na=l,We(c.B,c.A,l))}}t.v=3,t.f&&t.f.ta(),t.U&&(t.N=q()-a.u,t.c.info("Handshake RTT: "+t.N+"ms"));var d=a;if((c=t).la=er(c,c.C?c.ga:null,c.fa),d.C){gn(c.b,d);var y=d,v=c.D;v&&y.setTimeout(v),y.o&&(xe(y),je(y)),c.a=d}else zn(c);0<t.g.length&&Un(t)}else"stop"!=n[0]&&"close"!=n[0]||$n(t,7);else 3==t.v&&("stop"==n[0]||"close"==n[0]?"stop"==n[0]?$n(t,7):Mn(t):"noop"!=n[0]&&t.f&&t.f.sa(n),t.o=0);ue(4)}catch(t){}}function Me(a,b){if(a.forEach&&"function"==typeof a.forEach)a.forEach(b,void 0);else if(y(a)||"string"==typeof a)D(a,b,void 0);else{if(a.L&&"function"==typeof a.L)var t=a.L();else if(a.K&&"function"==typeof a.K)t=void 0;else if(y(a)||"string"==typeof a){t=[];for(var e=a.length,n=0;n<e;n++)t.push(n)}else for(n in t=[],e=0,a)t[e++]=n;n=(e=function(a){if(a.K&&"function"==typeof a.K)return a.K();if("string"==typeof a)return a.split("");if(y(a)){for(var b=[],t=a.length,e=0;e<t;e++)b.push(a[e]);return b}for(e in b=[],t=0,a)b[t++]=a[e];return b}(a)).length;for(var r=0;r<n;r++)b.call(void 0,e[r],t&&t[r],a)}}function Fe(a,b){this.b={},this.a=[],this.c=0;var t=arguments.length;if(1<t){if(t%2)throw Error("Uneven number of arguments");for(var e=0;e<t;e+=2)this.set(arguments[e],arguments[e+1])}else if(a)if(a instanceof Fe)for(t=a.L(),e=0;e<t.length;e++)this.set(t[e],a.get(t[e]));else for(e in a)this.set(e,a[e])}function qe(a){if(a.c!=a.a.length){for(var b=0,t=0;b<a.a.length;){var e=a.a[b];Ve(a.b,e)&&(a.a[t++]=e),b++}a.a.length=t}if(a.c!=a.a.length){var n={};for(t=b=0;b<a.a.length;)Ve(n,e=a.a[b])||(a.a[t++]=e,n[e]=1),b++;a.a.length=t}}function Ve(a,b){return Object.prototype.hasOwnProperty.call(a,b)}(c=Ie.prototype).setTimeout=function(a){this.P=a},c.Xa=function(a){a=a.target;var b=this.F;b&&3==xn(a)?b.f():this.Ca(a)},c.Ca=function(a){try{if(a==this.a)t:{var b=xn(this.a),t=this.a.ua(),e=this.a.W();if(!(3>b||3==b&&!H&&!this.a.$())){this.A||4!=b||7==t||ue(8==t||0>=e?3:2),xe(this);var n=this.a.W();this.N=n;var r=this.a.$();if(this.b=200==n,function(a,b,t,e,n,r,g){a.info((function(){return"XMLHTTP RESP ("+e+") [ attempt "+n+"]: "+b+"\n"+t+"\n"+r+" "+g}))}(this.c,this.m,this.l,this.f,this.S,b,n),this.b){if(this.U&&!this.C){e:{if(this.a){var g,o=this.a;if((g=o.a?o.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!C(g)){var c=g;break e}}c=null}if(!c){this.b=!1,this.h=3,he(12),Le(this),Re(this);break t}re(this.c,this.f,c,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Pe(this,c)}this.I?(Ne(this,b,r),H&&this.b&&3==b&&(te(this.J,this.R,"tick",this.Wa),this.R.start())):(re(this.c,this.f,r,null),Pe(this,r)),4==b&&Le(this),this.b&&!this.A&&(4==b?Xn(this.g,this):(this.b=!1,je(this)))}else 400==n&&0<r.indexOf("Unknown SID")?(this.h=3,he(12)):(this.h=0,he(13)),Le(this),Re(this)}}}catch(t){}},c.Wa=function(){if(this.a){var a=xn(this.a),b=this.a.$();this.D<b.length&&(xe(this),Ne(this,a,b),this.b&&4!=a&&je(this))}},c.cancel=function(){this.A=!0,Le(this)},c.Va=function(){this.o=null;var a=q();0<=a-this.T?(function(a,b){a.info((function(){return"TIMEOUT: "+b}))}(this.c,this.l),2!=this.H&&(ue(3),he(17)),Le(this),this.h=2,Re(this)):ke(this,this.T-a)},(c=Fe.prototype).K=function(){qe(this);for(var a=[],b=0;b<this.a.length;b++)a.push(this.b[this.a[b]]);return a},c.L=function(){return qe(this),this.a.concat()},c.get=function(a,b){return Ve(this.b,a)?this.b[a]:b},c.set=function(a,b){Ve(this.b,a)||(this.c++,this.a.push(a)),this.b[a]=b},c.forEach=function(a,b){for(var t=this.L(),e=0;e<t.length;e++){var n=t[e],r=this.get(n);a.call(b,r,n,this)}};var Ue=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Be(a,b){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,a instanceof Be){this.a=void 0!==b?b:a.a,Ge(this,a.f),this.j=a.j,ze(this,a.c),Qe(this,a.h),this.g=a.g,b=a.b;var t=new rn;t.c=b.c,b.a&&(t.a=new Fe(b.a),t.b=b.b),He(this,t),this.i=a.i}else a&&(t=String(a).match(Ue))?(this.a=!!b,Ge(this,t[1]||"",!0),this.j=Xe(t[2]||""),ze(this,t[3]||"",!0),Qe(this,t[4]),this.g=Xe(t[5]||"",!0),He(this,t[6]||"",!0),this.i=Xe(t[7]||"")):(this.a=!!b,this.b=new rn(null,this.a))}function Ke(a){return new Be(a)}function Ge(a,b,t){a.f=t?Xe(b,!0):b,a.f&&(a.f=a.f.replace(/:$/,""))}function ze(a,b,t){a.c=t?Xe(b,!0):b}function Qe(a,b){if(b){if(b=Number(b),isNaN(b)||0>b)throw Error("Bad port number "+b);a.h=b}else a.h=null}function He(a,b,t){b instanceof rn?(a.b=b,function(a,b){b&&!a.f&&(on(a),a.c=null,a.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(sn(this,e),un(this,n,t))}),a)),a.f=b}(a.b,a.a)):(t||(b=Je(b,en)),a.b=new rn(b,a.a))}function We(a,b,t){a.b.set(b,t)}function Ye(a){return We(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^q()).toString(36)),a}function Xe(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function Je(a,b,t){return"string"==typeof a?(a=encodeURI(a).replace(b,dd),t&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function dd(a){return"%"+((a=a.charCodeAt(0))>>4&15).toString(16)+(15&a).toString(16)}Be.prototype.toString=function(){var a=[],b=this.f;b&&a.push(Je(b,$e,!0),":");var t=this.c;return(t||"file"==b)&&(a.push("//"),(b=this.j)&&a.push(Je(b,$e,!0),"@"),a.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.h)&&a.push(":",String(t))),(t=this.g)&&(this.c&&"/"!=t.charAt(0)&&a.push("/"),a.push(Je(t,"/"==t.charAt(0)?tn:Ze,!0))),(t=this.b.toString())&&a.push("?",t),(t=this.i)&&a.push("#",Je(t,nn)),a.join("")};var $e=/[#\/\?@]/g,Ze=/[#\?:]/g,tn=/[#\?]/g,en=/[#\?@]/g,nn=/#/g;function rn(a,b){this.b=this.a=null,this.c=a||null,this.f=!!b}function on(a){a.a||(a.a=new Fe,a.b=0,a.c&&function(a,b){if(a){a=a.split("&");for(var t=0;t<a.length;t++){var e=a[t].indexOf("="),n=null;if(0<=e){var r=a[t].substring(0,e);n=a[t].substring(e+1)}else r=a[t];b(r,n?decodeURIComponent(n.replace(/\+/g," ")):"")}}}(a.c,(function(b,t){a.add(decodeURIComponent(b.replace(/\+/g," ")),t)})))}function sn(a,b){on(a),b=cn(a,b),Ve(a.a.b,b)&&(a.c=null,a.b-=a.a.get(b).length,Ve((a=a.a).b,b)&&(delete a.b[b],a.c--,a.a.length>2*a.c&&qe(a)))}function an(a,b){return on(a),b=cn(a,b),Ve(a.a.b,b)}function un(a,b,t){sn(a,b),0<t.length&&(a.c=null,a.a.set(cn(a,b),N(t)),a.b+=t.length)}function cn(a,b){return b=String(b),a.f&&(b=b.toLowerCase()),b}(c=rn.prototype).add=function(a,b){on(this),this.c=null,a=cn(this,a);var t=this.a.get(a);return t||this.a.set(a,t=[]),t.push(b),this.b+=1,this},c.forEach=function(a,b){on(this),this.a.forEach((function(t,e){D(t,(function(t){a.call(b,t,e,this)}),this)}),this)},c.L=function(){on(this);for(var a=this.a.K(),b=this.a.L(),t=[],e=0;e<b.length;e++)for(var n=a[e],r=0;r<n.length;r++)t.push(b[e]);return t},c.K=function(a){on(this);var b=[];if("string"==typeof a)an(this,a)&&(b=A(b,this.a.get(cn(this,a))));else{a=this.a.K();for(var t=0;t<a.length;t++)b=A(b,a[t])}return b},c.set=function(a,b){return on(this),this.c=null,an(this,a=cn(this,a))&&(this.b-=this.a.get(a).length),this.a.set(a,[b]),this.b+=1,this},c.get=function(a,b){return a&&0<(a=this.K(a)).length?String(a[0]):b},c.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var a=[],b=this.a.L(),t=0;t<b.length;t++){var e=b[t],n=encodeURIComponent(String(e));e=this.K(e);for(var r=0;r<e.length;r++){var g=n;""!==e[r]&&(g+="="+encodeURIComponent(String(e[r]))),a.push(g)}}return this.c=a.join("&")};var hn=function(a,b){this.b=a,this.a=b};function fn(a){this.g=a||ln,l.PerformanceNavigationTiming?a=0<(a=l.performance.getEntriesByType("navigation")).length&&("hq"==a[0].nextHopProtocol||"h2"==a[0].nextHopProtocol):a=!!(l.ia&&l.ia.ya&&l.ia.ya()&&l.ia.ya().Lb),this.f=a?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var ln=10;function dn(a){return!!a.b||!!a.a&&a.a.size>=a.f}function pn(a){return a.b?1:a.a?a.a.size:0}function yn(a,b){return a.b?a.b==b:!!a.a&&a.a.has(b)}function vn(a,b){a.a?a.a.add(b):a.b=b}function gn(a,b){a.b&&a.b==b?a.b=null:a.a&&a.a.has(b)&&a.a.delete(b)}function mn(a){var t,e;if(null!=a.b)return a.c.concat(a.b.s);if(null!=a.a&&0!==a.a.size){var b=a.c;try{for(var n=o(a.a.values()),r=n.next();!r.done;r=n.next()){var c=r.value;b=b.concat(c.s)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return b}return N(a.c)}function bn(){}function wn(){this.a=new bn}function En(a,b,t){var e=t||"";try{Me(a,(function(t,n){var g=t;v(t)&&(g=Pt(t)),b.push(e+n+"="+encodeURIComponent(g))}))}catch(t){throw b.push(e+"type="+encodeURIComponent("_badmap")),t}}function Tn(a,b,t,e,n){try{b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null,n(e)}catch(t){}}fn.prototype.cancel=function(){var t,e;if(this.c=mn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=o(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},bn.prototype.stringify=function(a){return l.JSON.stringify(a,void 0)},bn.prototype.parse=function(a){return l.JSON.parse(a,void 0)};var In=l.JSON.parse;function _n(a){xt.call(this),this.headers=new Fe,this.H=a||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=On,this.D=this.F=!1}_(_n,xt);var On="",Sn=/^https?$/i,td=["POST","PUT"];function Dn(a){return"content-type"==a.toLowerCase()}function An(a,b){a.b=!1,a.a&&(a.g=!0,a.a.abort(),a.g=!1),a.f=b,a.h=5,Nn(a),jn(a)}function Nn(a){a.u||(a.u=!0,Rt(a,"complete"),Rt(a,"error"))}function Cn(a){if(a.b&&void 0!==f&&(!a.s[1]||4!=xn(a)||2!=a.W()))if(a.l&&4==xn(a))Yt(a.za,0,a);else if(Rt(a,"readystatechange"),4==xn(a)){a.b=!1;try{var t,e=a.W();t:switch(e){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var b=!0;break t;default:b=!1}if(!(t=b)){var n;if(n=0===e){var r=String(a.B).match(Ue)[1]||null;if(!r&&l.self&&l.self.location){var o=l.self.location.protocol;r=o.substr(0,o.length-1)}n=!Sn.test(r?r.toLowerCase():"")}t=n}if(t)Rt(a,"complete"),Rt(a,"success");else{a.h=6;try{var c=2<xn(a)?a.a.statusText:""}catch(e){c=""}a.f=c+" ["+a.W()+"]",Nn(a)}}finally{jn(a)}}}function jn(a,b){if(a.a){kn(a);var t=a.a,e=a.s[0]?d:null;a.a=null,a.s=null,b||Rt(a,"ready");try{t.onreadystatechange=e}catch(t){}}}function kn(a){a.a&&a.D&&(a.a.ontimeout=null),a.m&&(l.clearTimeout(a.m),a.m=null)}function xn(a){return a.a?a.a.readyState:0}function Rn(a,b,t){t:{for(e in t){var e=!1;break t}e=!0}e||(t=function(a){var b="";return M(a,(function(t,e){b+=e,b+=":",b+=t,b+="\r\n"})),b}(t),"string"==typeof a?null!=t&&encodeURIComponent(String(t)):We(a,b,t))}function Ln(a,b,t){return t&&t.internalChannelParams&&t.internalChannelParams[a]||b}function Pn(a){this.pa=0,this.g=[],this.c=new ne,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=Ln("failFast",!1,a),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=Ln("baseRetryDelayMs",5e3,a),this.Ra=Ln("retryDelaySeedMs",1e4,a),this.Ma=Ln("forwardChannelMaxRetries",2,a),this.ma=Ln("forwardChannelRequestTimeoutMs",2e4,a),this.Na=a&&a.g||void 0,this.D=void 0,this.C=a&&a.supportsCrossDomainXhr||!1,this.J="",this.b=new fn(a&&a.concurrentRequestLimit),this.ka=new wn,this.da=a&&a.fastHandshake||!1,this.Ia=a&&a.b||!1,a&&a.f&&(this.c.a=!1),a&&a.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&a&&a.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=a&&a.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function Mn(a){if(qn(a),3==a.v){var b=a.R++,t=Ke(a.B);We(t,"SID",a.J),We(t,"RID",b),We(t,"TYPE","terminate"),Kn(a,t),(b=new Ie(a,a.c,b,void 0)).H=2,b.i=Ye(Ke(t)),t=!1,l.navigator&&l.navigator.sendBeacon&&(t=l.navigator.sendBeacon(b.i.toString(),"")),!t&&l.Image&&((new Image).src=b.i,t=!0),t||(b.a=nr(b.g,null),b.a.ba(b.i)),b.u=q(),je(b)}Zn(a)}function Fn(a){a.a&&(Hn(a),a.a.cancel(),a.a=null)}function qn(a){Fn(a),a.j&&(l.clearTimeout(a.j),a.j=null),Yn(a),a.b.cancel(),a.h&&("number"==typeof a.h&&l.clearTimeout(a.h),a.h=null)}function Vn(a,b){a.g.push(new hn(a.Oa++,b)),3==a.v&&Un(a)}function Un(a){dn(a.b)||a.h||(a.h=!0,Kt(a.Ba,a),a.u=0)}function Bn(a,b){var t;t=b?b.f:a.R++;var e=Ke(a.B);We(e,"SID",a.J),We(e,"RID",t),We(e,"AID",a.P),Kn(a,e),a.i&&a.l&&Rn(e,a.i,a.l),t=new Ie(a,a.c,t,a.u+1),null===a.i&&(t.B=a.l),b&&(a.g=b.s.concat(a.g)),b=Gn(a,t,1e3),t.setTimeout(Math.round(.5*a.ma)+Math.round(.5*a.ma*Math.random())),vn(a.b,t),De(t,e,b)}function Kn(a,b){a.f&&Me({},(function(t,e){We(b,e,t)}))}function Gn(a,b,t){t=Math.min(a.g.length,t);var e=a.f?p(a.f.Ja,a.f,a):null;t:for(var n=a.g,r=-1;;){var g=["count="+t];-1==r?0<t?(r=n[0].b,g.push("ofs="+r)):r=0:g.push("ofs="+r);for(var o=!0,c=0;c<t;c++){var u=n[c].b,h=n[c].a;if(0>(u-=r))r=Math.max(0,n[c].b-100),o=!1;else try{En(h,g,"req"+u+"_")}catch(t){e&&e(h)}}if(o){e=g.join("&");break t}}return a=a.g.splice(0,t),b.s=a,e}function zn(a){a.a||a.j||(a.T=1,Kt(a.Aa,a),a.o=0)}function Qn(a){return!(a.a||a.j||3<=a.o)&&(a.T++,a.j=le(p(a.Aa,a),Jn(a,a.o)),a.o++,!0)}function Hn(a){null!=a.s&&(l.clearTimeout(a.s),a.s=null)}function Wn(a){a.a=new Ie(a,a.c,"rpc",a.T),null===a.i&&(a.a.B=a.l),a.a.O=0;var b=Ke(a.la);We(b,"RID","rpc"),We(b,"SID",a.J),We(b,"CI",a.H?"0":"1"),We(b,"AID",a.P),Kn(a,b),We(b,"TYPE","xmlhttp"),a.i&&a.l&&Rn(b,a.i,a.l),a.D&&a.a.setTimeout(a.D);var t=a.a;a=a.ga,t.H=1,t.i=Ye(Ke(b)),t.j=null,t.I=!0,Ae(t,a)}function Yn(a){null!=a.m&&(l.clearTimeout(a.m),a.m=null)}function Xn(a,b){var t=null;if(a.a==b){Yn(a),Hn(a),a.a=null;var e=2}else{if(!yn(a.b,b))return;t=b.s,gn(a.b,b),e=1}if(a.I=b.N,0!=a.v)if(b.b)if(1==e){t=b.j?b.j.length:0,b=q()-b.u;var n=a.u;Rt(e=se(),new fe(e,t,b,n)),Un(a)}else zn(a);else if(3==(n=b.h)||0==n&&0<a.I||!(1==e&&function(a,b){return!(pn(a.b)>=a.b.f-(a.h?1:0)||(a.h?(a.g=b.s.concat(a.g),0):1==a.v||2==a.v||a.u>=(a.La?0:a.Ma)||(a.h=le(p(a.Ba,a,b),Jn(a,a.u)),a.u++,0)))}(a,b)||2==e&&Qn(a)))switch(t&&0<t.length&&(b=a.b,b.c=b.c.concat(t)),n){case 1:$n(a,5);break;case 4:$n(a,10);break;case 3:$n(a,6);break;default:$n(a,2)}}function Jn(a,b){var t=a.Ha+Math.floor(Math.random()*a.Ra);return a.f||(t*=2),t*b}function $n(a,b){if(a.c.info("Error code "+b),2==b){var t=null;a.f&&(t=null);var e=p(a.Ya,a);t||(t=new Be("//www.google.com/images/cleardot.gif"),l.location&&"http"==l.location.protocol||Ge(t,"https"),Ye(t)),function(a,b){var t=new ne;if(l.Image){var e=new Image;e.onload=I(Tn,t,e,"TestLoadImage: loaded",!0,b),e.onerror=I(Tn,t,e,"TestLoadImage: error",!1,b),e.onabort=I(Tn,t,e,"TestLoadImage: abort",!1,b),e.ontimeout=I(Tn,t,e,"TestLoadImage: timeout",!1,b),l.setTimeout((function(){e.ontimeout&&e.ontimeout()}),1e4),e.src=a}else b(!1)}(t.toString(),e)}else he(2);a.v=0,a.f&&a.f.ra(b),Zn(a),qn(a)}function Zn(a){a.v=0,a.I=-1,a.f&&(0==mn(a.b).length&&0==a.g.length||(a.b.c.length=0,N(a.g),a.g.length=0),a.f.qa())}function er(a,b,t){var e=function(a){return a instanceof Be?Ke(a):new Be(a,void 0)}(t);if(""!=e.c)b&&ze(e,b+"."+e.c),Qe(e,e.h);else{var n=l.location;e=function(a,b,t,e){var n=new Be(null,void 0);return a&&Ge(n,a),b&&ze(n,b),t&&Qe(n,t),e&&(n.g=e),n}(n.protocol,b?b+"."+n.hostname:n.hostname,+n.port,t)}return a.V&&M(a.V,(function(t,g){We(e,g,t)})),b=a.A,t=a.na,b&&t&&We(e,b,t),We(e,"VER",a.ha),Kn(a,e),e}function nr(a,b){if(b&&!a.C)throw Error("Can't create secondary domain capable XhrIo object.");return(b=new _n(a.Na)).F=a.C,b}function rr(){}function ir(){if(z&&!(10<=Number(ot)))throw Error("Environmental error: no available transport.")}function or(a,b){xt.call(this),this.a=new Pn(b),this.o=a,this.b=b&&b.messageUrlParams||null,a=b&&b.messageHeaders||null,b&&b.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.a.l=a,a=b&&b.initMessageHeaders||null,b&&b.messageContentType&&(a?a["X-WebChannel-Content-Type"]=b.messageContentType:a={"X-WebChannel-Content-Type":b.messageContentType}),b&&b.a&&(a?a["X-WebChannel-Client-Profile"]=b.a:a={"X-WebChannel-Client-Profile":b.a}),this.a.O=a,(a=b&&b.httpHeadersOverwriteParam)&&!C(a)&&(this.a.i=a),this.m=b&&b.supportsCrossDomainXhr||!1,this.l=b&&b.sendRawJson||!1,(b=b&&b.httpSessionIdParam)&&!C(b)&&(this.a.A=b,null!==(a=this.b)&&b in a&&(b in(a=this.b)&&delete a[b])),this.f=new ur(this)}function sr(a){we.call(this);var b=a.__sm__;if(b){t:{for(var t in b){a=t;break t}a=void 0}(this.c=a)?(a=this.c,this.data=null!==b&&a in b?b[a]:void 0):this.data=b}else this.data=a}function ar(){Ee.call(this),this.status=1}function ur(a){this.a=a}(c=_n.prototype).ba=function(a,b,t,e){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+a);b=b?b.toUpperCase():"GET",this.B=a,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?ve(this.H):ve(me),this.a.onreadystatechange=p(this.za,this);try{this.A=!0,this.a.open(b,String(a),!0),this.A=!1}catch(t){return void An(this,t)}a=t||"";var n=new Fe(this.headers);e&&Me(e,(function(t,g){n.set(g,t)})),e=function(a){t:{for(var b=Dn,t=a.length,e="string"==typeof a?a.split(""):a,n=0;n<t;n++)if(n in e&&b.call(void 0,e[n],n,a)){b=n;break t}b=-1}return 0>b?null:"string"==typeof a?a.charAt(b):a[b]}(n.L()),t=l.FormData&&a instanceof l.FormData,!(0<=S(td,b))||e||t||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n.forEach((function(t,g){this.a.setRequestHeader(g,t)}),this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{kn(this),0<this.o&&((this.D=function(a){return z&&nt(9)&&"number"==typeof a.timeout&&void 0!==a.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=p(this.xa,this)):this.m=Yt(this.xa,this.o,this)),this.l=!0,this.a.send(a),this.l=!1}catch(t){An(this,t)}},c.xa=function(){void 0!==f&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,Rt(this,"timeout"),this.abort(8))},c.abort=function(a){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=a||7,Rt(this,"complete"),Rt(this,"abort"),jn(this))},c.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),jn(this,!0)),_n.X.G.call(this)},c.za=function(){this.j||(this.A||this.l||this.g?Cn(this):this.Ua())},c.Ua=function(){Cn(this)},c.W=function(){try{return 2<xn(this)?this.a.status:-1}catch(t){return-1}},c.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},c.Pa=function(a){if(this.a){var b=this.a.responseText;return a&&0==b.indexOf(a)&&(b=b.substring(a.length)),In(b)}},c.ua=function(){return this.h},c.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(c=Pn.prototype).ha=8,c.v=1,c.Ba=function(a){if(this.h)if(this.h=null,1==this.v){if(!a){this.R=Math.floor(1e5*Math.random()),a=this.R++;var t,b=new Ie(this,this.c,a,void 0),e=this.l;if(this.O&&(e?U(e=F(e),this.O):e=this.O),null===this.i&&(b.B=e),this.da)t:{for(var n=t=0;n<this.g.length;n++){var r=this.g[n];if(void 0===(r="__data__"in r.a&&"string"==typeof(r=r.a.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break t}if(4096===t||n===this.g.length-1){t=n+1;break t}}t=1e3}else t=1e3;t=Gn(this,b,t),We(n=Ke(this.B),"RID",a),We(n,"CVER",22),this.A&&We(n,"X-HTTP-Session-Id",this.A),Kn(this,n),this.i&&e&&Rn(n,this.i,e),vn(this.b,b),this.Ia&&We(n,"TYPE","init"),this.da?(We(n,"$req",t),We(n,"SID","null"),b.U=!0,De(b,n,null)):De(b,n,t),this.v=2}}else 3==this.v&&(a?Bn(this,a):0==this.g.length||dn(this.b)||Bn(this))},c.Aa=function(){if(this.j=null,Wn(this),this.U&&!(this.F||null==this.a||0>=this.N)){var a=2*this.N;this.c.info("BP detection timer enabled: "+a),this.s=le(p(this.Ta,this),a)}},c.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,he(10),Fn(this),Wn(this))},c.Sa=function(){null!=this.m&&(this.m=null,Fn(this),Qn(this),he(19))},c.Ya=function(a){a?(this.c.info("Successfully pinged google.com"),he(2)):(this.c.info("Failed to ping google.com"),he(1))},(c=rr.prototype).ta=function(){},c.sa=function(){},c.ra=function(){},c.qa=function(){},c.Ja=function(){},ir.prototype.a=function(a,b){return new or(a,b)},_(or,xt),or.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var a=this.a,b=this.o,t=this.b||void 0;he(0),a.fa=b,a.V=t||{},a.H=a.S,a.B=er(a,null,a.fa),Un(a)},or.prototype.close=function(){Mn(this.a)},or.prototype.h=function(a){if("string"==typeof a){var b={};b.__data__=a,Vn(this.a,b)}else this.l?((b={}).__data__=Pt(a),Vn(this.a,b)):Vn(this.a,a)},or.prototype.G=function(){this.a.f=null,delete this.f,Mn(this.a),delete this.a,or.X.G.call(this)},_(sr,we),_(ar,Ee),_(ur,rr),ur.prototype.ta=function(){Rt(this.a,"a")},ur.prototype.sa=function(a){Rt(this.a,new sr(a))},ur.prototype.ra=function(a){Rt(this.a,new ar(a))},ur.prototype.qa=function(){Rt(this.a,"b")},ir.prototype.createWebChannel=ir.prototype.a,or.prototype.send=or.prototype.h,or.prototype.open=or.prototype.g,or.prototype.close=or.prototype.close,de.NO_ERROR=0,de.TIMEOUT=8,de.HTTP_ERROR=6,pe.COMPLETE="complete",ge.EventType=be,be.OPEN="a",be.CLOSE="b",be.ERROR="c",be.MESSAGE="d",xt.prototype.listen=xt.prototype.va,_n.prototype.listenOnce=_n.prototype.wa,_n.prototype.getLastError=_n.prototype.Qa,_n.prototype.getLastErrorCode=_n.prototype.ua,_n.prototype.getStatus=_n.prototype.W,_n.prototype.getResponseJson=_n.prototype.Pa,_n.prototype.getResponseText=_n.prototype.$,_n.prototype.send=_n.prototype.ba;var cr=function(){return new ir},fr=function(){return se()},lr=de,dr=pe,pr=ie,yr={gb:0,jb:1,kb:2,Db:3,Ib:4,Fb:5,Gb:6,Eb:7,Cb:8,Hb:9,PROXY:10,NOPROXY:11,Ab:12,wb:13,xb:14,vb:15,yb:16,zb:17,bb:18,ab:19,cb:20},vr=ge,gr=_n}).call(this,n(54))},464:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return gc})),n.d(e,"b",(function(){return bc})),n.d(e,"c",(function(){return Xa})),n.d(e,"d",(function(){return H})),n.d(e,"e",(function(){return fc})),n.d(e,"f",(function(){return dc})),n.d(e,"g",(function(){return Ya})),n.d(e,"h",(function(){return lc})),n.d(e,"i",(function(){return yc})),n.d(e,"j",(function(){return Ic})),n.d(e,"k",(function(){return jc})),n.d(e,"l",(function(){return Oc})),n.d(e,"m",(function(){return Ac})),n.d(e,"n",(function(){return vc})),n.d(e,"o",(function(){return Cc})),n.d(e,"p",(function(){return Dc})),n.d(e,"q",(function(){return _c})),n.d(e,"r",(function(){return iu}));var r=n(140),o=n(46),c=n(433),h=n(41),f=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();f.o=-1;var l=new r.b("@firebase/firestore");function d(){return l.logLevel}function y(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(l.logLevel<=r.a.DEBUG){var i=e.map(w);l.debug.apply(l,Object(h.f)(["Firestore (8.3.1): "+t],i))}}function v(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(l.logLevel<=r.a.ERROR){var i=e.map(w);l.error.apply(l,Object(h.f)(["Firestore (8.3.1): "+t],i))}}function m(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(l.logLevel<=r.a.WARN){var i=e.map(w);l.warn.apply(l,Object(h.f)(["Firestore (8.3.1): "+t],i))}}function w(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function E(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.3.1) INTERNAL ASSERTION FAILED: "+t;throw v(e),new Error(e)}function T(t,e){t||E()}function I(t,e){return t}function _(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var O=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=_(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function S(t,e){return t<e?-1:t>e?1:0}function D(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function A(t){return t+"\0"}function N(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function C(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function q(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function j(t){return null==t}function k(t){return 0===t&&1/t==-1/0}function x(t){return"number"==typeof t&&Number.isInteger(t)&&!k(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var R={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},L=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(h.c)(e,t),e}(Error),P=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&E(),void 0===n?n=t.length-e:n>t.length-e&&E(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),M=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(h.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new L(R.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter((function(t){return t.length>0})))}return new e(r)},e.emptyPath=function(){return new e([])},e}(P),F=/^[_a-zA-Z][_a-zA-Z0-9]*$/,V=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(h.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return F.test(t)},e.prototype.canonicalString=function(){return this.toArray().map((function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t})).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new L(R.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var u=t[i];if("\\"===u){if(i+1===t.length)throw new L(R.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[i+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new L(R.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=a,i+=2}else"`"===u?(s=!s,i++):"."!==u||s?(r+=u,i++):(o(),i++)}if(o(),s)throw new L(R.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(P),U=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(M.fromString(e))},t.fromName=function(e){return new t(M.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===M.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return M.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new M(e.slice()))},t}(),B=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return S(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();B.EMPTY_BYTE_STRING=new B("");var K=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function G(t){if(T(!!t),"string"==typeof t){var e=0,n=K.exec(t);if(T(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:z(t.seconds),nanos:z(t.nanos)}}function z(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Q(t){return"string"==typeof t?B.fromBase64String(t):B.fromUint8Array(t)}var H=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new L(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new L(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new L(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new L(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?S(this.nanoseconds,t.nanoseconds):S(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}();function W(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Y(t){var e=t.mapValue.fields.__previous_value__;return W(e)?Y(e):e}function rt(t){var e=G(t.mapValue.fields.__local_write_time__.timestampValue);return new H(e.seconds,e.nanos)}function X(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?W(t)?4:10:E()}function J(t,e){var n=X(t);if(n!==X(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return rt(t).isEqual(rt(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=G(t.timestampValue),r=G(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Q(t.bytesValue).isEqual(Q(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return z(t.geoPointValue.latitude)===z(e.geoPointValue.latitude)&&z(t.geoPointValue.longitude)===z(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return z(t.integerValue)===z(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=z(t.doubleValue),r=z(e.doubleValue);return n===r?k(n)===k(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return D(t.arrayValue.values||[],e.arrayValue.values||[],J);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(N(n)!==N(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!J(n[i],r[i])))return!1;return!0}(t,e);default:return E()}}function $(t,e){return void 0!==(t.values||[]).find((function(t){return J(t,e)}))}function Z(t,e){var n=X(t),r=X(e);if(n!==r)return S(n,r);switch(n){case 0:return 0;case 1:return S(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=z(t.integerValue||t.doubleValue),r=z(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return tt(t.timestampValue,e.timestampValue);case 4:return tt(rt(t),rt(e));case 5:return S(t.stringValue,e.stringValue);case 6:return function(t,e){var n=Q(t),r=Q(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=S(n[i],r[i]);if(0!==o)return o}return S(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=S(z(t.latitude),z(e.latitude));return 0!==n?n:S(z(t.longitude),z(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Z(n[i],r[i]);if(o)return o}return S(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=S(r[s],o[s]);if(0!==u)return u;var a=Z(n[r[s]],i[o[s]]);if(0!==a)return a}return S(r.length,o.length)}(t.mapValue,e.mapValue);default:throw E()}}function tt(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return S(t,e);var n=G(t),r=G(e),i=S(n.seconds,r.seconds);return 0!==i?i:S(n.nanos,r.nanos)}function et(t){return nt(t)}function nt(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=G(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Q(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,U.fromName(n).toString()):"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=nt(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+nt(t.fields[o])}return e+"}"}(t.mapValue):E();var e,n}function it(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function ot(t){return!!t&&"integerValue"in t}function dt(t){return!!t&&"arrayValue"in t}function st(t){return!!t&&"nullValue"in t}function at(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function ut(t){return!!t&&"mapValue"in t}var ct=function(t,e){this.key=t,this.version=e},ht=function(t){function e(e,n,r,i){var o=this;return(o=t.call(this,e,n)||this).objectValue=r,o.hasLocalMutations=!!i.hasLocalMutations,o.hasCommittedMutations=!!i.hasCommittedMutations,o}return Object(h.c)(e,t),e.prototype.field=function(t){return this.objectValue.field(t)},e.prototype.data=function(){return this.objectValue},e.prototype.toProto=function(){return this.objectValue.proto},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations&&this.objectValue.isEqual(t.objectValue)},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.objectValue.toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),e}(ct),ft=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n)||this).hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return Object(h.c)(e,t),e.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(ct),lt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(h.c)(e,t),e.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(ct),pt=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function yt(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new pt(t,e,n,r,i,o,s)}function vt(t){var e=I(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return function(t){return t.field.canonicalString()+t.op.toString()+et(t.value)}(t)})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return function(t){return t.field.canonicalString()+t.dir}(t)})).join(","),j(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Nt(e.startAt)),e.endAt&&(n+="|ub:",n+=Nt(e.endAt)),e.h=n}return e.h}function gt(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!jt(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!J(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!xt(t.startAt,e.startAt)&&xt(t.endAt,e.endAt)}function mt(t){return U.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var bt=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Object(h.c)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new wt(t,n,r):"array-contains"===n?new _t(t,r):"in"===n?new Ot(t,r):"not-in"===n?new St(t,r):"array-contains-any"===n?new Dt(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new Et(t,n):new Tt(t,n)},e.prototype.matches=function(t){var e=t.field(this.field);return"!="===this.op?null!==e&&this.m(Z(e,this.value)):null!==e&&X(this.value)===X(e)&&this.m(Z(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return E()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}((function(){})),wt=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=U.fromName(r.referenceValue),i}return Object(h.c)(e,t),e.prototype.matches=function(t){var e=U.comparator(t.key,this.key);return this.m(e)},e}(bt),Et=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=It("in",n),r}return Object(h.c)(e,t),e.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},e}(bt),Tt=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=It("not-in",n),r}return Object(h.c)(e,t),e.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},e}(bt);function It(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return U.fromName(t.referenceValue)}))}var _t=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return Object(h.c)(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return dt(e)&&$(e.arrayValue,this.value)},e}(bt),Ot=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return Object(h.c)(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&$(this.value.arrayValue,e)},e}(bt),St=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return Object(h.c)(e,t),e.prototype.matches=function(t){if($(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.field(this.field);return null!==e&&!$(this.value.arrayValue,e)},e}(bt),Dt=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return Object(h.c)(e,t),e.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!dt(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return $(e.value.arrayValue,t)}))},e}(bt),At=function(t,e){this.position=t,this.before=e};function Nt(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return et(t)})).join(",")}var Ct=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function jt(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function kt(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?U.comparator(U.fromName(s.referenceValue),n.key):Z(s,n.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function xt(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!J(t.position[n],e.position[n]))return!1;return!0}var Rt=function(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=u,this.p=null,this.T=null,this.startAt,this.endAt};function Lt(t,e,n,r,i,o,s,u){return new Rt(t,e,n,r,i,o,s,u)}function Pt(t){return new Rt(t)}function Mt(t){return!j(t.limit)&&"F"===t.limitType}function Ft(t){return!j(t.limit)&&"L"===t.limitType}function qt(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function Vt(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function Ut(t){return null!==t.collectionGroup}function Bt(t){var e=I(t);if(null===e.p){e.p=[];var n=Vt(e),r=qt(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new Ct(n)),e.p.push(new Ct(V.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var u=s[o];e.p.push(u),u.field.isKeyField()&&(i=!0)}if(!i){var a=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new Ct(V.keyField(),a))}}}return e.p}function Kt(t){var e=I(t);if(!e.T)if("F"===e.limitType)e.T=yt(e.path,e.collectionGroup,Bt(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Bt(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new Ct(o.field,s))}var u=e.endAt?new At(e.endAt.position,!e.endAt.before):null,a=e.startAt?new At(e.startAt.position,!e.startAt.before):null;e.T=yt(e.path,e.collectionGroup,n,e.filters,e.limit,u,a)}return e.T}function Gt(t,e,n){return new Rt(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function zt(t,e){return gt(Kt(t),Kt(e))&&t.limitType===e.limitType}function Qt(t){return vt(Kt(t))+"|lt:"+t.limitType}function Ht(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map((function(t){return(e=t).field.canonicalString()+" "+e.op+" "+et(e.value);var e})).join(", ")+"]"),j(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map((function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)})).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Nt(t.startAt)),t.endAt&&(e+=", endAt: "+Nt(t.endAt)),"Target("+e+")"}(Kt(t))+"; limitType="+t.limitType+")"}function Wt(t,e){return function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):U.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!kt(t.startAt,Bt(t),e)||t.endAt&&kt(t.endAt,Bt(t),e))}(t,e)}function Yt(t){return function(e,n){for(var r=!1,i=0,o=Bt(t);i<o.length;i++){var s=o[i],u=Xt(s,e,n);if(0!==u)return u;r=r||s.field.isKeyField()}return 0}}function Xt(t,e,n){var r=t.field.isKeyField()?U.comparator(e.key,n.key):function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?Z(r,i):E()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return E()}}var Jt=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new H(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}(),$t=function(){function t(t){this.fields=t,t.sort(V.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return D(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),Zt=function(){function t(t){this.proto=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!ut(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.isEqual=function(t){return J(this.proto,t.proto)},t}(),te=function(){function t(t){void 0===t&&(t=Zt.empty()),this.I=t,this.A=new Map}return t.prototype.set=function(t,e){return this.R(t,e),this},t.prototype.delete=function(t){return this.R(t,null),this},t.prototype.R=function(t,e){for(var n=this.A,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===X(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.lastSegment(),e)},t.prototype.v=function(){var t=this.P(V.emptyPath(),this.A);return null!=t?new Zt(t):this.I},t.prototype.P=function(t,e){var n=this,r=!1,i=this.I.field(t),o=ut(i)?Object.assign({},i.mapValue.fields):{};return e.forEach((function(e,i){if(e instanceof Map){var s=n.P(t.child(i),e);null!=s&&(o[i]=s,r=!0)}else null!==e?(o[i]=e,r=!0):o.hasOwnProperty(i)&&(delete o[i],r=!0)})),r?{mapValue:{fields:o}}:null},t}();function ee(t){var e=[];return C(t.fields||{},(function(t,n){var r=new V([t]);if(ut(n)){var i=ee(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++){var u=s[o];e.push(r.child(u))}}else e.push(r)})),new $t(e)}function ne(t,e){if(t.V){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:k(e)?"-0":e}}function re(t){return{integerValue:""+t}}function ie(t,e){return x(e)?re(e):ne(t,e)}var oe=function(){this._=void 0};function se(t,e,n){return t instanceof ce?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof he?fe(t,e):t instanceof le?de(t,e):function(t,e){var n=ue(t,e),r=ye(n)+ye(t.S);return ot(n)&&ot(t.S)?re(r):ne(t.D,r)}(t,e)}function ae(t,e,n){return t instanceof he?fe(t,e):t instanceof le?de(t,e):n}function ue(t,e){return t instanceof pe?ot(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var ce=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(h.c)(e,t),e}(oe),he=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(h.c)(e,t),e}(oe);function fe(t,e){for(var n=ve(e),r=function(t){n.some((function(e){return J(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var le=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(h.c)(e,t),e}(oe);function de(t,e){for(var n=ve(e),r=function(t){n=n.filter((function(e){return!J(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var pe=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).D=e,r.S=n,r}return Object(h.c)(e,t),e}(oe);function ye(t){return z(t.integerValue||t.doubleValue)}function ve(t){return dt(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var ge=function(t,e){this.field=t,this.transform=e},me=function(t,e){this.version=t,this.transformResults=e},be=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function we(t,e){return void 0!==t.updateTime?e instanceof ht&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof ht}var Ee=function(){};function Te(t,e,n){return t instanceof De?function(t,e,n){var r=t.value,i=Ce(t.fieldTransforms,e,n.transformResults);return r=ke(t.fieldTransforms,r,i),new ht(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof Ae?function(t,e,n){if(!we(t.precondition,e))return new lt(t.key,n.version);var r=Ne(t,e,Ce(t.fieldTransforms,e,n.transformResults));return new ht(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new ft(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n)}function Ie(t,e,n){return t instanceof De?function(t,e,n){if(!we(t.precondition,e))return e;var r=t.value,i=je(t.fieldTransforms,n,e);r=ke(t.fieldTransforms,r,i);var o=Se(e);return new ht(t.key,o,r,{hasLocalMutations:!0})}(t,e,n):t instanceof Ae?function(t,e,n){if(!we(t.precondition,e))return e;var r=Se(e),i=Ne(t,e,je(t.fieldTransforms,n,e));return new ht(t.key,r,i,{hasLocalMutations:!0})}(t,e,n):function(t,e){return we(t.precondition,e)?new ft(t.key,Jt.min()):e}(t,e)}function _e(t,e){return function(t,e){for(var n=null,r=0,i=t;r<i.length;r++){var o=i[r],s=e instanceof ht?e.field(o.field):void 0,u=ue(o.transform,s||null);null!=u&&(n=null==n?(new te).set(o.field,u):n.set(o.field,u))}return n?n.v():null}(t.fieldTransforms,e)}function Oe(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&D(t,e,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof he&&e instanceof he||t instanceof le&&e instanceof le?D(t.elements,e.elements,J):t instanceof pe&&e instanceof pe?J(t.S,e.S):t instanceof ce&&e instanceof ce}(t.transform,e.transform)}(t,e)}))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function Se(t){return t instanceof ht?t.version:Jt.min()}var De=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return Object(h.c)(e,t),e}(Ee),Ae=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return Object(h.c)(e,t),e}(Ee);function Ne(t,e,n){var r;return r=function(t,e){var n=new te(e);return t.fieldMask.fields.forEach((function(e){if(!e.isEmpty()){var r=t.data.field(e);null!==r?n.set(e,r):n.delete(e)}})),n.v()}(t,r=e instanceof ht?e.data():Zt.empty()),ke(t.fieldTransforms,r,n)}function Ce(t,e,n){var r=[];T(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,u=null;e instanceof ht&&(u=e.field(o.field)),r.push(ae(s,u,n[i]))}return r}function je(t,e,n){for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i],u=s.transform,a=null;n instanceof ht&&(a=n.field(s.field)),r.push(se(u,a,e))}return r}function ke(t,e,n){for(var r=new te(e),i=0;i<t.length;i++){var o=t[i];r.set(o.field,n[i])}return r.v()}var xe,Re,Le=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return Object(h.c)(e,t),e}(Ee),Pe=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return Object(h.c)(e,t),e}(Ee),Me=function(t){this.count=t};function Fe(t){switch(t){case R.OK:return E();case R.CANCELLED:case R.UNKNOWN:case R.DEADLINE_EXCEEDED:case R.RESOURCE_EXHAUSTED:case R.INTERNAL:case R.UNAVAILABLE:case R.UNAUTHENTICATED:return!1;case R.INVALID_ARGUMENT:case R.NOT_FOUND:case R.ALREADY_EXISTS:case R.PERMISSION_DENIED:case R.FAILED_PRECONDITION:case R.ABORTED:case R.OUT_OF_RANGE:case R.UNIMPLEMENTED:case R.DATA_LOSS:return!0;default:return E()}}function qe(t){if(void 0===t)return v("GRPC error has no .code"),R.UNKNOWN;switch(t){case xe.OK:return R.OK;case xe.CANCELLED:return R.CANCELLED;case xe.UNKNOWN:return R.UNKNOWN;case xe.DEADLINE_EXCEEDED:return R.DEADLINE_EXCEEDED;case xe.RESOURCE_EXHAUSTED:return R.RESOURCE_EXHAUSTED;case xe.INTERNAL:return R.INTERNAL;case xe.UNAVAILABLE:return R.UNAVAILABLE;case xe.UNAUTHENTICATED:return R.UNAUTHENTICATED;case xe.INVALID_ARGUMENT:return R.INVALID_ARGUMENT;case xe.NOT_FOUND:return R.NOT_FOUND;case xe.ALREADY_EXISTS:return R.ALREADY_EXISTS;case xe.PERMISSION_DENIED:return R.PERMISSION_DENIED;case xe.FAILED_PRECONDITION:return R.FAILED_PRECONDITION;case xe.ABORTED:return R.ABORTED;case xe.OUT_OF_RANGE:return R.OUT_OF_RANGE;case xe.UNIMPLEMENTED:return R.UNIMPLEMENTED;case xe.DATA_LOSS:return R.DATA_LOSS;default:return E()}}(Re=xe||(xe={}))[Re.OK=0]="OK",Re[Re.CANCELLED=1]="CANCELLED",Re[Re.UNKNOWN=2]="UNKNOWN",Re[Re.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Re[Re.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Re[Re.NOT_FOUND=5]="NOT_FOUND",Re[Re.ALREADY_EXISTS=6]="ALREADY_EXISTS",Re[Re.PERMISSION_DENIED=7]="PERMISSION_DENIED",Re[Re.UNAUTHENTICATED=16]="UNAUTHENTICATED",Re[Re.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Re[Re.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Re[Re.ABORTED=10]="ABORTED",Re[Re.OUT_OF_RANGE=11]="OUT_OF_RANGE",Re[Re.UNIMPLEMENTED=12]="UNIMPLEMENTED",Re[Re.INTERNAL=13]="INTERNAL",Re[Re.UNAVAILABLE=14]="UNAVAILABLE",Re[Re.DATA_LOSS=15]="DATA_LOSS";var Ve=function(){function t(t,e){this.comparator=t,this.root=e||Be.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Be.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Be.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.inorderTraversal((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new Ue(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new Ue(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new Ue(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new Ue(this.root,t,this.comparator,!0)},t}(),Ue=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),Be=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw E();if(this.right.isRed())throw E();var t=this.left.check();if(t!==this.right.check())throw E();return t+(this.isRed()?0:1)},t}();Be.EMPTY=null,Be.RED=!0,Be.BLACK=!1,Be.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw E()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw E()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw E()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw E()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw E()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new Be(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var Ke=function(){function t(t){this.comparator=t,this.data=new Ve(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new Ge(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new Ge(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),Ge=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),ze=new Ve(U.comparator);function Qe(){return ze}function He(){return Qe()}var We=new Ve(U.comparator);function Ye(){return We}var Xe=new Ve(U.comparator);function Je(){return Xe}var $e=new Ke(U.comparator);function Ze(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=$e,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var tn=new Ke(S);function en(){return tn}var nn=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,rn.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(Jt.min(),r,en(),Qe(),Ze())},t}(),rn=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(B.EMPTY_BYTE_STRING,n,Ze(),Ze(),Ze())},t}(),on=function(t,e,n,r){this.C=t,this.removedTargetIds=e,this.key=n,this.N=r},sn=function(t,e){this.targetId=t,this.$=e},an=function(t,e,n,r){void 0===n&&(n=B.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},un=function(){function t(){this.F=0,this.O=fn(),this.k=B.EMPTY_BYTE_STRING,this.M=!1,this.L=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.M},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.k},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"B",{get:function(){return 0!==this.F},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"q",{get:function(){return this.L},enumerable:!1,configurable:!0}),t.prototype.U=function(t){t.approximateByteSize()>0&&(this.L=!0,this.k=t)},t.prototype.K=function(){var t=Ze(),e=Ze(),n=Ze();return this.O.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:E()}})),new rn(this.k,this.M,t,e,n)},t.prototype.W=function(){this.L=!1,this.O=fn()},t.prototype.j=function(t,e){this.L=!0,this.O=this.O.insert(t,e)},t.prototype.G=function(t){this.L=!0,this.O=this.O.remove(t)},t.prototype.H=function(){this.F+=1},t.prototype.J=function(){this.F-=1},t.prototype.Y=function(){this.L=!0,this.M=!0},t}(),cn=function(){function t(t){this.X=t,this.Z=new Map,this.tt=Qe(),this.et=hn(),this.nt=new Ke(S)}return t.prototype.st=function(t){for(var e=0,n=t.C;e<n.length;e++){var r=n[e];t.N instanceof ht?this.it(r,t.N):t.N instanceof ft&&this.rt(r,t.key,t.N)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.rt(r,t.key,t.N)},t.prototype.ot=function(t){var e=this;this.forEachTarget(t,(function(n){var r=e.ct(n);switch(t.state){case 0:e.at(n)&&r.U(t.resumeToken);break;case 1:r.J(),r.B||r.W(),r.U(t.resumeToken);break;case 2:r.J(),r.B||e.removeTarget(n);break;case 3:e.at(n)&&(r.Y(),r.U(t.resumeToken));break;case 4:e.at(n)&&(e.ut(n),r.U(t.resumeToken));break;default:E()}}))},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.Z.forEach((function(t,r){n.at(r)&&e(r)}))},t.prototype.ht=function(t){var e=t.targetId,n=t.$.count,r=this.lt(e);if(r){var i=r.target;if(mt(i))if(0===n){var o=new U(i.path);this.rt(e,o,new ft(o,Jt.min()))}else T(1===n);else this.ft(e)!==n&&(this.ut(e),this.nt=this.nt.add(e))}},t.prototype.dt=function(t){var e=this,n=new Map;this.Z.forEach((function(r,i){var o=e.lt(i);if(o){if(r.current&&mt(o.target)){var s=new U(o.target.path);null!==e.tt.get(s)||e.wt(i,s)||e.rt(i,s,new ft(s,t))}r.q&&(n.set(i,r.K()),r.W())}}));var r=Ze();this.et.forEach((function(t,n){var i=!0;n.forEachWhile((function(t){var n=e.lt(t);return!n||2===n.purpose||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new nn(t,n,this.nt,this.tt,r);return this.tt=Qe(),this.et=hn(),this.nt=new Ke(S),i},t.prototype.it=function(t,e){if(this.at(t)){var n=this.wt(t,e.key)?2:0;this.ct(t).j(e.key,n),this.tt=this.tt.insert(e.key,e),this.et=this.et.insert(e.key,this._t(e.key).add(t))}},t.prototype.rt=function(t,e,n){if(this.at(t)){var r=this.ct(t);this.wt(t,e)?r.j(e,1):r.G(e),this.et=this.et.insert(e,this._t(e).delete(t)),n&&(this.tt=this.tt.insert(e,n))}},t.prototype.removeTarget=function(t){this.Z.delete(t)},t.prototype.ft=function(t){var e=this.ct(t).K();return this.X.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.H=function(t){this.ct(t).H()},t.prototype.ct=function(t){var e=this.Z.get(t);return e||(e=new un,this.Z.set(t,e)),e},t.prototype._t=function(t){var e=this.et.get(t);return e||(e=new Ke(S),this.et=this.et.insert(t,e)),e},t.prototype.at=function(t){var e=null!==this.lt(t);return e||y("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.lt=function(t){var e=this.Z.get(t);return e&&e.B?null:this.X.yt(t)},t.prototype.ut=function(t){var e=this;this.Z.set(t,new un),this.X.getRemoteKeysForTarget(t).forEach((function(n){e.rt(t,n,null)}))},t.prototype.wt=function(t,e){return this.X.getRemoteKeysForTarget(t).has(e)},t}();function hn(){return new Ve(U.comparator)}function fn(){return new Ve(U.comparator)}var ln={asc:"ASCENDING",desc:"DESCENDING"},dn={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},pn=function(t,e){this.databaseId=t,this.V=e};function yn(t,e){return t.V?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function vn(t,e){return t.V?e.toBase64():e.toUint8Array()}function gn(t,e){return yn(t,e.toTimestamp())}function mn(t){return T(!!t),Jt.fromTimestamp(function(t){var e=G(t);return new H(e.seconds,e.nanos)}(t))}function bn(t,e){return function(t){return new M(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function wn(t){var e=M.fromString(t);return T(Gn(e)),e}function En(t,e){return bn(t.databaseId,e.path)}function Tn(t,e){var n=wn(e);if(n.get(1)!==t.databaseId.projectId)throw new L(R.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new L(R.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new U(Sn(n))}function In(t,e){return bn(t.databaseId,e)}function _n(t){var e=wn(t);return 4===e.length?M.emptyPath():Sn(e)}function On(t){return new M(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Sn(t){return T(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Dn(t,e,n){return{name:En(t,e),fields:n.proto.mapValue.fields}}function An(t,e,n){var r=Tn(t,e.name),i=mn(e.updateTime),o=new Zt({mapValue:{fields:e.fields}});return new ht(r,i,o,{hasCommittedMutations:!!n})}function Nn(t,e){var n;if(e instanceof De)n={update:Dn(t,e.key,e.value)};else if(e instanceof Le)n={delete:En(t,e.key)};else if(e instanceof Ae)n={update:Dn(t,e.key,e.data),updateMask:Kn(e.fieldMask)};else{if(!(e instanceof Pe))return E();n={verify:En(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof ce)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof he)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof le)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof pe)return{fieldPath:e.field.canonicalString(),increment:n.S};throw E()}(0,t)}))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:gn(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:E()}(t,e.precondition)),n}function Cn(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?be.updateTime(mn(t.updateTime)):void 0!==t.exists?be.exists(t.exists):be.none()}(e.currentDocument):be.none(),r=e.updateTransforms?e.updateTransforms.map((function(e){return function(t,e){var n=null;if("setToServerValue"in e)T("REQUEST_TIME"===e.setToServerValue),n=new ce;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new he(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new le(i)}else"increment"in e?n=new pe(t,e.increment):E();var o=V.fromServerFormat(e.fieldPath);return new ge(o,n)}(t,e)})):[];if(e.update){e.update.name;var i=Tn(t,e.update.name),o=new Zt({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){var e=t.fieldPaths||[];return new $t(e.map((function(t){return V.fromServerFormat(t)})))}(e.updateMask);return new Ae(i,o,s,n,r)}return new De(i,o,n,r)}if(e.delete){var u=Tn(t,e.delete);return new Le(u,n)}if(e.verify){var a=Tn(t,e.verify);return new Pe(a,n)}return E()}function jn(t,e){return{documents:[In(t,e.path)]}}function kn(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=In(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=In(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(at(t.value))return{unaryFilter:{field:qn(t.field),op:"IS_NAN"}};if(st(t.value))return{unaryFilter:{field:qn(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(at(t.value))return{unaryFilter:{field:qn(t.field),op:"IS_NOT_NAN"}};if(st(t.value))return{unaryFilter:{field:qn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:qn(t.field),op:Fn(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return function(t){return{field:qn(t.field),direction:Mn(t.dir)}}(t)}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.V||j(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=Ln(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Ln(e.endAt)),n}function xn(t){var e=_n(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){T(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=Rn(n.where));var u=[];n.orderBy&&(u=n.orderBy.map((function(t){return function(t){return new Ct(Vn(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)})));var a=null;n.limit&&(a=function(t){var e;return j(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=Pn(n.startAt));var h=null;return n.endAt&&(h=Pn(n.endAt)),Lt(e,i,u,s,a,"F",c,h)}function Rn(t){return t?void 0!==t.unaryFilter?[Bn(t)]:void 0!==t.fieldFilter?[Un(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((function(t){return Rn(t)})).reduce((function(t,e){return t.concat(e)})):E():[]}function Ln(t){return{before:t.before,values:t.position}}function Pn(t){var e=!!t.before,n=t.values||[];return new At(n,e)}function Mn(t){return ln[t]}function Fn(t){return dn[t]}function qn(t){return{fieldPath:t.canonicalString()}}function Vn(t){return V.fromServerFormat(t.fieldPath)}function Un(t){return bt.create(Vn(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return E()}}(t.fieldFilter.op),t.fieldFilter.value)}function Bn(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Vn(t.unaryFilter.field);return bt.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Vn(t.unaryFilter.field);return bt.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Vn(t.unaryFilter.field);return bt.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Vn(t.unaryFilter.field);return bt.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return E()}}function Kn(t){var e=[];return t.fields.forEach((function(t){return e.push(t.canonicalString())})),{fieldPaths:e}}function Gn(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function zn(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=tr(e)),e=Qn(t.get(n),e);return tr(e)}function Qn(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function tr(t){return t+""}function Hn(t){var e=t.length;if(T(e>=2),2===e)return T(""===t.charAt(0)&&""===t.charAt(1)),M.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||s>n)&&E(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:E()}o=s+2}return new M(r)}var Wn=function(t,e){this.seconds=t,this.nanoseconds=e},Yn=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Yn.store="owner",Yn.key="owner";var Xn=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Xn.store="mutationQueues",Xn.keyPath="userId";var Jn=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Jn.store="mutations",Jn.keyPath="batchId",Jn.userMutationsIndex="userMutationsIndex",Jn.userMutationsKeyPath=["userId","batchId"];var $n=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,zn(e)]},t.key=function(t,e,n){return[t,zn(e),n]},t}();$n.store="documentMutations",$n.PLACEHOLDER=new $n;var Zn=function(t,e){this.path=t,this.readTime=e},er=function(t,e){this.path=t,this.version=e},nr=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};nr.store="remoteDocuments",nr.readTimeIndex="readTimeIndex",nr.readTimeIndexPath="readTime",nr.collectionReadTimeIndex="collectionReadTimeIndex",nr.collectionReadTimeIndexPath=["parentPath","readTime"];var hr=function(t){this.byteSize=t};hr.store="remoteDocumentGlobal",hr.key="remoteDocumentGlobalKey";var rr=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};rr.store="targets",rr.keyPath="targetId",rr.queryTargetsIndexName="queryTargetsIndex",rr.queryTargetsKeyPath=["canonicalId","targetId"];var ir=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};ir.store="targetDocuments",ir.keyPath=["targetId","path"],ir.documentTargetsIndex="documentTargetsIndex",ir.documentTargetsKeyPath=["path","targetId"];var or=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};or.key="targetGlobalKey",or.store="targetGlobal";var sr=function(t,e){this.collectionId=t,this.parent=e};sr.store="collectionParents",sr.keyPath=["collectionId","parent"];var ar=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};ar.store="clientMetadata",ar.keyPath="clientId";var ur=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};ur.store="bundles",ur.keyPath="bundleId";var cr=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};cr.store="namedQueries",cr.keyPath="name";var fr=Object(h.f)(Object(h.f)([],Object(h.f)(Object(h.f)([],Object(h.f)(Object(h.f)([],Object(h.f)(Object(h.f)([],[Xn.store,Jn.store,$n.store,nr.store,rr.store,Yn.store,or.store,ir.store]),[ar.store])),[hr.store])),[sr.store])),[ur.store,cr.store]),lr="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",br=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach((function(t){return t()}))},t}(),dr=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},pr=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)}),(function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&E(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t((function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}}))},t.prototype.toPromise=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.waitFor=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.waitFor(r)},t}(),yr=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.gt=new dr,this.transaction.oncomplete=function(){n.gt.resolve()},this.transaction.onabort=function(){e.error?n.gt.reject(new mr(t,e.error)):n.gt.resolve()},this.transaction.onerror=function(e){var r=_r(e.target.error);n.gt.reject(new mr(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new mr(n,e)}},Object.defineProperty(t.prototype,"Et",{get:function(){return this.gt.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.gt.reject(t),this.aborted||(y("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Er(e)},t}(),vr=function(){function e(t,n,i){this.name=t,this.version=n,this.Tt=i,12.2===e.It(Object(o.g)())&&v("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return e.delete=function(t){return y("SimpleDb","Removing database:",t),Tr(window.indexedDB.deleteDatabase(t)).toPromise()},e.At=function(){if("undefined"==typeof indexedDB)return!1;if(e.Rt())return!0;var t=Object(o.g)(),n=e.It(t),i=0<n&&n<10,r=e.bt(t),s=0<r&&r<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||i||s)},e.Rt=function(){var e;return void 0!==t&&"YES"===(null===(e=t.env)||void 0===e?void 0:e.vt)},e.Pt=function(t,e){return t.store(e)},e.It=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},e.bt=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},e.prototype.Vt=function(t){return Object(h.b)(this,void 0,void 0,(function(){var e,n=this;return Object(h.d)(this,(function(r){switch(r.label){case 0:return this.db?[3,2]:(y("SimpleDb","Opening database:",this.name),e=this,[4,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new mr(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new L(R.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(new mr(t,n))},i.onupgradeneeded=function(t){y("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;n.Tt.St(e,i.transaction,t.oldVersion,n.version).next((function(){y("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}))]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.Dt&&(this.db.onversionchange=function(t){return n.Dt(t)}),this.db)]}}))}))},e.prototype.Ct=function(t){this.Dt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},e.prototype.runTransaction=function(t,e,n,r){return Object(h.b)(this,void 0,void 0,(function(){var i,o,s,u,a;return Object(h.d)(this,(function(c){switch(c.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,a,c,f;return Object(h.d)(this,(function(h){switch(h.label){case 0:++o,h.label=1;case 1:return h.trys.push([1,4,,5]),[4,u.Vt(t)];case 2:return u.db=h.sent(),e=yr.open(u.db,t,i?"readonly":"readwrite",n),s=r(e).catch((function(t){return e.abort(t),pr.reject(t)})).toPromise(),a={},s.catch((function(){})),[4,e.Et];case 3:return[2,(a.value=(h.sent(),s),a)];case 4:return c=h.sent(),f="FirebaseError"!==c.name&&o<3,y("SimpleDb","Transaction failed with error:",c.message,"Retrying:",f),u.close(),f?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}}))},u=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(a=c.sent()))return[2,a.value];c.label=3;case 3:return[3,1];case 4:return[2]}}))}))},e.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},e}(),gr=function(){function t(t){this.xt=t,this.Nt=!1,this.$t=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Nt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Ft",{get:function(){return this.$t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.xt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Nt=!0},t.prototype.Ot=function(t){this.$t=t},t.prototype.delete=function(){return Tr(this.xt.delete())},t}(),mr=function(t){function e(e,n){var r=this;return(r=t.call(this,R.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return Object(h.c)(e,t),e}(L);function wr(t){return"IndexedDbTransactionError"===t.name}var Er=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(y("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(y("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Tr(n)},t.prototype.add=function(t){return y("SimpleDb","ADD",this.store.name,t,t),Tr(this.store.add(t))},t.prototype.get=function(t){var e=this;return Tr(this.store.get(t)).next((function(n){return void 0===n&&(n=null),y("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return y("SimpleDb","DELETE",this.store.name,t),Tr(this.store.delete(t))},t.prototype.count=function(){return y("SimpleDb","COUNT",this.store.name),Tr(this.store.count())},t.prototype.kt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.Mt(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.Lt=function(t,e){y("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.Bt=!1;var r=this.cursor(n);return this.Mt(r,(function(t,e,n){return n.delete()}))},t.prototype.qt=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.Mt(r,e)},t.prototype.Ut=function(t){var e=this.cursor({});return new pr((function(n,r){e.onerror=function(t){var e=_r(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.Mt=function(t,e){var n=[];return new pr((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new gr(i),s=e(i.primaryKey,i.value,o);if(s instanceof pr){var u=s.catch((function(t){return o.done(),pr.reject(t)}));n.push(u)}o.isDone?r():null===o.Ft?i.continue():i.continue(o.Ft)}else r()}})).next((function(){return pr.waitFor(n)}))},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Bt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function Tr(t){return new pr((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=_r(t.target.error);n(e)}}))}var Ir=!1;function _r(t){var e=vr.It(Object(o.g)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var i=new L("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Ir||(Ir=!0,setTimeout((function(){throw i}),0)),i}}return t}var Or=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Qt=e,r.currentSequenceNumber=n,r}return Object(h.c)(e,t),e}(br);function Sr(t,e){var n=I(t);return vr.Pt(n.Qt,e)}var Dr=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e,n){for(var r=n.mutationResults,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=Te(o,e,r[i]))}return e},t.prototype.applyToLocalView=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++)(s=r[n]).key.isEqual(t)&&(e=Ie(s,e,this.localWriteTime));for(var i=0,o=this.mutations;i<o.length;i++){var s;(s=o[i]).key.isEqual(t)&&(e=Ie(s,e,this.localWriteTime))}return e},t.prototype.applyToLocalDocumentSet=function(t){var e=this,n=t;return this.mutations.forEach((function(r){var i=e.applyToLocalView(r.key,t.get(r.key));i&&(n=n.insert(r.key,i))})),n},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),Ze())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&D(this.mutations,t.mutations,(function(t,e){return Oe(t,e)}))&&D(this.baseMutations,t.baseMutations,(function(t,e){return Oe(t,e)}))},t}(),Ar=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){T(e.mutations.length===r.length);for(var i=Je(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),Nr=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=Jt.min()),void 0===o&&(o=Jt.min()),void 0===s&&(s=B.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),Cr=function(t){this.Kt=t};function jr(t,e){if(e.document)return An(t.Kt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=U.fromSegments(e.noDocument.path),r=Pr(e.noDocument.readTime);return new ft(n,r,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var i=U.fromSegments(e.unknownDocument.path);return r=Pr(e.unknownDocument.version),new lt(i,r)}return E()}function kr(t,e,n){var r=xr(n),i=e.key.path.popLast().toArray();if(e instanceof ht){var o=function(t,e){return{name:En(t,e.key),fields:e.toProto().mapValue.fields,updateTime:yn(t,e.version.toTimestamp())}}(t.Kt,e),s=e.hasCommittedMutations;return new nr(null,null,o,s,r,i)}if(e instanceof ft){var u=e.key.path.toArray(),a=Lr(e.version);return s=e.hasCommittedMutations,new nr(null,new Zn(u,a),null,s,r,i)}if(e instanceof lt){var c=e.key.path.toArray(),h=Lr(e.version);return new nr(new er(c,h),null,null,!0,r,i)}return E()}function xr(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Rr(t){var e=new H(t[0],t[1]);return Jt.fromTimestamp(e)}function Lr(t){var e=t.toTimestamp();return new Wn(e.seconds,e.nanoseconds)}function Pr(t){var e=new H(t.seconds,t.nanoseconds);return Jt.fromTimestamp(e)}function Mr(t,e){for(var n=(e.baseMutations||[]).map((function(e){return Cn(t.Kt,e)})),r=0;r<e.mutations.length-1;++r){var i=e.mutations[r];if(r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform){var o=e.mutations[r+1];i.updateTransforms=o.transform.fieldTransforms,e.mutations.splice(r+1,1),++r}}var s=e.mutations.map((function(e){return Cn(t.Kt,e)})),u=H.fromMillis(e.localWriteTimeMs);return new Dr(e.batchId,u,n,s)}function Fr(t){var e,n,r=Pr(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Pr(t.lastLimboFreeSnapshotVersion):Jt.min();return void 0!==t.query.documents?(T(1===(n=t.query).documents.length),e=Kt(Pt(_n(n.documents[0])))):e=function(t){return Kt(xn(t))}(t.query),new Nr(e,t.targetId,0,t.lastListenSequenceNumber,r,i,B.fromBase64String(t.resumeToken))}function qr(t,e){var n,r=Lr(e.snapshotVersion),i=Lr(e.lastLimboFreeSnapshotVersion);n=mt(e.target)?jn(t.Kt,e.target):kn(t.Kt,e.target);var o=e.resumeToken.toBase64();return new rr(e.targetId,vt(e.target),r,o,e.sequenceNumber,i,n)}function Vr(t){var e=xn({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Gt(e,e.limit,"L"):e}var Ur=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return Br(t).get(e).next((function(t){if(t)return{id:(e=t).bundleId,createTime:Pr(e.createTime),version:e.version};var e}))},t.prototype.saveBundleMetadata=function(t,e){return Br(t).put({bundleId:(n=e).id,createTime:Lr(mn(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return Kr(t).get(e).next((function(t){if(t)return{name:(e=t).name,query:Vr(e.bundledQuery),readTime:Pr(e.readTime)};var e}))},t.prototype.saveNamedQuery=function(t,e){return Kr(t).put(function(t){return{name:t.name,readTime:Lr(mn(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function Br(t){return Sr(t,ur.store)}function Kr(t){return Sr(t,cr.store)}var Gr=function(){function t(){this.Wt=new zr}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Wt.add(e),pr.resolve()},t.prototype.getCollectionParents=function(t,e){return pr.resolve(this.Wt.getEntries(e))},t}(),zr=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Ke(M.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new Ke(M.comparator)).toArray()},t}(),Qr=function(){function t(){this.jt=new zr}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.jt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener((function(){n.jt.add(e)}));var o={collectionId:r,parent:zn(i)};return Hr(t).put(o)}return pr.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[A(e),""],!1,!0);return Hr(t).kt(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Hn(o.parent))}return n}))},t}();function Hr(t){return Sr(t,sr.store)}var Wr={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Yr=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function Xr(t,e,n){var r=t.store(Jn.store),i=t.store($n.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.qt({range:s},(function(t,e,n){return u++,n.delete()}));o.push(a.next((function(){T(1===u)})));for(var c=[],h=0,f=n.mutations;h<f.length;h++){var l=f[h],d=$n.key(e,l.key.path,n.batchId);o.push(i.delete(d)),c.push(l.key)}return pr.waitFor(o).next((function(){return c}))}function Jr(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw E();e=t.noDocument}return JSON.stringify(e).length}Yr.DEFAULT_COLLECTION_PERCENTILE=10,Yr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Yr.DEFAULT=new Yr(41943040,Yr.DEFAULT_COLLECTION_PERCENTILE,Yr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Yr.DISABLED=new Yr(-1,0,0);var $r=function(){function t(t,e,n,r){this.userId=t,this.D=e,this.Gt=n,this.referenceDelegate=r,this.zt={}}return t.Ht=function(e,n,r,i){return T(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ti(t).qt({index:Jn.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=ei(t),s=ti(t);return s.add({}).next((function(u){T("number"==typeof u);for(var a=new Dr(u,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return Nn(t.Kt,e)})),i=n.mutations.map((function(e){return Nn(t.Kt,e)}));return new Jn(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.D,i.userId,a),h=[],f=new Ke((function(t,e){return S(t.canonicalString(),e.canonicalString())})),l=0,d=r;l<d.length;l++){var p=d[l],y=$n.key(i.userId,p.key.path,u);f=f.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(y,$n.PLACEHOLDER))}return f.forEach((function(e){h.push(i.Gt.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((function(){i.zt[u]=a.keys()})),pr.waitFor(h).next((function(){return a}))}))},t.prototype.lookupMutationBatch=function(t,e){var n=this;return ti(t).get(e).next((function(t){return t?(T(t.userId===n.userId),Mr(n.D,t)):null}))},t.prototype.Jt=function(t,e){var n=this;return this.zt[e]?pr.resolve(this.zt[e]):this.lookupMutationBatch(t,e).next((function(t){if(t){var r=t.keys();return n.zt[e]=r,r}return null}))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return ti(t).qt({index:Jn.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(T(e.batchId>=r),o=Mr(n.D,e)),i.done()})).next((function(){return o}))},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return ti(t).qt({index:Jn.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ti(t).kt(Jn.userMutationsIndex,n).next((function(t){return t.map((function(t){return Mr(e.D,t)}))}))},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=$n.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return ei(t).qt({range:i},(function(r,i,s){var u=r[0],a=r[1],c=r[2],h=Hn(a);if(u===n.userId&&e.path.isEqual(h))return ti(t).get(c).next((function(t){if(!t)throw E();T(t.userId===n.userId),o.push(Mr(n.D,t))}));s.done()})).next((function(){return o}))},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Ke(S),i=[];return e.forEach((function(e){var o=$n.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),u=ei(t).qt({range:s},(function(t,i,o){var s=t[0],u=t[1],a=t[2],c=Hn(u);s===n.userId&&e.path.isEqual(c)?r=r.add(a):o.done()}));i.push(u)})),pr.waitFor(i).next((function(){return n.Yt(t,r)}))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=$n.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),u=new Ke(S);return ei(t).qt({range:s},(function(t,e,o){var s=t[0],a=t[1],c=t[2],h=Hn(a);s===n.userId&&r.isPrefixOf(h)?h.length===i&&(u=u.add(c)):o.done()})).next((function(){return n.Yt(t,u)}))},t.prototype.Yt=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(ti(t).get(e).next((function(t){if(null===t)throw E();T(t.userId===n.userId),r.push(Mr(n.D,t))})))})),pr.waitFor(i).next((function(){return r}))},t.prototype.removeMutationBatch=function(t,e){var n=this;return Xr(t.Qt,this.userId,e).next((function(r){return t.addOnCommittedListener((function(){n.Xt(e.batchId)})),pr.forEach(r,(function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)}))}))},t.prototype.Xt=function(t){delete this.zt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next((function(n){if(!n)return pr.resolve();var r=IDBKeyRange.lowerBound($n.prefixForUser(e.userId)),i=[];return ei(t).qt({range:r},(function(t,n,r){if(t[0]===e.userId){var o=Hn(t[1]);i.push(o)}else r.done()})).next((function(){T(0===i.length)}))}))},t.prototype.containsKey=function(t,e){return Zr(t,this.userId,e)},t.prototype.Zt=function(t){var e=this;return ni(t).get(this.userId).next((function(t){return t||new Xn(e.userId,-1,"")}))},t}();function Zr(t,e,n){var r=$n.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return ei(t).qt({range:o,Bt:!0},(function(t,n,r){var o=t[0],u=t[1];t[2],o===e&&u===i&&(s=!0),r.done()})).next((function(){return s}))}function ti(t){return Sr(t,Jn.store)}function ei(t){return Sr(t,$n.store)}function ni(t){return Sr(t,Xn.store)}var ri=function(){function t(t){this.te=t}return t.prototype.next=function(){return this.te+=2,this.te},t.ee=function(){return new t(0)},t.ne=function(){return new t(-1)},t}(),ii=function(){function t(t,e){this.referenceDelegate=t,this.D=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.se(t).next((function(n){var r=new ri(n.highestTargetId);return n.highestTargetId=r.next(),e.ie(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.se(t).next((function(t){return Jt.fromTimestamp(new H(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.getHighestSequenceNumber=function(t){return this.se(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.se(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.ie(t,i)}))},t.prototype.addTargetData=function(t,e){var n=this;return this.re(t,e).next((function(){return n.se(t).next((function(r){return r.targetCount+=1,n.oe(e,r),n.ie(t,r)}))}))},t.prototype.updateTargetData=function(t,e){return this.re(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next((function(){return li(t).delete(e.targetId)})).next((function(){return n.se(t)})).next((function(e){return T(e.targetCount>0),e.targetCount-=1,n.ie(t,e)}))},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return li(t).qt((function(s,u){var a=Fr(u);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(i++,o.push(r.removeTargetData(t,a)))})).next((function(){return pr.waitFor(o)})).next((function(){return i}))},t.prototype.forEachTarget=function(t,e){return li(t).qt((function(t,n){var r=Fr(n);e(r)}))},t.prototype.se=function(t){return oi(t).get(or.key).next((function(t){return T(null!==t),t}))},t.prototype.ie=function(t,e){return oi(t).put(or.key,e)},t.prototype.re=function(t,e){return li(t).put(qr(this.D,e))},t.prototype.oe=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.se(t).next((function(t){return t.targetCount}))},t.prototype.getTargetData=function(t,e){var n=vt(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return li(t).qt({range:r,index:rr.queryTargetsIndexName},(function(t,n,r){var o=Fr(n);gt(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=si(t);return e.forEach((function(e){var s=zn(e.path);i.push(o.put(new ir(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))})),pr.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=si(t);return pr.forEach(e,(function(e){var o=zn(e.path);return pr.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])}))},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=si(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=si(t),i=Ze();return r.qt({range:n,Bt:!0},(function(t,e,n){var r=Hn(t[1]),o=new U(r);i=i.add(o)})).next((function(){return i}))},t.prototype.containsKey=function(t,e){var n=zn(e.path),r=IDBKeyRange.bound([n],[A(n)],!1,!0),i=0;return si(t).qt({index:ir.documentTargetsIndex,Bt:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.yt=function(t,e){return li(t).get(e).next((function(t){return t?Fr(t):null}))},t}();function li(t){return Sr(t,rr.store)}function oi(t){return Sr(t,or.store)}function si(t){return Sr(t,ir.store)}function ai(t){return Object(h.b)(this,void 0,void 0,(function(){return Object(h.d)(this,(function(e){if(t.code!==R.FAILED_PRECONDITION||t.message!==lr)throw t;return y("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}function ui(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=S(n,i);return 0===s?S(r,o):s}var ci=function(){function t(t){this.ce=t,this.buffer=new Ke(ui),this.ae=0}return t.prototype.ue=function(){return++this.ae},t.prototype.he=function(t){var e=[t,this.ue()];if(this.buffer.size<this.ce)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();ui(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),hi=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.le=!1,this.fe=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.de(t)},t.prototype.stop=function(){this.fe&&(this.fe.cancel(),this.fe=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.fe},enumerable:!1,configurable:!0}),t.prototype.de=function(t){var e=this,n=this.le?3e5:6e4;y("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.fe=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(function(){return Object(h.b)(e,void 0,void 0,(function(){var e;return Object(h.d)(this,(function(n){switch(n.label){case 0:this.fe=null,this.le=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return wr(e=n.sent())?(y("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,ai(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.de(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),fi=function(){function t(t,e){this.we=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.we._e(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return pr.resolve(f.o);var r=new ci(e);return this.we.forEachTarget(t,(function(t){return r.he(t.sequenceNumber)})).next((function(){return n.we.me(t,(function(t){return r.he(t)}))})).next((function(){return r.maxValue}))},t.prototype.removeTargets=function(t,e,n){return this.we.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.we.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(y("LruGarbageCollector","Garbage collection skipped; disabled"),pr.resolve(Wr)):this.getCacheSize(t).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(y("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Wr):n.ye(t,e)}))},t.prototype.getCacheSize=function(t){return this.we.getCacheSize(t)},t.prototype.ye=function(t,e){var n,i,o,s,u,a,c,h=this,f=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((function(e){return e>h.params.maximumSequenceNumbersToCollect?(y("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+e),i=h.params.maximumSequenceNumbersToCollect):i=e,s=Date.now(),h.nthSequenceNumber(t,i)})).next((function(r){return n=r,u=Date.now(),h.removeTargets(t,n,e)})).next((function(e){return o=e,a=Date.now(),h.removeOrphanedDocuments(t,n)})).next((function(t){return c=Date.now(),d()<=r.a.DEBUG&&y("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(c-a)+"ms\nTotal Duration: "+(c-f)+"ms"),pr.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:t})}))},t}(),di=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new fi(t,e)}(this,e)}return t.prototype._e=function(t){var e=this.ge(t);return this.db.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.ge=function(t){var e=0;return this.me(t,(function(t){e++})).next((function(){return e}))},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.me=function(t,e){return this.pe(t,(function(t,n){return e(n)}))},t.prototype.addReference=function(t,e,n){return pi(t,n)},t.prototype.removeReference=function(t,e,n){return pi(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return pi(t,e)},t.prototype.Ee=function(t,e){return function(t,e){var n=!1;return ni(t).Ut((function(r){return Zr(t,r,e).next((function(t){return t&&(n=!0),pr.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.pe(t,(function(s,u){if(u<=e){var a=n.Ee(t,s).next((function(e){if(!e)return o++,r.getEntry(t,s).next((function(){return r.removeEntry(s),si(t).delete([0,zn(s.path)])}))}));i.push(a)}})).next((function(){return pr.waitFor(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return pi(t,e)},t.prototype.pe=function(t,e){var n,r=si(t),i=f.o;return r.qt({index:ir.documentTargetsIndex},(function(t,r){var o=t[0],s=(t[1],r.path),u=r.sequenceNumber;0===o?(i!==f.o&&e(new U(Hn(n)),i),i=u,n=s):i=f.o})).next((function(){i!==f.o&&e(new U(Hn(n)),i)}))},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function pi(t,e){return si(t).put(function(t,e){return new ir(0,zn(t.path),e)}(e,t.currentSequenceNumber))}var yi=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(this.equalsFn(s,t))return u}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){C(this.inner,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];t(s,u)}}))},t.prototype.isEmpty=function(){return q(this.inner)},t}(),vi=function(){function t(){this.changes=new yi((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:Jt.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{maybeDocument:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{maybeDocument:null,readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?pr.resolve(n.maybeDocument):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),gi=function(){function t(t,e){this.D=t,this.Gt=e}return t.prototype.addEntry=function(t,e,n){return wi(t).put(Ei(e),n)},t.prototype.removeEntry=function(t,e){var n=wi(t),r=Ei(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.Te(t,r)}))},t.prototype.getEntry=function(t,e){var n=this;return wi(t).get(Ei(e)).next((function(t){return n.Ie(t)}))},t.prototype.Ae=function(t,e){var n=this;return wi(t).get(Ei(e)).next((function(t){var e=n.Ie(t);return e?{maybeDocument:e,size:Jr(t)}:null}))},t.prototype.getEntries=function(t,e){var n=this,r=He();return this.Re(t,e,(function(t,e){var i=n.Ie(e);r=r.insert(t,i)})).next((function(){return r}))},t.prototype.be=function(t,e){var n=this,r=He(),i=new Ve(U.comparator);return this.Re(t,e,(function(t,e){var o=n.Ie(e);o?(r=r.insert(t,o),i=i.insert(t,Jr(e))):(r=r.insert(t,null),i=i.insert(t,0))})).next((function(){return{ve:r,Pe:i}}))},t.prototype.Re=function(t,e,n){if(e.isEmpty())return pr.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return wi(t).qt({range:r},(function(t,e,r){for(var s=U.fromSegments(t);o&&U.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ot(o.path.toArray()):r.done()})).next((function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=Ye(),o=e.path.length+1,s={};if(n.isEqual(Jt.min())){var u=e.path.toArray();s.range=IDBKeyRange.lowerBound(u)}else{var a=e.path.toArray(),c=xr(n);s.range=IDBKeyRange.lowerBound([a,c],!0),s.index=nr.collectionReadTimeIndex}return wi(t).qt(s,(function(t,n,s){if(t.length===o){var u=jr(r.D,n);e.path.isPrefixOf(u.key.path)?u instanceof ht&&Wt(e,u)&&(i=i.insert(u.key,u)):s.done()}})).next((function(){return i}))},t.prototype.newChangeBuffer=function(t){return new mi(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return bi(t).get(hr.key).next((function(t){return T(!!t),t}))},t.prototype.Te=function(t,e){return bi(t).put(hr.key,e)},t.prototype.Ie=function(t){if(t){var e=jr(this.D,t);return e instanceof ft&&e.version.isEqual(Jt.min())?null:e}return null},t}(),mi=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ve=e,r.trackRemovals=n,r.Se=new yi((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return Object(h.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new Ke((function(t,e){return S(t.canonicalString(),e.canonicalString())}));return this.changes.forEach((function(o,s){var u=e.Se.get(o);if(s.maybeDocument){var a=kr(e.Ve.D,s.maybeDocument,e.getReadTime(o));i=i.add(o.path.popLast());var c=Jr(a);r+=c-u,n.push(e.Ve.addEntry(t,o,a))}else if(r-=u,e.trackRemovals){var h=kr(e.Ve.D,new ft(o,Jt.min()),e.getReadTime(o));n.push(e.Ve.addEntry(t,o,h))}else n.push(e.Ve.removeEntry(t,o))})),i.forEach((function(r){n.push(e.Ve.Gt.addToCollectionParentIndex(t,r))})),n.push(this.Ve.updateMetadata(t,r)),pr.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ve.Ae(t,e).next((function(t){return null===t?(n.Se.set(e,0),null):(n.Se.set(e,t.size),t.maybeDocument)}))},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ve.be(t,e).next((function(t){var e=t.ve;return t.Pe.forEach((function(t,e){n.Se.set(t,e)})),e}))},e}(vi);function bi(t){return Sr(t,hr.store)}function wi(t){return Sr(t,nr.store)}function Ei(t){return t.path.toArray()}var Ti=function(){function t(t){this.D=t}return t.prototype.St=function(t,e,n,r){var i=this;T(n<r&&n>=0&&r<=11);var o=new yr("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(Yn.store)}(t),function(t){t.createObjectStore(Xn.store,{keyPath:Xn.keyPath}),t.createObjectStore(Jn.store,{keyPath:Jn.keyPath,autoIncrement:!0}).createIndex(Jn.userMutationsIndex,Jn.userMutationsKeyPath,{unique:!0}),t.createObjectStore($n.store)}(t),Ii(t),function(t){t.createObjectStore(nr.store)}(t));var s=pr.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(ir.store),t.deleteObjectStore(rr.store),t.deleteObjectStore(or.store)}(t),Ii(t)),s=s.next((function(){return function(t){var e=t.store(or.store),n=new or(0,0,Jt.min().toTimestamp(),0);return e.put(or.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(Jn.store).kt().next((function(n){t.deleteObjectStore(Jn.store),t.createObjectStore(Jn.store,{keyPath:Jn.keyPath,autoIncrement:!0}).createIndex(Jn.userMutationsIndex,Jn.userMutationsKeyPath,{unique:!0});var r=e.store(Jn.store),i=n.map((function(t){return r.put(t)}));return pr.waitFor(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(ar.store,{keyPath:ar.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.De(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(hr.store)}(t),i.Ce(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.xe(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.Ne(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(nr.store);e.createIndex(nr.readTimeIndex,nr.readTimeIndexPath,{unique:!1}),e.createIndex(nr.collectionReadTimeIndex,nr.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.$e(o)}))),n<11&&r>=11&&(s=s.next((function(){!function(t){t.createObjectStore(ur.store,{keyPath:ur.keyPath})}(t),function(t){t.createObjectStore(cr.store,{keyPath:cr.keyPath})}(t)}))),s},t.prototype.Ce=function(t){var e=0;return t.store(nr.store).qt((function(t,n){e+=Jr(n)})).next((function(){var n=new hr(e);return t.store(hr.store).put(hr.key,n)}))},t.prototype.De=function(t){var e=this,n=t.store(Xn.store),r=t.store(Jn.store);return n.kt().next((function(n){return pr.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.kt(Jn.userMutationsIndex,i).next((function(r){return pr.forEach(r,(function(r){T(r.userId===n.userId);var i=Mr(e.D,r);return Xr(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.xe=function(t){var e=t.store(ir.store),n=t.store(nr.store);return t.store(or.store).get(or.key).next((function(t){var r=[];return n.qt((function(n,i){var o=new M(n),s=function(t){return[0,zn(t)]}(o);r.push(e.get(s).next((function(n){return n?pr.resolve():function(n){return e.put(new ir(0,zn(n),t.highestListenSequenceNumber))}(o)})))})).next((function(){return pr.waitFor(r)}))}))},t.prototype.Ne=function(t,e){t.createObjectStore(sr.store,{keyPath:sr.keyPath});var n=e.store(sr.store),r=new zr,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:zn(i)})}};return e.store(nr.store).qt({Bt:!0},(function(t,e){var n=new M(t);return i(n.popLast())})).next((function(){return e.store($n.store).qt({Bt:!0},(function(t,e){t[0];var n=t[1],r=(t[2],Hn(n));return i(r.popLast())}))}))},t.prototype.$e=function(t){var e=this,n=t.store(rr.store);return n.qt((function(t,r){var i=Fr(r),o=qr(e.D,i);return n.put(o)}))},t}();function Ii(t){t.createObjectStore(ir.store,{keyPath:ir.keyPath}).createIndex(ir.documentTargetsIndex,ir.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(rr.store,{keyPath:rr.keyPath}).createIndex(rr.queryTargetsIndexName,rr.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(or.store)}var _i="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Oi=function(){function t(e,n,r,i,o,s,u,a,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Fe=o,this.window=s,this.document=u,this.Oe=c,this.ke=h,this.Me=null,this.Le=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Be=null,this.inForeground=!1,this.qe=null,this.Ue=null,this.Qe=Number.NEGATIVE_INFINITY,this.Ke=function(t){return Promise.resolve()},!t.At())throw new L(R.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new di(this,i),this.We=n+"main",this.D=new Cr(a),this.je=new vr(this.We,11,new Ti(this.D)),this.Ge=new ii(this.referenceDelegate,this.D),this.Gt=new Qr,this.ze=function(t,e){return new gi(t,e)}(this.D,this.Gt),this.He=new Ur,this.window&&this.window.localStorage?this.Je=this.window.localStorage:(this.Je=null,!1===h&&v("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.Ye().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new L(R.FAILED_PRECONDITION,_i);return t.Xe(),t.Ze(),t.tn(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.Ge.getHighestSequenceNumber(e)}))})).then((function(e){t.Me=new f(e,t.Oe)})).then((function(){t.Le=!0})).catch((function(e){return t.je&&t.je.close(),Promise.reject(e)}))},t.prototype.en=function(t){var e=this;return this.Ke=function(n){return Object(h.b)(e,void 0,void 0,(function(){return Object(h.d)(this,(function(e){return this.started?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.je.Ct((function(n){return Object(h.b)(e,void 0,void 0,(function(){return Object(h.d)(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Fe.enqueueAndForget((function(){return Object(h.b)(e,void 0,void 0,(function(){return Object(h.d)(this,(function(t){switch(t.label){case 0:return this.started?[4,this.Ye()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.Ye=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return Di(e).put(new ar(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.nn(e).next((function(e){e||(t.isPrimary=!1,t.Fe.enqueueRetryable((function(){return t.Ke(!1)})))}))})).next((function(){return t.sn(e)})).next((function(n){return t.isPrimary&&!n?t.rn(e).next((function(){return!1})):!!n&&t.on(e).next((function(){return!0}))}))})).catch((function(e){if(wr(e))return y("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return y("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.Fe.enqueueRetryable((function(){return t.Ke(e)})),t.isPrimary=e}))},t.prototype.nn=function(t){var e=this;return Si(t).get(Yn.key).next((function(t){return pr.resolve(e.cn(t))}))},t.prototype.an=function(t){return Di(t).delete(this.clientId)},t.prototype.un=function(){return Object(h.b)(this,void 0,void 0,(function(){var t,e,n,r,i=this;return Object(h.d)(this,(function(o){switch(o.label){case 0:return!this.isPrimary||this.hn(this.Qe,18e5)?[3,2]:(this.Qe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(t){var e=Sr(t,ar.store);return e.kt().next((function(t){var n=i.ln(t,18e5),r=t.filter((function(t){return-1===n.indexOf(t)}));return pr.forEach(r,(function(t){return e.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(t=o.sent(),this.Je)for(e=0,n=t;e<n.length;e++)r=n[e],this.Je.removeItem(this.fn(r.clientId));o.label=2;case 2:return[2]}}))}))},t.prototype.tn=function(){var t=this;this.Ue=this.Fe.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return t.Ye().then((function(){return t.un()})).then((function(){return t.tn()}))}))},t.prototype.cn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.sn=function(t){var e=this;return this.ke?pr.resolve(!0):Si(t).get(Yn.key).next((function(n){if(null!==n&&e.hn(n.leaseTimestampMs,5e3)&&!e.dn(n.ownerId)){if(e.cn(n)&&e.networkEnabled)return!0;if(!e.cn(n)){if(!n.allowTabSynchronization)throw new L(R.FAILED_PRECONDITION,_i);return!1}}return!(!e.networkEnabled||!e.inForeground)||Di(t).kt().next((function(t){return void 0===e.ln(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&y("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.shutdown=function(){return Object(h.b)(this,void 0,void 0,(function(){var t=this;return Object(h.d)(this,(function(e){switch(e.label){case 0:return this.Le=!1,this.wn(),this.Ue&&(this.Ue.cancel(),this.Ue=null),this._n(),this.mn(),[4,this.je.runTransaction("shutdown","readwrite",[Yn.store,ar.store],(function(e){var n=new Or(e,f.o);return t.rn(n).next((function(){return t.an(n)}))}))];case 1:return e.sent(),this.je.close(),this.yn(),[2]}}))}))},t.prototype.ln=function(t,e){var n=this;return t.filter((function(t){return n.hn(t.updateTimeMs,e)&&!n.dn(t.clientId)}))},t.prototype.gn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return Di(e).kt().next((function(e){return t.ln(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"started",{get:function(){return this.Le},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return $r.Ht(t,this.D,this.Gt,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.Ge},t.prototype.getRemoteDocumentCache=function(){return this.ze},t.prototype.getIndexManager=function(){return this.Gt},t.prototype.getBundleCache=function(){return this.He},t.prototype.runTransaction=function(t,e,n){var r=this;y("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.je.runTransaction(t,o,fr,(function(o){return i=new Or(o,r.Me?r.Me.next():f.o),"readwrite-primary"===e?r.nn(i).next((function(t){return!!t||r.sn(i)})).next((function(e){if(!e)throw v("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.Fe.enqueueRetryable((function(){return r.Ke(!1)})),new L(R.FAILED_PRECONDITION,lr);return n(i)})).next((function(t){return r.on(i).next((function(){return t}))})):r.pn(i).next((function(){return n(i)}))})).then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.pn=function(t){var e=this;return Si(t).get(Yn.key).next((function(t){if(null!==t&&e.hn(t.leaseTimestampMs,5e3)&&!e.dn(t.ownerId)&&!e.cn(t)&&!(e.ke||e.allowTabSynchronization&&t.allowTabSynchronization))throw new L(R.FAILED_PRECONDITION,_i)}))},t.prototype.on=function(t){var e=new Yn(this.clientId,this.allowTabSynchronization,Date.now());return Si(t).put(Yn.key,e)},t.At=function(){return vr.At()},t.prototype.rn=function(t){var e=this,n=Si(t);return n.get(Yn.key).next((function(t){return e.cn(t)?(y("IndexedDbPersistence","Releasing primary lease."),n.delete(Yn.key)):pr.resolve()}))},t.prototype.hn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(v("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.Xe=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.qe=function(){t.Fe.enqueueAndForget((function(){return t.inForeground="visible"===t.document.visibilityState,t.Ye()}))},this.document.addEventListener("visibilitychange",this.qe),this.inForeground="visible"===this.document.visibilityState)},t.prototype._n=function(){this.qe&&(this.document.removeEventListener("visibilitychange",this.qe),this.qe=null)},t.prototype.Ze=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Be=function(){e.wn(),e.Fe.enqueueAndForget((function(){return e.shutdown()}))},this.window.addEventListener("unload",this.Be))},t.prototype.mn=function(){this.Be&&(this.window.removeEventListener("unload",this.Be),this.Be=null)},t.prototype.dn=function(t){var e;try{var n=null!==(null===(e=this.Je)||void 0===e?void 0:e.getItem(this.fn(t)));return y("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return v("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.wn=function(){if(this.Je)try{this.Je.setItem(this.fn(this.clientId),String(Date.now()))}catch(t){v("Failed to set zombie client id.",t)}},t.prototype.yn=function(){if(this.Je)try{this.Je.removeItem(this.fn(this.clientId))}catch(t){}},t.prototype.fn=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function Si(t){return Sr(t,Yn.store)}function Di(t){return Sr(t,ar.store)}function Ai(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var Ni=function(t,e){this.progress=t,this.En=e},Ci=function(){function t(t,e,n){this.ze=t,this.Tn=e,this.Gt=n}return t.prototype.In=function(t,e){var n=this;return this.Tn.getAllMutationBatchesAffectingDocumentKey(t,e).next((function(r){return n.An(t,e,r)}))},t.prototype.An=function(t,e,n){return this.ze.getEntry(t,e).next((function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].applyToLocalView(e,t);return t}))},t.prototype.Rn=function(t,e,n){var r=He();return e.forEach((function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].applyToLocalView(t,e);r=r.insert(t,e)})),r},t.prototype.bn=function(t,e){var n=this;return this.ze.getEntries(t,e).next((function(e){return n.vn(t,e)}))},t.prototype.vn=function(t,e){var n=this;return this.Tn.getAllMutationBatchesAffectingDocumentKeys(t,e).next((function(r){var i=n.Rn(t,e,r),o=Qe();return i.forEach((function(t,e){e||(e=new ft(t,Jt.min())),o=o.insert(t,e)})),o}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return U.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Pn(t,e.path):Ut(e)?this.Vn(t,e,n):this.Sn(t,e,n)},t.prototype.Pn=function(t,e){return this.In(t,new U(e)).next((function(t){var e=Ye();return t instanceof ht&&(e=e.insert(t.key,t)),e}))},t.prototype.Vn=function(t,e,n){var r=this,i=e.collectionGroup,o=Ye();return this.Gt.getCollectionParents(t,i).next((function(s){return pr.forEach(s,(function(s){var u=function(t,e){return new Rt(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.Sn(t,u,n).next((function(t){t.forEach((function(t,e){o=o.insert(t,e)}))}))})).next((function(){return o}))}))},t.prototype.Sn=function(t,e,n){var r,i,o=this;return this.ze.getDocumentsMatchingQuery(t,e,n).next((function(n){return r=n,o.Tn.getAllMutationBatchesAffectingQuery(t,e)})).next((function(e){return i=e,o.Dn(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,u=o.mutations;s<u.length;s++){var a=u[s],c=a.key,h=Ie(a,r.get(c),o.localWriteTime);r=h instanceof ht?r.insert(c,h):r.remove(c)}}))})).next((function(){return r.forEach((function(t,n){Wt(e,n)||(r=r.remove(t))})),r}))},t.prototype.Dn=function(t,e,n){for(var r=Ze(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof Ae&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.ze.getEntries(t,r).next((function(t){return t.forEach((function(t,e){null!==e&&e instanceof ht&&(c=c.insert(t,e))})),c}))},t}(),ji=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.Cn=n,this.xn=r}return t.Nn=function(e,n){for(var r=Ze(),i=Ze(),o=0,s=n.docChanges;o<s.length;o++){var u=s[o];switch(u.type){case 0:r=r.add(u.doc.key);break;case 1:i=i.add(u.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),ki=function(){function t(){}return t.prototype.$n=function(t){this.Fn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,i){var o=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(Jt.min())?this.On(t,e):this.Fn.bn(t,i).next((function(s){var u=o.kn(e,s);return(Mt(e)||Ft(e))&&o.Mn(e.limitType,u,i,n)?o.On(t,e):(d()<=r.a.DEBUG&&y("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Ht(e)),o.Fn.getDocumentsMatchingQuery(t,e,n).next((function(t){return u.forEach((function(e){t=t.insert(e.key,e)})),t})))}))},t.prototype.kn=function(t,e){var n=new Ke(Yt(t));return e.forEach((function(e,r){r instanceof ht&&Wt(t,r)&&(n=n.add(r))})),n},t.prototype.Mn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.On=function(t,e){return d()<=r.a.DEBUG&&y("QueryEngine","Using full collection scan to execute query:",Ht(e)),this.Fn.getDocumentsMatchingQuery(t,e,Jt.min())},t}(),xi=function(){function t(t,e,n,r){this.persistence=t,this.Ln=e,this.D=r,this.Bn=new Ve(S),this.qn=new yi((function(t){return vt(t)}),gt),this.Un=Jt.min(),this.Tn=t.getMutationQueue(n),this.Qn=t.getRemoteDocumentCache(),this.Ge=t.getTargetCache(),this.Kn=new Ci(this.Qn,this.Tn,this.persistence.getIndexManager()),this.He=t.getBundleCache(),this.Ln.$n(this.Kn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.collect(n,e.Bn)}))},t}();function Ri(t,e,n,r){return new xi(t,e,n,r)}function Li(t,e){return Object(h.b)(this,void 0,void 0,(function(){var n,r,i,o;return Object(h.d)(this,(function(s){switch(s.label){case 0:return n=I(t),r=n.Tn,i=n.Kn,[4,n.persistence.runTransaction("Handle user change","readonly",(function(t){var o;return n.Tn.getAllMutationBatches(t).next((function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new Ci(n.Qn,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)})).next((function(e){for(var n=[],r=[],s=Ze(),u=0,a=o;u<a.length;u++){var c=a[u];n.push(c.batchId);for(var h=0,f=c.mutations;h<f.length;h++){var l=f[h];s=s.add(l.key)}}for(var d=0,p=e;d<p.length;d++){var y=p[d];r.push(y.batchId);for(var v=0,m=y.mutations;v<m.length;v++){var g=m[v];s=s.add(g.key)}}return i.bn(t,s).next((function(t){return{Wn:t,removedBatchIds:n,addedBatchIds:r}}))}))}))];case 1:return o=s.sent(),[2,(n.Tn=r,n.Kn=i,n.Ln.$n(n.Kn),o)]}}))}))}function Pi(t,e){var n=I(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r=e.batch.keys(),i=n.Qn.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=pr.resolve();return o.forEach((function(t){s=s.next((function(){return r.getEntry(e,t)})).next((function(e){var o=e,s=n.docVersions.get(t);T(null!==s),(!o||o.version.compareTo(s)<0)&&(o=i.applyToRemoteDocument(t,o,n))&&r.addEntry(o,n.commitVersion)}))})),s.next((function(){return t.Tn.removeMutationBatch(e,i)}))}(n,t,e,i).next((function(){return i.apply(t)})).next((function(){return n.Tn.performConsistencyCheck(t)})).next((function(){return n.Kn.bn(t,r)}))}))}function Mi(t){var e=I(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.Ge.getLastRemoteSnapshotVersion(t)}))}function Fi(t,e){var n=I(t),r=e.snapshotVersion,i=n.Bn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.Qn.newChangeBuffer({trackRemovals:!0});i=n.Bn;var s=[];e.targetChanges.forEach((function(e,o){var u=i.get(o);if(u){s.push(n.Ge.removeMatchingKeys(t,e.removedDocuments,o).next((function(){return n.Ge.addMatchingKeys(t,e.addedDocuments,o)})));var a=e.resumeToken;if(a.approximateByteSize()>0){var c=u.withResumeToken(a,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return T(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(u,c,e)&&s.push(n.Ge.updateTargetData(t,c))}}}));var u=Qe();if(e.documentUpdates.forEach((function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),s.push(qi(t,o,e.documentUpdates,r,void 0).next((function(t){u=t}))),!r.isEqual(Jt.min())){var a=n.Ge.getLastRemoteSnapshotVersion(t).next((function(e){return n.Ge.setTargetsMetadata(t,t.currentSequenceNumber,r)}));s.push(a)}return pr.waitFor(s).next((function(){return o.apply(t)})).next((function(){return n.Kn.vn(t,u)}))})).then((function(t){return n.Bn=i,t}))}function qi(t,e,n,r,i){var o=Ze();return n.forEach((function(t){return o=o.add(t)})),e.getEntries(t,o).next((function(t){var o=Qe();return n.forEach((function(n,s){var u=t.get(n),a=(null==i?void 0:i.get(n))||r;s instanceof ft&&s.version.isEqual(Jt.min())?(e.removeEntry(n,a),o=o.insert(n,s)):null==u||s.version.compareTo(u.version)>0||0===s.version.compareTo(u.version)&&u.hasPendingWrites?(e.addEntry(s,a),o=o.insert(n,s)):y("LocalStore","Ignoring outdated watch update for ",n,". Current version:",u.version," Watch version:",s.version)})),o}))}function Vi(t,e){var n=I(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n.Tn.getNextMutationBatchAfterBatchId(t,e)}))}function Ui(t,e){var n=I(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.Ge.getTargetData(t,e).next((function(i){return i?(r=i,pr.resolve(r)):n.Ge.allocateTargetId(t).next((function(i){return r=new Nr(e,i,0,t.currentSequenceNumber),n.Ge.addTargetData(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.Bn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Bn=n.Bn.insert(t.targetId,t),n.qn.set(e,t.targetId)),t}))}function Bi(t,e,n){return Object(h.b)(this,void 0,void 0,(function(){var r,i,o,s;return Object(h.d)(this,(function(u){switch(u.label){case 0:r=I(t),i=r.Bn.get(e),o=n?"readwrite":"readwrite-primary",u.label=1;case 1:return u.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,(function(t){return r.persistence.referenceDelegate.removeTarget(t,i)}))];case 2:u.sent(),u.label=3;case 3:return[3,5];case 4:if(!wr(s=u.sent()))throw s;return y("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.Bn=r.Bn.remove(e),r.qn.delete(i.target),[2]}}))}))}function Ki(t,e,n){var r=I(t),i=Jt.min(),o=Ze();return r.persistence.runTransaction("Execute query","readonly",(function(t){return function(t,e,n){var r=I(t),i=r.qn.get(n);return void 0!==i?pr.resolve(r.Bn.get(i)):r.Ge.getTargetData(e,n)}(r,t,Kt(e)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.Ge.getMatchingKeysForTargetId(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.Ln.getDocumentsMatchingQuery(t,e,n?i:Jt.min(),n?o:Ze())})).next((function(t){return{documents:t,jn:o}}))}))}function Gi(t,e){var n=I(t),r=I(n.Ge),i=n.Bn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.yt(t,e).next((function(t){return t?t.target:null}))}))}function zi(t){var e=I(t);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return function(t,e,n){var r=I(t),i=Qe(),o=xr(n),s=wi(e),u=IDBKeyRange.lowerBound(o,!0);return s.qt({index:nr.readTimeIndex,range:u},(function(t,e){var n=jr(r.D,e);i=i.insert(n.key,n),o=e.readTime})).next((function(){return{En:i,readTime:Rr(o)}}))}(e.Qn,t,e.Un)})).then((function(t){var n=t.En,r=t.readTime;return e.Un=r,n}))}function Qi(t){return Object(h.b)(this,void 0,void 0,(function(){var e;return Object(h.d)(this,(function(n){return[2,(e=I(t)).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return function(t){var e=wi(t),n=Jt.min();return e.qt({index:nr.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=Rr(e.readTime)),r.done()})).next((function(){return n}))}(t)})).then((function(t){e.Un=t}))]}))}))}function Hi(t,e,n,r){return Object(h.b)(this,void 0,void 0,(function(){var i,o,s,u,a,c,f,l,d,y;return Object(h.d)(this,(function(p){switch(p.label){case 0:for(i=I(t),o=Ze(),s=Qe(),u=Je(),a=0,c=n;a<c.length;a++)f=c[a],l=e.Gn(f.metadata.name),f.document&&(o=o.add(l)),s=s.insert(l,e.zn(f)),u=u.insert(l,e.Hn(f.metadata.readTime));return d=i.Qn.newChangeBuffer({trackRemovals:!0}),[4,Ui(i,function(t){return Kt(Pt(M.fromString("__bundle__/docs/"+t)))}(r))];case 1:return y=p.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",(function(t){return qi(t,d,s,Jt.min(),u).next((function(e){return d.apply(t),e})).next((function(e){return i.Ge.removeMatchingKeysForTargetId(t,y.targetId).next((function(){return i.Ge.addMatchingKeys(t,o,y.targetId)})).next((function(){return i.Kn.vn(t,e)}))}))}))]}}))}))}function Wi(t,e,n){return void 0===n&&(n=Ze()),Object(h.b)(this,void 0,void 0,(function(){var r,i;return Object(h.d)(this,(function(o){switch(o.label){case 0:return[4,Ui(t,Kt(Vr(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=I(t)).persistence.runTransaction("Save named query","readwrite",(function(t){var o=mn(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.He.saveNamedQuery(t,e);var s=r.withResumeToken(B.EMPTY_BYTE_STRING,o);return i.Bn=i.Bn.insert(s.targetId,s),i.Ge.updateTargetData(t,s).next((function(){return i.Ge.removeMatchingKeysForTargetId(t,r.targetId)})).next((function(){return i.Ge.addMatchingKeys(t,n,r.targetId)})).next((function(){return i.He.saveNamedQuery(t,e)}))}))]}}))}))}var Yi=function(){function t(t){this.D=t,this.Jn=new Map,this.Yn=new Map}return t.prototype.getBundleMetadata=function(t,e){return pr.resolve(this.Jn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Jn.set(e.id,{id:(n=e).id,version:n.version,createTime:mn(n.createTime)}),pr.resolve()},t.prototype.getNamedQuery=function(t,e){return pr.resolve(this.Yn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.Yn.set(e.name,function(t){return{name:t.name,query:Vr(t.bundledQuery),readTime:mn(t.readTime)}}(e)),pr.resolve()},t}(),Xi=function(){function t(){this.Xn=new Ke(Ji.Zn),this.ts=new Ke(Ji.es)}return t.prototype.isEmpty=function(){return this.Xn.isEmpty()},t.prototype.addReference=function(t,e){var n=new Ji(t,e);this.Xn=this.Xn.add(n),this.ts=this.ts.add(n)},t.prototype.ns=function(t,e){var n=this;t.forEach((function(t){return n.addReference(t,e)}))},t.prototype.removeReference=function(t,e){this.ss(new Ji(t,e))},t.prototype.rs=function(t,e){var n=this;t.forEach((function(t){return n.removeReference(t,e)}))},t.prototype.os=function(t){var e=this,n=new U(new M([])),r=new Ji(n,t),i=new Ji(n,t+1),o=[];return this.ts.forEachInRange([r,i],(function(t){e.ss(t),o.push(t.key)})),o},t.prototype.cs=function(){var t=this;this.Xn.forEach((function(e){return t.ss(e)}))},t.prototype.ss=function(t){this.Xn=this.Xn.delete(t),this.ts=this.ts.delete(t)},t.prototype.us=function(t){var e=new U(new M([])),n=new Ji(e,t),r=new Ji(e,t+1),i=Ze();return this.ts.forEachInRange([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.containsKey=function(t){var e=new Ji(t,0),n=this.Xn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),Ji=function(){function t(t,e){this.key=t,this.hs=e}return t.Zn=function(t,e){return U.comparator(t.key,e.key)||S(t.hs,e.hs)},t.es=function(t,e){return S(t.hs,e.hs)||U.comparator(t.key,e.key)},t}(),$i=function(){function t(t,e){this.Gt=t,this.referenceDelegate=e,this.Tn=[],this.ls=1,this.fs=new Ke(Ji.Zn)}return t.prototype.checkEmpty=function(t){return pr.resolve(0===this.Tn.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ls;this.ls++,this.Tn.length>0&&this.Tn[this.Tn.length-1];var o=new Dr(i,e,n,r);this.Tn.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.fs=this.fs.add(new Ji(a.key,i)),this.Gt.addToCollectionParentIndex(t,a.key.path.popLast())}return pr.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return pr.resolve(this.ds(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.ws(n),i=r<0?0:r;return pr.resolve(this.Tn.length>i?this.Tn[i]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return pr.resolve(0===this.Tn.length?-1:this.ls-1)},t.prototype.getAllMutationBatches=function(t){return pr.resolve(this.Tn.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Ji(e,0),i=new Ji(e,Number.POSITIVE_INFINITY),o=[];return this.fs.forEachInRange([r,i],(function(t){var e=n.ds(t.hs);o.push(e)})),pr.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Ke(S);return e.forEach((function(t){var e=new Ji(t,0),i=new Ji(t,Number.POSITIVE_INFINITY);n.fs.forEachInRange([e,i],(function(t){r=r.add(t.hs)}))})),pr.resolve(this._s(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;U.isDocumentKey(i)||(i=i.child(""));var o=new Ji(new U(i),0),s=new Ke(S);return this.fs.forEachWhile((function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.hs)),!0)}),o),pr.resolve(this._s(s))},t.prototype._s=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.ds(t);null!==r&&n.push(r)})),n},t.prototype.removeMutationBatch=function(t,e){var n=this;T(0===this.ys(e.batchId,"removed")),this.Tn.shift();var r=this.fs;return pr.forEach(e.mutations,(function(i){var o=new Ji(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((function(){n.fs=r}))},t.prototype.Xt=function(t){},t.prototype.containsKey=function(t,e){var n=new Ji(e,0),r=this.fs.firstAfterOrEqual(n);return pr.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return this.Tn.length,pr.resolve()},t.prototype.ys=function(t,e){return this.ws(t)},t.prototype.ws=function(t){return 0===this.Tn.length?0:t-this.Tn[0].batchId},t.prototype.ds=function(t){var e=this.ws(t);return e<0||e>=this.Tn.length?null:this.Tn[e]},t}(),Zi=function(){function t(t,e){this.Gt=t,this.gs=e,this.docs=new Ve(U.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.gs(e);return this.docs=this.docs.insert(r,{maybeDocument:e,size:s,readTime:n}),this.size+=s-o,this.Gt.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return pr.resolve(n?n.maybeDocument:null)},t.prototype.getEntries=function(t,e){var n=this,r=He();return e.forEach((function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)})),pr.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Ye(),i=new U(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),u=s.key,a=s.value,c=a.maybeDocument,h=a.readTime;if(!e.path.isPrefixOf(u.path))break;h.compareTo(n)<=0||c instanceof ht&&Wt(e,c)&&(r=r.insert(c.key,c))}return pr.resolve(r)},t.prototype.ps=function(t,e){return pr.forEach(this.docs,(function(t){return e(t)}))},t.prototype.newChangeBuffer=function(t){return new to(this)},t.prototype.getSize=function(t){return pr.resolve(this.size)},t}(),to=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ve=e,n}return Object(h.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach((function(r,i){i&&i.maybeDocument?n.push(e.Ve.addEntry(t,i.maybeDocument,e.getReadTime(r))):e.Ve.removeEntry(r)})),pr.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ve.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ve.getEntries(t,e)},e}(vi),eo=function(){function t(t){this.persistence=t,this.Es=new yi((function(t){return vt(t)}),gt),this.lastRemoteSnapshotVersion=Jt.min(),this.highestTargetId=0,this.Ts=0,this.Is=new Xi,this.targetCount=0,this.As=ri.ee()}return t.prototype.forEachTarget=function(t,e){return this.Es.forEach((function(t,n){return e(n)})),pr.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return pr.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return pr.resolve(this.Ts)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.As.next(),pr.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Ts&&(this.Ts=e),pr.resolve()},t.prototype.re=function(t){this.Es.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.As=new ri(e),this.highestTargetId=e),t.sequenceNumber>this.Ts&&(this.Ts=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.re(e),this.targetCount+=1,pr.resolve()},t.prototype.updateTargetData=function(t,e){return this.re(e),pr.resolve()},t.prototype.removeTargetData=function(t,e){return this.Es.delete(e.target),this.Is.os(e.targetId),this.targetCount-=1,pr.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.Es.forEach((function(s,u){u.sequenceNumber<=e&&null===n.get(u.targetId)&&(r.Es.delete(s),o.push(r.removeMatchingKeysForTargetId(t,u.targetId)),i++)})),pr.waitFor(o).next((function(){return i}))},t.prototype.getTargetCount=function(t){return pr.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.Es.get(e)||null;return pr.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this.Is.ns(e,n),pr.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this.Is.rs(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.markPotentiallyOrphaned(t,e))})),pr.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this.Is.os(e),pr.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.Is.us(e);return pr.resolve(n)},t.prototype.containsKey=function(t,e){return pr.resolve(this.Is.containsKey(e))},t}(),no=function(){function t(t,e){var n=this;this.Rs={},this.Me=new f(0),this.Le=!1,this.Le=!0,this.referenceDelegate=t(this),this.Ge=new eo(this),this.Gt=new Gr,this.ze=function(t,e){return new Zi(t,(function(t){return n.referenceDelegate.bs(t)}))}(this.Gt),this.D=new Cr(e),this.He=new Yi(this.D)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.Le=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.Le},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Gt},t.prototype.getMutationQueue=function(t){var e=this.Rs[t.toKey()];return e||(e=new $i(this.Gt,this.referenceDelegate),this.Rs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.Ge},t.prototype.getRemoteDocumentCache=function(){return this.ze},t.prototype.getBundleCache=function(){return this.He},t.prototype.runTransaction=function(t,e,n){var r=this;y("MemoryPersistence","Starting transaction:",t);var i=new ro(this.Me.next());return this.referenceDelegate.vs(),n(i).next((function(t){return r.referenceDelegate.Ps(i).next((function(){return t}))})).toPromise().then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.Vs=function(t,e){return pr.or(Object.values(this.Rs).map((function(n){return function(){return n.containsKey(t,e)}})))},t}(),ro=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return Object(h.c)(e,t),e}(br),io=function(){function t(t){this.persistence=t,this.Ss=new Xi,this.Ds=null}return t.Cs=function(e){return new t(e)},Object.defineProperty(t.prototype,"xs",{get:function(){if(this.Ds)return this.Ds;throw E()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.Ss.addReference(n,e),this.xs.delete(n.toString()),pr.resolve()},t.prototype.removeReference=function(t,e,n){return this.Ss.removeReference(n,e),this.xs.add(n.toString()),pr.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.xs.add(e.toString()),pr.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.Ss.os(e.targetId).forEach((function(t){return n.xs.add(t.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((function(t){t.forEach((function(t){return n.xs.add(t.toString())}))})).next((function(){return r.removeTargetData(t,e)}))},t.prototype.vs=function(){this.Ds=new Set},t.prototype.Ps=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return pr.forEach(this.xs,(function(r){var i=U.fromPath(r);return e.Ns(t,i).next((function(t){t||n.removeEntry(i)}))})).next((function(){return e.Ds=null,n.apply(t)}))},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ns(t,e).next((function(t){t?n.xs.delete(e.toString()):n.xs.add(e.toString())}))},t.prototype.bs=function(t){return 0},t.prototype.Ns=function(t,e){var n=this;return pr.or([function(){return pr.resolve(n.Ss.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Vs(t,e)}])},t}(),oo=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function so(t,e){return"firestore_clients_"+t+"_"+e}function ao(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function uo(t,e){return"firestore_targets_"+t+"_"+e}oo.UNAUTHENTICATED=new oo(null),oo.GOOGLE_CREDENTIALS=new oo("google-credentials-uid"),oo.FIRST_PARTY=new oo("first-party-uid");var co=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.$s=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new L(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(v("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Fs=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),ho=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.$s=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new L(i.error.code,i.error.message)),o?new t(e,i.state,r):(v("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Fs=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),fo=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.$s=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=en(),s=0;i&&s<r.activeTargetIds.length;++s)i=x(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(v("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),lo=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.$s=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(v("SharedClientState","Failed to parse online state: "+e),null)},t}(),po=function(){function t(){this.activeTargetIds=en()}return t.prototype.Os=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.ks=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Fs=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),yo=function(){function t(t,e,n,r,i){this.window=t,this.Fe=e,this.persistenceKey=n,this.Ms=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Ls=this.Bs.bind(this),this.qs=new Ve(S),this.started=!1,this.Us=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Qs=so(this.persistenceKey,this.Ms),this.Ks=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.qs=this.qs.insert(this.Ms,new po),this.Ws=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.js=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.Gs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.zs=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Hs=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.Ls)}return t.At=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Object(h.b)(this,void 0,void 0,(function(){var t,e,n,r,i,o,s,u,a,c,f,l=this;return Object(h.d)(this,(function(h){switch(h.label){case 0:return[4,this.syncEngine.gn()];case 1:for(t=h.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ms&&(i=this.getItem(so(this.persistenceKey,r)))&&(o=fo.$s(r,i))&&(this.qs=this.qs.insert(o.clientId,o));for(this.Js(),(s=this.storage.getItem(this.zs))&&(u=this.Ys(s))&&this.Xs(u),a=0,c=this.Us;a<c.length;a++)f=c[a],this.Bs(f);return this.Us=[],this.window.addEventListener("unload",(function(){return l.shutdown()})),this.started=!0,[2]}}))}))},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ks,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Zs(this.qs)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.qs.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.addPendingMutation=function(t){this.ti(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.ti(t,e,n),this.ei(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(uo(this.persistenceKey,t));if(n){var r=ho.$s(t,n);r&&(e=r.state)}}return this.ni.Os(t),this.Js(),e},t.prototype.removeLocalQueryTarget=function(t){this.ni.ks(t),this.Js()},t.prototype.isLocalQueryTarget=function(t){return this.ni.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(uo(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.si(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach((function(t){r.ei(t)})),this.currentUser=t,n.forEach((function(t){r.addPendingMutation(t)}))},t.prototype.setOnlineState=function(t){this.ii(t)},t.prototype.notifyBundleLoaded=function(){this.ri()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.Ls),this.removeItem(this.Qs),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return y("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){y("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){y("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Bs=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(y("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Qs)return void v("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Fe.enqueueRetryable((function(){return Object(h.b)(e,void 0,void 0,(function(){var t,e,r,i,o,s;return Object(h.d)(this,(function(u){if(this.started){if(null!==n.key)if(this.Ws.test(n.key)){if(null==n.newValue)return t=this.oi(n.key),[2,this.ci(t,null)];if(e=this.ai(n.key,n.newValue))return[2,this.ci(e.clientId,e)]}else if(this.js.test(n.key)){if(null!==n.newValue&&(r=this.ui(n.key,n.newValue)))return[2,this.hi(r)]}else if(this.Gs.test(n.key)){if(null!==n.newValue&&(i=this.li(n.key,n.newValue)))return[2,this.fi(i)]}else if(n.key===this.zs){if(null!==n.newValue&&(o=this.Ys(n.newValue)))return[2,this.Xs(o)]}else if(n.key===this.Ks)(s=function(t){var e=f.o;if(null!=t)try{var n=JSON.parse(t);T("number"==typeof n),e=n}catch(t){v("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==f.o&&this.sequenceNumberHandler(s);else if(n.key===this.Hs)return[2,this.syncEngine.di()]}else this.Us.push(n);return[2]}))}))}))}},Object.defineProperty(t.prototype,"ni",{get:function(){return this.qs.get(this.Ms)},enumerable:!1,configurable:!0}),t.prototype.Js=function(){this.setItem(this.Qs,this.ni.Fs())},t.prototype.ti=function(t,e,n){var r=new co(this.currentUser,t,e,n),i=ao(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Fs())},t.prototype.ei=function(t){var e=ao(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.ii=function(t){var e={clientId:this.Ms,onlineState:t};this.storage.setItem(this.zs,JSON.stringify(e))},t.prototype.si=function(t,e,n){var r=uo(this.persistenceKey,t),i=new ho(t,e,n);this.setItem(r,i.Fs())},t.prototype.ri=function(){this.setItem(this.Hs,"value-not-used")},t.prototype.oi=function(t){var e=this.Ws.exec(t);return e?e[1]:null},t.prototype.ai=function(t,e){var n=this.oi(t);return fo.$s(n,e)},t.prototype.ui=function(t,e){var n=this.js.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return co.$s(new oo(i),r,e)},t.prototype.li=function(t,e){var n=this.Gs.exec(t),r=Number(n[1]);return ho.$s(r,e)},t.prototype.Ys=function(t){return lo.$s(t)},t.prototype.hi=function(t){return Object(h.b)(this,void 0,void 0,(function(){return Object(h.d)(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.wi(t.batchId,t.state,t.error)]:(y("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.fi=function(t){return this.syncEngine._i(t.targetId,t.state,t.error)},t.prototype.ci=function(t,e){var n=this,r=e?this.qs.insert(t,e):this.qs.remove(t),i=this.Zs(this.qs),o=this.Zs(r),s=[],u=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||u.push(t)})),this.syncEngine.mi(s,u).then((function(){n.qs=r}))},t.prototype.Xs=function(t){this.qs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Zs=function(t){var e=en();return t.forEach((function(t,n){e=e.unionWith(n.activeTargetIds)})),e},t}(),vo=function(){function t(){this.yi=new po,this.gi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.yi.Os(t),this.gi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.gi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.yi.ks(t)},t.prototype.isLocalQueryTarget=function(t){return this.yi.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.gi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.yi.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.yi.activeTargetIds.has(t)},t.prototype.start=function(){return this.yi=new po,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),go=function(){function t(){}return t.prototype.pi=function(t){},t.prototype.shutdown=function(){},t}(),mo=function(){function t(){var t=this;this.Ei=function(){return t.Ti()},this.Ii=function(){return t.Ai()},this.Ri=[],this.bi()}return t.prototype.pi=function(t){this.Ri.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.Ei),window.removeEventListener("offline",this.Ii)},t.prototype.bi=function(){window.addEventListener("online",this.Ei),window.addEventListener("offline",this.Ii)},t.prototype.Ti=function(){y("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.Ri;t<e.length;t++)(0,e[t])(0)},t.prototype.Ai=function(){y("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.Ri;t<e.length;t++)(0,e[t])(1)},t.At=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),bo={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},wo=function(){function t(t){this.vi=t.vi,this.Pi=t.Pi}return t.prototype.Vi=function(t){this.Si=t},t.prototype.Di=function(t){this.Ci=t},t.prototype.onMessage=function(t){this.xi=t},t.prototype.close=function(){this.Pi()},t.prototype.send=function(t){this.vi(t)},t.prototype.Ni=function(){this.Si()},t.prototype.$i=function(t){this.Ci(t)},t.prototype.Fi=function(t){this.xi(t)},t}(),Eo=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n}return Object(h.c)(e,t),e.prototype.qi=function(t,e,n,r){return new Promise((function(i,o){var s=new c.f;s.listenOnce(c.c.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case c.a.NO_ERROR:var e=s.getResponseJson();y("Connection","XHR received:",JSON.stringify(e)),i(e);break;case c.a.TIMEOUT:y("Connection",'RPC "'+t+'" timed out'),o(new L(R.DEADLINE_EXCEEDED,"Request time out"));break;case c.a.HTTP_ERROR:var n=s.getStatus();if(y("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var u=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(R).indexOf(e)>=0?e:R.UNKNOWN}(r.status);o(new L(u,r.message))}else o(new L(R.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new L(R.UNAVAILABLE,"Connection failed."));break;default:E()}}finally{y("Connection",'RPC "'+t+'" completed.')}}));var u=JSON.stringify(r);s.send(e,"POST",u,n,15)}))},e.prototype.Qi=function(t,e){var n=[this.Oi,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=Object(c.g)(),h=Object(c.h)(),f={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.Bi(f.initMessageHeaders,e),Object(o.l)()||Object(o.n)()||Object(o.j)()||Object(o.k)()||Object(o.o)()||Object(o.i)()||(f.httpHeadersOverwriteParam="$httpHeaders");var l=n.join("");y("Connection","Creating WebChannel: "+l,f);var g=r.createWebChannel(l,f),d=!1,b=!1,v=new wo({vi:function(t){b?y("Connection","Not sending because WebChannel is closed:",t):(d||(y("Connection","Opening WebChannel transport."),g.open(),d=!0),y("Connection","WebChannel sending:",t),g.send(t))},Pi:function(){return g.close()}}),w=function(t,e,n){t.listen(e,(function(t){try{n(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return w(g,c.e.EventType.OPEN,(function(){b||y("Connection","WebChannel transport opened.")})),w(g,c.e.EventType.CLOSE,(function(){b||(b=!0,y("Connection","WebChannel transport closed"),v.$i())})),w(g,c.e.EventType.ERROR,(function(t){b||(b=!0,m("Connection","WebChannel transport errored:",t),v.$i(new L(R.UNAVAILABLE,"The operation could not be completed")))})),w(g,c.e.EventType.MESSAGE,(function(t){var e;if(!b){var n=t.data[0];T(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){y("Connection","WebChannel received error:",i);var o=i.status,s=function(t){var e=xe[t];if(void 0!==e)return qe(e)}(o),u=i.message;void 0===s&&(s=R.INTERNAL,u="Unknown error status: "+o+" with message "+i.message),b=!0,v.$i(new L(s,u)),g.close()}else y("Connection","WebChannel received:",n),v.Fi(n)}})),w(h,c.b.STAT_EVENT,(function(t){t.stat===c.d.PROXY?y("Connection","Detected buffering proxy"):t.stat===c.d.NOPROXY&&y("Connection","Detected no buffering proxy")})),setTimeout((function(){v.Ni()}),0),v},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Oi=e+"://"+t.host,this.ki="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Mi=function(t,e,n,r){var i=this.Li(t,e);y("RestConnection","Sending: ",i,n);var o={};return this.Bi(o,r),this.qi(t,i,o,n).then((function(t){return y("RestConnection","Received: ",t),t}),(function(e){throw m("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.Ui=function(t,e,n,r){return this.Mi(t,e,n,r)},t.prototype.Bi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.3.1",t["Content-Type"]="text/plain",e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.Li=function(t,e){var n=bo[t];return this.Oi+"/v1/"+e+":"+n},t}());function To(){return"undefined"!=typeof window?window:null}function Io(){return"undefined"!=typeof document?document:null}function _o(t){return new pn(t,!0)}var Oo=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Fe=t,this.timerId=e,this.Ki=n,this.Wi=r,this.ji=i,this.Gi=0,this.zi=null,this.Hi=Date.now(),this.reset()}return t.prototype.reset=function(){this.Gi=0},t.prototype.Ji=function(){this.Gi=this.ji},t.prototype.Yi=function(t){var e=this;this.cancel();var n=Math.floor(this.Gi+this.Xi()),r=Math.max(0,Date.now()-this.Hi),i=Math.max(0,n-r);i>0&&y("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Gi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.zi=this.Fe.enqueueAfterDelay(this.timerId,i,(function(){return e.Hi=Date.now(),t()})),this.Gi*=this.Wi,this.Gi<this.Ki&&(this.Gi=this.Ki),this.Gi>this.ji&&(this.Gi=this.ji)},t.prototype.Zi=function(){null!==this.zi&&(this.zi.skipDelay(),this.zi=null)},t.prototype.cancel=function(){null!==this.zi&&(this.zi.cancel(),this.zi=null)},t.prototype.Xi=function(){return(Math.random()-.5)*this.Gi},t}(),So=function(){function t(t,e,n,r,i,o){this.Fe=t,this.tr=n,this.er=r,this.nr=i,this.listener=o,this.state=0,this.sr=0,this.ir=null,this.stream=null,this.rr=new Oo(t,e)}return t.prototype.cr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.ar=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.ur()},t.prototype.stop=function(){return Object(h.b)(this,void 0,void 0,(function(){return Object(h.d)(this,(function(t){switch(t.label){case 0:return this.cr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.hr=function(){this.state=0,this.rr.reset()},t.prototype.lr=function(){var t=this;this.ar()&&null===this.ir&&(this.ir=this.Fe.enqueueAfterDelay(this.tr,6e4,(function(){return t.dr()})))},t.prototype.wr=function(t){this._r(),this.stream.send(t)},t.prototype.dr=function(){return Object(h.b)(this,void 0,void 0,(function(){return Object(h.d)(this,(function(t){return this.ar()?[2,this.close(0)]:[2]}))}))},t.prototype._r=function(){this.ir&&(this.ir.cancel(),this.ir=null)},t.prototype.close=function(t,e){return Object(h.b)(this,void 0,void 0,(function(){return Object(h.d)(this,(function(n){switch(n.label){case 0:return this._r(),this.rr.cancel(),this.sr++,3!==t?this.rr.reset():e&&e.code===R.RESOURCE_EXHAUSTED?(v(e.toString()),v("Using maximum backoff delay to prevent overloading the backend."),this.rr.Ji()):e&&e.code===R.UNAUTHENTICATED&&this.nr.invalidateToken(),null!==this.stream&&(this.mr(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Di(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.mr=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.yr(this.sr),n=this.sr;this.nr.getToken().then((function(e){t.sr===n&&t.gr(e)}),(function(n){e((function(){var e=new L(R.UNKNOWN,"Fetching auth token failed: "+n.message);return t.pr(e)}))}))},t.prototype.gr=function(t){var e=this,n=this.yr(this.sr);this.stream=this.Er(t),this.stream.Vi((function(){n((function(){return e.state=2,e.listener.Vi()}))})),this.stream.Di((function(t){n((function(){return e.pr(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.ur=function(){var t=this;this.state=4,this.rr.Yi((function(){return Object(h.b)(t,void 0,void 0,(function(){return Object(h.d)(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.pr=function(t){return y("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.yr=function(t){var e=this;return function(n){e.Fe.enqueueAndForget((function(){return e.sr===t?n():(y("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),Do=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).D=i,s}return Object(h.c)(e,t),e.prototype.Er=function(t){return this.er.Qi("Listen",t)},e.prototype.onMessage=function(t){this.rr.reset();var e=function(t,e){var n;if("targetChange"in e){e.targetChange;var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:E()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.V?(T(void 0===e||"string"==typeof e),B.fromBase64String(e||"")):(T(void 0===e||e instanceof Uint8Array),B.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(u=e.targetChange.cause)&&function(t){var e=void 0===t.code?R.UNKNOWN:qe(t.code);return new L(e,t.message||"")}(u);n=new an(r,i,o,s||null)}else if("documentChange"in e){e.documentChange,(r=e.documentChange).document,r.document.name,r.document.updateTime,i=Tn(t,r.document.name),o=mn(r.document.updateTime);var u=new Zt({mapValue:{fields:r.document.fields}}),a=(s=new ht(i,o,u,{}),r.targetIds||[]),c=r.removedTargetIds||[];n=new on(a,c,s.key,s)}else if("documentDelete"in e)e.documentDelete,(r=e.documentDelete).document,i=Tn(t,r.document),o=r.readTime?mn(r.readTime):Jt.min(),u=new ft(i,o),s=r.removedTargetIds||[],n=new on([],s,u.key,u);else if("documentRemove"in e)e.documentRemove,(r=e.documentRemove).document,i=Tn(t,r.document),o=r.removedTargetIds||[],n=new on([],o,i,null);else{if(!("filter"in e))return E();e.filter;var h=e.filter;h.targetId,r=h.count||0,i=new Me(r),o=h.targetId,n=new sn(o,i)}return n}(this.D,t),n=function(t){if(!("targetChange"in t))return Jt.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?Jt.min():e.readTime?mn(e.readTime):Jt.min()}(t);return this.listener.Tr(e,n)},e.prototype.Ir=function(t){var e={};e.database=On(this.D),e.addTarget=function(t,e){var n,r=e.target;return(n=mt(r)?{documents:jn(t,r)}:{query:kn(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=vn(t,e.resumeToken):e.snapshotVersion.compareTo(Jt.min())>0&&(n.readTime=yn(t,e.snapshotVersion.toTimestamp())),n}(this.D,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return E()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.D,t);n&&(e.labels=n),this.wr(e)},e.prototype.Ar=function(t){var e={};e.database=On(this.D),e.removeTarget=t,this.wr(e)},e}(So),Ao=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).D=i,s.Rr=!1,s}return Object(h.c)(e,t),Object.defineProperty(e.prototype,"br",{get:function(){return this.Rr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.Rr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.mr=function(){this.Rr&&this.vr([])},e.prototype.Er=function(t){return this.er.Qi("Write",t)},e.prototype.onMessage=function(t){if(T(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Rr){this.rr.reset();var e=function(t,e){return t&&t.length>0?(T(void 0!==e),t.map((function(t){return function(t,e){var n=t.updateTime?mn(t.updateTime):mn(e);return n.isEqual(Jt.min())&&(n=mn(e)),new me(n,t.transformResults||[])}(t,e)}))):[]}(t.writeResults,t.commitTime),n=mn(t.commitTime);return this.listener.Pr(n,e)}return T(!t.writeResults||0===t.writeResults.length),this.Rr=!0,this.listener.Vr()},e.prototype.Sr=function(){var t={};t.database=On(this.D),this.wr(t)},e.prototype.vr=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return Nn(e.D,t)}))};this.wr(n)},e}(So),No=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.er=n,i.D=r,i.Dr=!1,i}return Object(h.c)(e,t),e.prototype.Cr=function(){if(this.Dr)throw new L(R.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Mi=function(t,e,n){var r=this;return this.Cr(),this.credentials.getToken().then((function(i){return r.er.Mi(t,e,n,i)})).catch((function(t){throw t.code===R.UNAUTHENTICATED&&r.credentials.invalidateToken(),t}))},e.prototype.Ui=function(t,e,n){var r=this;return this.Cr(),this.credentials.getToken().then((function(i){return r.er.Ui(t,e,n,i)})).catch((function(t){throw t.code===R.UNAUTHENTICATED&&r.credentials.invalidateToken(),t}))},e.prototype.terminate=function(){this.Dr=!1},e}((function(){})),Co=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.Nr=0,this.$r=null,this.Fr=!0}return t.prototype.Or=function(){var t=this;0===this.Nr&&(this.kr("Unknown"),this.$r=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return t.$r=null,t.Mr("Backend didn't respond within 10 seconds."),t.kr("Offline"),Promise.resolve()})))},t.prototype.Lr=function(t){"Online"===this.state?this.kr("Unknown"):(this.Nr++,this.Nr>=1&&(this.Br(),this.Mr("Connection failed 1 times. Most recent error: "+t.toString()),this.kr("Offline")))},t.prototype.set=function(t){this.Br(),this.Nr=0,"Online"===t&&(this.Fr=!1),this.kr(t)},t.prototype.kr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Mr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Fr?(v(e),this.Fr=!1):y("OnlineStateTracker",e)},t.prototype.Br=function(){null!==this.$r&&(this.$r.cancel(),this.$r=null)},t}(),jo=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.qr=[],this.Ur=new Map,this.Qr=new Set,this.Kr=[],this.Wr=i,this.Wr.pi((function(t){n.enqueueAndForget((function(){return Object(h.b)(o,void 0,void 0,(function(){return Object(h.d)(this,(function(t){switch(t.label){case 0:return Vo(this)?(y("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return Object(h.b)(this,void 0,void 0,(function(){var e;return Object(h.d)(this,(function(n){switch(n.label){case 0:return(e=I(t)).Qr.add(4),[4,xo(e)];case 1:return n.sent(),e.jr.set("Unknown"),e.Qr.delete(4),[4,ko(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.jr=new Co(n,r)};function ko(t){return Object(h.b)(this,void 0,void 0,(function(){var e,n;return Object(h.d)(this,(function(r){switch(r.label){case 0:if(!Vo(t))return[3,4];e=0,n=t.Kr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function xo(t){return Object(h.b)(this,void 0,void 0,(function(){var e,n;return Object(h.d)(this,(function(r){switch(r.label){case 0:e=0,n=t.Kr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Ro(t,e){var n=I(t);n.Ur.has(e.targetId)||(n.Ur.set(e.targetId,e),qo(n)?Fo(n):es(n).ar()&&Po(n,e))}function Lo(t,e){var n=I(t),r=es(n);n.Ur.delete(e),r.ar()&&Mo(n,e),0===n.Ur.size&&(r.ar()?r.lr():Vo(n)&&n.jr.set("Unknown"))}function Po(t,e){t.Gr.H(e.targetId),es(t).Ir(e)}function Mo(t,e){t.Gr.H(e),es(t).Ar(e)}function Fo(t){t.Gr=new cn({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},yt:function(e){return t.Ur.get(e)||null}}),es(t).start(),t.jr.Or()}function qo(t){return Vo(t)&&!es(t).cr()&&t.Ur.size>0}function Vo(t){return 0===I(t).Qr.size}function Uo(t){t.Gr=void 0}function Bo(t){return Object(h.b)(this,void 0,void 0,(function(){return Object(h.d)(this,(function(e){return t.Ur.forEach((function(e,n){Po(t,e)})),[2]}))}))}function Ko(t,e){return Object(h.b)(this,void 0,void 0,(function(){return Object(h.d)(this,(function(n){return Uo(t),qo(t)?(t.jr.Lr(e),Fo(t)):t.jr.set("Unknown"),[2]}))}))}function Go(t,e,n){return Object(h.b)(this,void 0,void 0,(function(){var r,i,o;return Object(h.d)(this,(function(s){switch(s.label){case 0:if(t.jr.set("Online"),!(e instanceof an&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return Object(h.b)(this,void 0,void 0,(function(){var n,r,i,o;return Object(h.d)(this,(function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?(o=i[r],t.Ur.has(o)?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]):[3,5];case 2:s.sent(),t.Ur.delete(o),t.Gr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}}))}))}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),y("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,zo(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof on?t.Gr.st(e):e instanceof sn?t.Gr.ht(e):t.Gr.ot(e),n.isEqual(Jt.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,Mi(t.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.Gr.dt(e);return n.targetChanges.forEach((function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.Ur.get(r);i&&t.Ur.set(r,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((function(e){var n=t.Ur.get(e);if(n){t.Ur.set(e,n.withResumeToken(B.EMPTY_BYTE_STRING,n.snapshotVersion)),Mo(t,e);var r=new Nr(n.target,e,1,n.sequenceNumber);Po(t,r)}})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return y("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,zo(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}}))}))}function zo(t,e,n){return Object(h.b)(this,void 0,void 0,(function(){var r=this;return Object(h.d)(this,(function(i){switch(i.label){case 0:if(!wr(e))throw e;return t.Qr.add(1),[4,xo(t)];case 1:return i.sent(),t.jr.set("Offline"),n||(n=function(){return Mi(t.localStore)}),t.asyncQueue.enqueueRetryable((function(){return Object(h.b)(r,void 0,void 0,(function(){return Object(h.d)(this,(function(e){switch(e.label){case 0:return y("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Qr.delete(1),[4,ko(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function Qo(t,e){return e().catch((function(n){return zo(t,n,e)}))}function Ho(t){return Object(h.b)(this,void 0,void 0,(function(){var e,n,r,i,o;return Object(h.d)(this,(function(s){switch(s.label){case 0:e=I(t),n=ns(e),r=e.qr.length>0?e.qr[e.qr.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return Vo(t)&&t.qr.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,Vi(e.localStore,r)];case 3:return null===(i=s.sent())?(0===e.qr.length&&n.lr(),[3,7]):(r=i.batchId,function(t,e){t.qr.push(e);var n=ns(t);n.ar()&&n.br&&n.vr(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,zo(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return Wo(e)&&Yo(e),[2]}}))}))}function Wo(t){return Vo(t)&&!ns(t).cr()&&t.qr.length>0}function Yo(t){ns(t).start()}function Xo(t){return Object(h.b)(this,void 0,void 0,(function(){return Object(h.d)(this,(function(e){return ns(t).Sr(),[2]}))}))}function Jo(t){return Object(h.b)(this,void 0,void 0,(function(){var e,n,r,i;return Object(h.d)(this,(function(o){for(e=ns(t),n=0,r=t.qr;n<r.length;n++)i=r[n],e.vr(i.mutations);return[2]}))}))}function $o(t,e,n){return Object(h.b)(this,void 0,void 0,(function(){var r,i;return Object(h.d)(this,(function(o){switch(o.label){case 0:return r=t.qr.shift(),i=Ar.from(r,e,n),[4,Qo(t,(function(){return t.remoteSyncer.applySuccessfulWrite(i)}))];case 1:return o.sent(),[4,Ho(t)];case 2:return o.sent(),[2]}}))}))}function Zo(t,e){return Object(h.b)(this,void 0,void 0,(function(){return Object(h.d)(this,(function(n){switch(n.label){case 0:return e&&ns(t).br?[4,function(t,e){return Object(h.b)(this,void 0,void 0,(function(){var n,r;return Object(h.d)(this,(function(i){switch(i.label){case 0:return Fe(r=e.code)&&r!==R.ABORTED?(n=t.qr.shift(),ns(t).hr(),[4,Qo(t,(function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)}))]):[3,3];case 1:return i.sent(),[4,Ho(t)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return Wo(t)&&Yo(t),[2]}}))}))}function ts(t,e){return Object(h.b)(this,void 0,void 0,(function(){var n;return Object(h.d)(this,(function(i){switch(i.label){case 0:return n=I(t),e?(n.Qr.delete(2),[4,ko(n)]):[3,2];case 1:return i.sent(),[3,5];case 2:return e?[3,4]:(n.Qr.add(2),[4,xo(n)]);case 3:i.sent(),n.jr.set("Unknown"),i.label=4;case 4:i.label=5;case 5:return[2]}}))}))}function es(t){var e=this;return t.zr||(t.zr=function(t,e,n){var r=I(t);return r.Cr(),new Do(e,r.er,r.credentials,r.D,n)}(t.datastore,t.asyncQueue,{Vi:Bo.bind(null,t),Di:Ko.bind(null,t),Tr:Go.bind(null,t)}),t.Kr.push((function(n){return Object(h.b)(e,void 0,void 0,(function(){return Object(h.d)(this,(function(e){switch(e.label){case 0:return n?(t.zr.hr(),qo(t)?Fo(t):t.jr.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.zr.stop()];case 2:e.sent(),Uo(t),e.label=3;case 3:return[2]}}))}))}))),t.zr}function ns(t){var e=this;return t.Hr||(t.Hr=function(t,e,n){var r=I(t);return r.Cr(),new Ao(e,r.er,r.credentials,r.D,n)}(t.datastore,t.asyncQueue,{Vi:Xo.bind(null,t),Di:Zo.bind(null,t),Vr:Jo.bind(null,t),Pr:$o.bind(null,t)}),t.Kr.push((function(n){return Object(h.b)(e,void 0,void 0,(function(){return Object(h.d)(this,(function(e){switch(e.label){case 0:return n?(t.Hr.hr(),[4,Ho(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Hr.stop()];case 3:e.sent(),t.qr.length>0&&(y("RemoteStore","Stopping write stream with "+t.qr.length+" pending writes"),t.qr=[]),e.label=4;case 4:return[2]}}))}))}))),t.Hr}var rs=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new dr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(t){}))}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout((function(){return e.handleDelayElapsed()}),t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new L(R.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget((function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then((function(e){return t.deferred.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function is(t,e){if(v("AsyncQueue",e+": "+t),wr(t))return new L(R.UNAVAILABLE,e+": "+t);throw t}var os=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||U.comparator(e.key,n.key)}:function(t,e){return U.comparator(t.key,e.key)},this.keyedMap=Ye(),this.sortedSet=new Ve(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),ss=function(){function t(){this.Jr=new Ve(U.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Jr.get(e);n?0!==t.type&&3===n.type?this.Jr=this.Jr.insert(e,t):3===t.type&&1!==n.type?this.Jr=this.Jr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Jr=this.Jr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Jr=this.Jr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Jr=this.Jr.remove(e):1===t.type&&2===n.type?this.Jr=this.Jr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Jr=this.Jr.insert(e,{type:2,doc:t.doc}):E():this.Jr=this.Jr.insert(e,t)},t.prototype.Yr=function(){var t=[];return this.Jr.inorderTraversal((function(e,n){t.push(n)})),t},t}(),as=function(){function t(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=u}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,os.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&zt(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),us=function(){this.Xr=void 0,this.listeners=[]},cs=function(){this.queries=new yi((function(t){return Qt(t)}),zt),this.onlineState="Unknown",this.Zr=new Set};function hs(t,e){return Object(h.b)(this,void 0,void 0,(function(){var n,r,i,o,s,u,a;return Object(h.d)(this,(function(c){switch(c.label){case 0:if(n=I(t),r=e.query,i=!1,(o=n.queries.get(r))||(i=!0,o=new us),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Xr=c.sent(),[3,4];case 3:return u=c.sent(),a=is(u,"Initialization of query '"+Ht(e.query)+"' failed"),[2,void e.onError(a)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.eo(n.onlineState),o.Xr&&e.no(o.Xr)&&ps(n),[2]}}))}))}function fs(t,e){return Object(h.b)(this,void 0,void 0,(function(){var n,r,i,o,s;return Object(h.d)(this,(function(u){return n=I(t),r=e.query,i=!1,(o=n.queries.get(r))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]}))}))}function ls(t,e){for(var n=I(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],u=s.query,a=n.queries.get(u);if(a){for(var c=0,h=a.listeners;c<h.length;c++)h[c].no(s)&&(r=!0);a.Xr=s}}r&&ps(n)}function ds(t,e,n){var r=I(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function ps(t){t.Zr.forEach((function(t){t.next()}))}var ys=function(){function t(t,e,n){this.query=t,this.so=e,this.io=!1,this.ro=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.no=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new as(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.io?this.oo(t)&&(this.so.next(t),o=!0):this.co(t,this.onlineState)&&(this.ao(t),o=!0),this.ro=t,o},t.prototype.onError=function(t){this.so.error(t)},t.prototype.eo=function(t){this.onlineState=t;var e=!1;return this.ro&&!this.io&&this.co(this.ro,t)&&(this.ao(this.ro),e=!0),e},t.prototype.co=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.uo&&n||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.oo=function(t){if(t.docChanges.length>0)return!0;var e=this.ro&&this.ro.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.ao=function(t){t=as.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.io=!0,this.so.next(t)},t}(),vs=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.ho=function(){return"metadata"in this.payload},t}(),gs=function(){function t(t){this.D=t}return t.prototype.Gn=function(t){return Tn(this.D,t)},t.prototype.zn=function(t){return t.metadata.exists?An(this.D,t.document,!1):new ft(this.Gn(t.metadata.name),this.Hn(t.metadata.readTime))},t.prototype.Hn=function(t){return mn(t)},t}();!function(){function t(t,e,n){this.lo=t,this.localStore=e,this.D=n,this.queries=[],this.documents=[],this.progress=ms(t)}t.prototype.fo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.wo=function(t){for(var e=new Map,n=new gs(this.D),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.Gn(o.metadata.name),u=0,a=o.metadata.queries;u<a.length;u++){var c=a[u],h=(e.get(c)||Ze()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return Object(h.b)(this,void 0,void 0,(function(){var t,e,n,r,i;return Object(h.d)(this,(function(o){switch(o.label){case 0:return[4,Hi(this.localStore,new gs(this.D),this.documents,this.lo.id)];case 1:t=o.sent(),e=this.wo(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?(i=r[n],[4,Wi(this.localStore,i,e.get(i.name))]):[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new Ni(Object.assign({},this.progress),t))]}}))}))}}();function ms(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}var bs=function(t){this.key=t},ws=function(t){this.key=t},Es=function(){function t(t,e){this.query=t,this._o=e,this.mo=null,this.current=!1,this.yo=Ze(),this.mutatedKeys=Ze(),this.po=Yt(t),this.Eo=new os(this.po)}return Object.defineProperty(t.prototype,"To",{get:function(){return this._o},enumerable:!1,configurable:!0}),t.prototype.Io=function(t,e){var n=this,r=e?e.Ao:new ss,i=e?e.Eo:this.Eo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,u=!1,a=Mt(this.query)&&i.size===this.query.limit?i.last():null,c=Ft(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((function(t,e){var h=i.get(t),f=e instanceof ht?e:null;f&&(f=Wt(n.query,f)?f:null);var l=!!h&&n.mutatedKeys.has(h.key),d=!!f&&(f.hasLocalMutations||n.mutatedKeys.has(f.key)&&f.hasCommittedMutations),p=!1;h&&f?h.data().isEqual(f.data())?l!==d&&(r.track({type:3,doc:f}),p=!0):n.Ro(h,f)||(r.track({type:2,doc:f}),p=!0,(a&&n.po(f,a)>0||c&&n.po(f,c)<0)&&(u=!0)):!h&&f?(r.track({type:0,doc:f}),p=!0):h&&!f&&(r.track({type:1,doc:h}),p=!0,(a||c)&&(u=!0)),p&&(f?(s=s.add(f),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),Mt(this.query)||Ft(this.query))for(;s.size>this.query.limit;){var h=Mt(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{Eo:s,Ao:r,Mn:u,mutatedKeys:o}},t.prototype.Ro=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.Eo;this.Eo=t.Eo,this.mutatedKeys=t.mutatedKeys;var o=t.Ao.Yr();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return E()}};return n(t)-n(e)}(t.type,e.type)||r.po(t.doc,e.doc)})),this.bo(n);var s=e?this.vo():[],u=0===this.yo.size&&this.current?1:0,a=u!==this.mo;return this.mo=u,0!==o.length||a?{snapshot:new as(this.query,t.Eo,i,o,t.mutatedKeys,0===u,a,!1),Po:s}:{Po:s}},t.prototype.eo=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Eo:this.Eo,Ao:new ss,mutatedKeys:this.mutatedKeys,Mn:!1},!1)):{Po:[]}},t.prototype.Vo=function(t){return!this._o.has(t)&&!!this.Eo.has(t)&&!this.Eo.get(t).hasLocalMutations},t.prototype.bo=function(t){var e=this;t&&(t.addedDocuments.forEach((function(t){return e._o=e._o.add(t)})),t.modifiedDocuments.forEach((function(t){})),t.removedDocuments.forEach((function(t){return e._o=e._o.delete(t)})),this.current=t.current)},t.prototype.vo=function(){var t=this;if(!this.current)return[];var e=this.yo;this.yo=Ze(),this.Eo.forEach((function(e){t.Vo(e.key)&&(t.yo=t.yo.add(e.key))}));var n=[];return e.forEach((function(e){t.yo.has(e)||n.push(new ws(e))})),this.yo.forEach((function(t){e.has(t)||n.push(new bs(t))})),n},t.prototype.So=function(t){this._o=t.jn,this.yo=Ze();var e=this.Io(t.documents);return this.applyChanges(e,!0)},t.prototype.Do=function(){return as.fromInitialDocuments(this.query,this.Eo,this.mutatedKeys,0===this.mo)},t}(),Ts=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Is=function(t){this.key=t,this.Co=!1},_s=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.xo={},this.No=new yi((function(t){return Qt(t)}),zt),this.$o=new Map,this.Fo=new Set,this.Oo=new Ve(U.comparator),this.ko=new Map,this.Mo=new Xi,this.Lo={},this.Bo=new Map,this.qo=ri.ne(),this.onlineState="Unknown",this.Uo=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.Uo},enumerable:!1,configurable:!0}),t}();function Os(t,e){return Object(h.b)(this,void 0,void 0,(function(){var n,r,i,o,s,u;return Object(h.d)(this,(function(a){switch(a.label){case 0:return n=ta(t),(o=n.No.get(e))?(r=o.targetId,n.sharedClientState.addLocalQueryTarget(r),i=o.view.Do(),[3,4]):[3,1];case 1:return[4,Ui(n.localStore,Kt(e))];case 2:return s=a.sent(),u=n.sharedClientState.addLocalQueryTarget(s.targetId),r=s.targetId,[4,Ss(n,e,r,"current"===u)];case 3:i=a.sent(),n.isPrimaryClient&&Ro(n.remoteStore,s),a.label=4;case 4:return[2,i]}}))}))}function Ss(t,e,n,r){return Object(h.b)(this,void 0,void 0,(function(){var i,o,s,u,a,c;return Object(h.d)(this,(function(f){switch(f.label){case 0:return t.Qo=function(e,n,r){return function(t,e,n,r){return Object(h.b)(this,void 0,void 0,(function(){var i,o,s;return Object(h.d)(this,(function(u){switch(u.label){case 0:return(i=e.view.Io(n)).Mn?[4,Ki(t.localStore,e.query,!1).then((function(t){var n=t.documents;return e.view.Io(n,i)}))]:[3,2];case 1:i=u.sent(),u.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),s=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(qs(t,e.targetId,s.Po),s.snapshot)]}}))}))}(t,e,n,r)},[4,Ki(t.localStore,e,!0)];case 1:return i=f.sent(),o=new Es(e,i.jn),s=o.Io(i.documents),u=rn.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),a=o.applyChanges(s,t.isPrimaryClient,u),qs(t,n,a.Po),c=new Ts(e,n,o),[2,(t.No.set(e,c),t.$o.has(n)?t.$o.get(n).push(e):t.$o.set(n,[e]),a.snapshot)]}}))}))}function Ds(t,e){return Object(h.b)(this,void 0,void 0,(function(){var n,r,i;return Object(h.d)(this,(function(o){switch(o.label){case 0:return n=I(t),r=n.No.get(e),(i=n.$o.get(r.targetId)).length>1?[2,(n.$o.set(r.targetId,i.filter((function(t){return!zt(t,e)}))),void n.No.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,Bi(n.localStore,r.targetId,!1).then((function(){n.sharedClientState.clearQueryState(r.targetId),Lo(n.remoteStore,r.targetId),Ms(n,r.targetId)})).catch(ai)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return Ms(n,r.targetId),[4,Bi(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}}))}))}function As(t,e,n){return Object(h.b)(this,void 0,void 0,(function(){var r,i,o,s;return Object(h.d)(this,(function(u){switch(u.label){case 0:r=ea(t),u.label=1;case 1:return u.trys.push([1,5,,6]),[4,function(t,e){var n,r=I(t),i=H.now(),o=e.reduce((function(t,e){return t.add(e.key)}),Ze());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return r.Kn.bn(t,o).next((function(o){n=o;for(var s=[],u=0,a=e;u<a.length;u++){var c=a[u],h=_e(c,n.get(c.key));null!=h&&s.push(new Ae(c.key,h,ee(h.proto.mapValue),be.exists(!0)))}return r.Tn.addMutationBatch(t,i,s,e)}))})).then((function(t){var e=t.applyToLocalDocumentSet(n);return{batchId:t.batchId,changes:e}}))}(r.localStore,e)];case 2:return i=u.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.Lo[t.currentUser.toKey()];r||(r=new Ve(S)),r=r.insert(e,n),t.Lo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,Bs(r,i.changes)];case 3:return u.sent(),[4,Ho(r.remoteStore)];case 4:return u.sent(),[3,6];case 5:return o=u.sent(),s=is(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}}))}))}function Ns(t,e){return Object(h.b)(this,void 0,void 0,(function(){var n,r;return Object(h.d)(this,(function(i){switch(i.label){case 0:n=I(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,Fi(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach((function(t,e){var r=n.ko.get(e);r&&(T(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.Co=!0:t.modifiedDocuments.size>0?T(r.Co):t.removedDocuments.size>0&&(T(r.Co),r.Co=!1))})),[4,Bs(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,ai(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function Cs(t,e,n){var r=I(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.No.forEach((function(t,n){var r=n.view.eo(e);r.snapshot&&i.push(r.snapshot)})),function(t,e){var n=I(t);n.onlineState=e;var r=!1;n.queries.forEach((function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].eo(e)&&(r=!0)})),r&&ps(n)}(r.eventManager,e),i.length&&r.xo.Tr(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function js(t,e,n){return Object(h.b)(this,void 0,void 0,(function(){var r,i,o,s,u,a;return Object(h.d)(this,(function(c){switch(c.label){case 0:return(r=I(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.ko.get(e),(o=i&&i.key)?(s=(s=new Ve(U.comparator)).insert(o,new ft(o,Jt.min())),u=Ze().add(o),a=new nn(Jt.min(),new Map,new Ke(S),s,u),[4,Ns(r,a)]):[3,2];case 1:return c.sent(),r.Oo=r.Oo.remove(o),r.ko.delete(e),Us(r),[3,4];case 2:return[4,Bi(r.localStore,e,!1).then((function(){return Ms(r,e,n)})).catch(ai)];case 3:c.sent(),c.label=4;case 4:return[2]}}))}))}function ks(t,e){return Object(h.b)(this,void 0,void 0,(function(){var n,r,i;return Object(h.d)(this,(function(o){switch(o.label){case 0:n=I(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,Pi(n.localStore,e)];case 2:return i=o.sent(),Ps(n,r,null),Ls(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,Bs(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,ai(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function xs(t,e,n){return Object(h.b)(this,void 0,void 0,(function(){var r,i;return Object(h.d)(this,(function(o){switch(o.label){case 0:r=I(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=I(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var r;return n.Tn.lookupMutationBatch(t,e).next((function(e){return T(null!==e),r=e.keys(),n.Tn.removeMutationBatch(t,e)})).next((function(){return n.Tn.performConsistencyCheck(t)})).next((function(){return n.Kn.bn(t,r)}))}))}(r.localStore,e)];case 2:return i=o.sent(),Ps(r,e,n),Ls(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,Bs(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,ai(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function Rs(t,e){return Object(h.b)(this,void 0,void 0,(function(){var n,r,i,o,s;return Object(h.d)(this,(function(u){switch(u.label){case 0:Vo((n=I(t)).remoteStore)||y("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,function(t){var e=I(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return e.Tn.getHighestUnacknowledgedBatchId(t)}))}(n.localStore)];case 2:return-1===(r=u.sent())?[2,void e.resolve()]:((i=n.Bo.get(r)||[]).push(e),n.Bo.set(r,i),[3,4]);case 3:return o=u.sent(),s=is(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}}))}))}function Ls(t,e){(t.Bo.get(e)||[]).forEach((function(t){t.resolve()})),t.Bo.delete(e)}function Ps(t,e,n){var r=I(t),i=r.Lo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.Lo[r.currentUser.toKey()]=i}}function Ms(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.$o.get(e);r<i.length;r++){var o=i[r];t.No.delete(o),n&&t.xo.Ko(o,n)}t.$o.delete(e),t.isPrimaryClient&&t.Mo.os(e).forEach((function(e){t.Mo.containsKey(e)||Fs(t,e)}))}function Fs(t,e){t.Fo.delete(e.path.canonicalString());var n=t.Oo.get(e);null!==n&&(Lo(t.remoteStore,n),t.Oo=t.Oo.remove(e),t.ko.delete(n),Us(t))}function qs(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof bs?(t.Mo.addReference(o.key,e),Vs(t,o)):o instanceof ws?(y("SyncEngine","Document no longer in limbo: "+o.key),t.Mo.removeReference(o.key,e),t.Mo.containsKey(o.key)||Fs(t,o.key)):E()}}function Vs(t,e){var n=e.key,r=n.path.canonicalString();t.Oo.get(n)||t.Fo.has(r)||(y("SyncEngine","New document in limbo: "+n),t.Fo.add(r),Us(t))}function Us(t){for(;t.Fo.size>0&&t.Oo.size<t.maxConcurrentLimboResolutions;){var e=t.Fo.values().next().value;t.Fo.delete(e);var n=new U(M.fromString(e)),r=t.qo.next();t.ko.set(r,new Is(n)),t.Oo=t.Oo.insert(n,r),Ro(t.remoteStore,new Nr(Kt(Pt(n.path)),r,2,f.o))}}function Bs(t,e,n){return Object(h.b)(this,void 0,void 0,(function(){var r,i,o,s;return Object(h.d)(this,(function(u){switch(u.label){case 0:return r=I(t),i=[],o=[],s=[],r.No.isEmpty()?[3,3]:(r.No.forEach((function(t,u){s.push(r.Qo(u,e,n).then((function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=ji.Nn(u.targetId,t);o.push(e)}})))})),[4,Promise.all(s)]);case 1:return u.sent(),r.xo.Tr(i),[4,function(t,e){return Object(h.b)(this,void 0,void 0,(function(){var n,r,i,o,s,u,a,c,f;return Object(h.d)(this,(function(h){switch(h.label){case 0:n=I(t),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return pr.forEach(e,(function(e){return pr.forEach(e.Cn,(function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)})).next((function(){return pr.forEach(e.xn,(function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)}))}))}))}))];case 2:return h.sent(),[3,4];case 3:if(!wr(r=h.sent()))throw r;return y("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)s=o[i],u=s.targetId,s.fromCache||(a=n.Bn.get(u),c=a.snapshotVersion,f=a.withLastLimboFreeSnapshotVersion(c),n.Bn=n.Bn.insert(u,f));return[2]}}))}))}(r.localStore,o)];case 2:u.sent(),u.label=3;case 3:return[2]}}))}))}function Ks(t,e){return Object(h.b)(this,void 0,void 0,(function(){var n,r;return Object(h.d)(this,(function(i){switch(i.label){case 0:return(n=I(t)).currentUser.isEqual(e)?[3,3]:(y("SyncEngine","User change. New user:",e.toKey()),[4,Li(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.Bo.forEach((function(t){t.forEach((function(t){t.reject(new L(R.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Bo.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,Bs(n,r.Wn)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}function Gs(t,e){var n=I(t),r=n.ko.get(e);if(r&&r.Co)return Ze().add(r.key);var i=Ze(),o=n.$o.get(e);if(!o)return i;for(var s=0,u=o;s<u.length;s++){var a=u[s],c=n.No.get(a);i=i.unionWith(c.view.To)}return i}function zs(t,e){return Object(h.b)(this,void 0,void 0,(function(){var n,r,i;return Object(h.d)(this,(function(o){switch(o.label){case 0:return[4,Ki((n=I(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.So(r),[2,(n.isPrimaryClient&&qs(n,e.targetId,i.Po),i)]}}))}))}function Qs(t){return Object(h.b)(this,void 0,void 0,(function(){var e;return Object(h.d)(this,(function(n){return[2,zi((e=I(t)).localStore).then((function(t){return Bs(e,t)}))]}))}))}function Hs(t,e,n,r){return Object(h.b)(this,void 0,void 0,(function(){var i,o;return Object(h.d)(this,(function(s){switch(s.label){case 0:return[4,function(t,e){var n=I(t),r=I(n.Tn);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return r.Jt(t,e).next((function(e){return e?n.Kn.bn(t,e):pr.resolve(null)}))}))}((i=I(t)).localStore,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,Ho(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Ps(i,e,r||null),Ls(i,e),function(t,e){I(I(t).Tn).Xt(e)}(i.localStore,e)):E(),s.label=4;case 4:return[4,Bs(i,o)];case 5:return s.sent(),[3,7];case 6:y("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}}))}))}function Ws(t,e){return Object(h.b)(this,void 0,void 0,(function(){var n,r,i,o,s,u,a,c;return Object(h.d)(this,(function(h){switch(h.label){case 0:return ta(n=I(t)),ea(n),!0!==e||!0===n.Uo?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,Ys(n,r.toArray())]);case 1:return i=h.sent(),n.Uo=!0,[4,ts(n.remoteStore,!0)];case 2:for(h.sent(),o=0,s=i;o<s.length;o++)u=s[o],Ro(n.remoteStore,u);return[3,7];case 3:return!1!==e||!1===n.Uo?[3,7]:(a=[],c=Promise.resolve(),n.$o.forEach((function(t,e){n.sharedClientState.isLocalQueryTarget(e)?a.push(e):c=c.then((function(){return Ms(n,e),Bi(n.localStore,e,!0)})),Lo(n.remoteStore,e)})),[4,c]);case 4:return h.sent(),[4,Ys(n,a)];case 5:return h.sent(),function(t){var e=I(t);e.ko.forEach((function(t,n){Lo(e.remoteStore,n)})),e.Mo.cs(),e.ko=new Map,e.Oo=new Ve(U.comparator)}(n),n.Uo=!1,[4,ts(n.remoteStore,!1)];case 6:h.sent(),h.label=7;case 7:return[2]}}))}))}function Ys(t,e,n){return Object(h.b)(this,void 0,void 0,(function(){var n,r,i,o,s,u,a,c,f,l,d,y,p,v;return Object(h.d)(this,(function(h){switch(h.label){case 0:n=I(t),r=[],i=[],o=0,s=e,h.label=1;case 1:return o<s.length?(u=s[o],a=void 0,(c=n.$o.get(u))&&0!==c.length?[4,Ui(n.localStore,Kt(c[0]))]:[3,7]):[3,13];case 2:a=h.sent(),f=0,l=c,h.label=3;case 3:return f<l.length?(d=l[f],y=n.No.get(d),[4,zs(n,y)]):[3,6];case 4:(p=h.sent()).snapshot&&i.push(p.snapshot),h.label=5;case 5:return f++,[3,3];case 6:return[3,11];case 7:return[4,Gi(n.localStore,u)];case 8:return v=h.sent(),[4,Ui(n.localStore,v)];case 9:return a=h.sent(),[4,Ss(n,Xs(v),u,!1)];case 10:h.sent(),h.label=11;case 11:r.push(a),h.label=12;case 12:return o++,[3,1];case 13:return[2,(n.xo.Tr(i),r)]}}))}))}function Xs(t){return Lt(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Js(t){var e=I(t);return I(I(e.localStore).persistence).gn()}function $s(t,e,n,r){return Object(h.b)(this,void 0,void 0,(function(){var i,o,s;return Object(h.d)(this,(function(u){switch(u.label){case 0:return(i=I(t)).Uo?(y("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.$o.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,zi(i.localStore)];case 3:return o=u.sent(),s=nn.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,Bs(i,o,s)];case 4:return u.sent(),[3,8];case 5:return[4,Bi(i.localStore,e,!0)];case 6:return u.sent(),Ms(i,e,r),[3,8];case 7:E(),u.label=8;case 8:return[2]}}))}))}function Zs(t,e,n){return Object(h.b)(this,void 0,void 0,(function(){var r,i,o,s,u,a,c,f,l,d;return Object(h.d)(this,(function(v){switch(v.label){case 0:if(!(r=ta(t)).Uo)return[3,10];i=0,o=e,v.label=1;case 1:return i<o.length?(s=o[i],r.$o.has(s)?(y("SyncEngine","Adding an already active target "+s),[3,5]):[4,Gi(r.localStore,s)]):[3,6];case 2:return u=v.sent(),[4,Ui(r.localStore,u)];case 3:return a=v.sent(),[4,Ss(r,Xs(u),a.targetId,!1)];case 4:v.sent(),Ro(r.remoteStore,a),v.label=5;case 5:return i++,[3,1];case 6:c=function(t){return Object(h.d)(this,(function(e){switch(e.label){case 0:return r.$o.has(t)?[4,Bi(r.localStore,t,!1).then((function(){Lo(r.remoteStore,t),Ms(r,t)})).catch(ai)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},f=0,l=n,v.label=7;case 7:return f<l.length?(d=l[f],[5,c(d)]):[3,10];case 8:v.sent(),v.label=9;case 9:return f++,[3,7];case 10:return[2]}}))}))}function ta(t){var e=I(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Ns.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Gs.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=js.bind(null,e),e.xo.Tr=ls.bind(null,e.eventManager),e.xo.Ko=ds.bind(null,e.eventManager),e}function ea(t){var e=I(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=ks.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=xs.bind(null,e),e}var na=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return Object(h.b)(this,void 0,void 0,(function(){return Object(h.d)(this,(function(e){switch(e.label){case 0:return this.D=_o(t.databaseInfo.databaseId),this.sharedClientState=this.jo(t),this.persistence=this.Go(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.zo(t),this.localStore=this.Ho(t),[2]}}))}))},t.prototype.zo=function(t){return null},t.prototype.Ho=function(t){return Ri(this.persistence,new ki,t.initialUser,this.D)},t.prototype.Go=function(t){return new no(io.Cs,this.D)},t.prototype.jo=function(t){return new vo},t.prototype.terminate=function(){return Object(h.b)(this,void 0,void 0,(function(){return Object(h.d)(this,(function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}}))}))},t}(),ra=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Jo=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return Object(h.c)(e,t),e.prototype.initialize=function(e){return Object(h.b)(this,void 0,void 0,(function(){return Object(h.d)(this,(function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,Qi(this.localStore)];case 2:return n.sent(),[4,this.Jo.initialize(this,e)];case 3:return n.sent(),[4,ea(this.Jo.syncEngine)];case 4:return n.sent(),[4,Ho(this.Jo.remoteStore)];case 5:return n.sent(),[2]}}))}))},e.prototype.Ho=function(t){return Ri(this.persistence,new ki,t.initialUser,this.D)},e.prototype.zo=function(t){var e=this.persistence.referenceDelegate.garbageCollector;return new hi(e,t.asyncQueue)},e.prototype.Go=function(t){var e=Ai(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Yr.withCacheSize(this.cacheSizeBytes):Yr.DEFAULT;return new Oi(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,To(),Io(),this.D,this.sharedClientState,!!this.forceOwnership)},e.prototype.jo=function(t){return new vo},e}(na),ia=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Jo=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return Object(h.c)(e,t),e.prototype.initialize=function(e){return Object(h.b)(this,void 0,void 0,(function(){var n,r=this;return Object(h.d)(this,(function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Jo.syncEngine,this.sharedClientState instanceof yo?(this.sharedClientState.syncEngine={wi:Hs.bind(null,n),_i:$s.bind(null,n),mi:Zs.bind(null,n),gn:Js.bind(null,n),di:Qs.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.en((function(t){return Object(h.b)(r,void 0,void 0,(function(){return Object(h.d)(this,(function(e){switch(e.label){case 0:return[4,Ws(this.Jo.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}}))}))}))];case 4:return i.sent(),[2]}}))}))},e.prototype.jo=function(t){var e=To();if(!yo.At(e))throw new L(R.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Ai(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new yo(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(ra),oa=function(){function t(){}return t.prototype.initialize=function(t,e){return Object(h.b)(this,void 0,void 0,(function(){var n=this;return Object(h.d)(this,(function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return Cs(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Ks.bind(null,this.syncEngine),[4,ts(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.createEventManager=function(t){return new cs},t.prototype.createDatastore=function(t){var e,n=_o(t.databaseInfo.databaseId),r=(e=t.databaseInfo,new Eo(e));return function(t,e,n){return new No(t,e,n)}(t.credentials,r,n)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return Cs(s.syncEngine,t,0)},o=mo.At()?new mo:new go,new jo(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var u=new _s(t,e,n,r,i,o);return s&&(u.Uo=!0),u}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return Object(h.b)(this,void 0,void 0,(function(){var e;return Object(h.d)(this,(function(n){switch(n.label){case 0:return e=I(t),y("RemoteStore","RemoteStore shutting down."),e.Qr.add(5),[4,xo(e)];case 1:return n.sent(),e.Wr.shutdown(),e.jr.set("Unknown"),[2]}}))}))}(this.remoteStore)},t}();var sa=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.Yo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.Yo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Xo=function(){this.muted=!0},t.prototype.Yo=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}(),aa=(function(){function t(t,e){var n=this;this.Zo=t,this.D=e,this.metadata=new dr,this.buffer=new Uint8Array,this.tc=new TextDecoder("utf-8"),this.ec().then((function(t){t&&t.ho()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))}),(function(t){return n.metadata.reject(t)}))}t.prototype.close=function(){return this.Zo.cancel()},t.prototype.getMetadata=function(){return Object(h.b)(this,void 0,void 0,(function(){return Object(h.d)(this,(function(t){return[2,this.metadata.promise]}))}))},t.prototype.Wo=function(){return Object(h.b)(this,void 0,void 0,(function(){return Object(h.d)(this,(function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.ec())]}}))}))},t.prototype.ec=function(){return Object(h.b)(this,void 0,void 0,(function(){var t,e,n,r;return Object(h.d)(this,(function(i){switch(i.label){case 0:return[4,this.nc()];case 1:return null===(t=i.sent())?[2,null]:(e=this.tc.decode(t),n=Number(e),isNaN(n)&&this.sc("length string ("+e+") is not valid number"),[4,this.ic(n)]);case 2:return r=i.sent(),[2,new vs(JSON.parse(r),t.length+n)]}}))}))},t.prototype.rc=function(){return this.buffer.findIndex((function(t){return t==="{".charCodeAt(0)}))},t.prototype.nc=function(){return Object(h.b)(this,void 0,void 0,(function(){var t,e;return Object(h.d)(this,(function(n){switch(n.label){case 0:return this.rc()<0?[4,this.oc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.rc())<0&&this.sc("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}}))}))},t.prototype.ic=function(t){return Object(h.b)(this,void 0,void 0,(function(){var e;return Object(h.d)(this,(function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.oc()]:[3,3];case 1:n.sent()&&this.sc("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.tc.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}}))}))},t.prototype.sc=function(t){throw this.Zo.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.oc=function(){return Object(h.b)(this,void 0,void 0,(function(){var t,e;return Object(h.d)(this,(function(n){switch(n.label){case 0:return[4,this.Zo.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}}))}))}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return Object(h.b)(this,void 0,void 0,(function(){var e,n=this;return Object(h.d)(this,(function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new L(R.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return Object(h.b)(this,void 0,void 0,(function(){var n,r,i,o,s,u;return Object(h.d)(this,(function(a){switch(a.label){case 0:return n=I(t),r=On(n.D)+"/documents",i={documents:e.map((function(t){return En(n.D,t)}))},[4,n.Ui("BatchGetDocuments",r,i)];case 1:return o=a.sent(),s=new Map,o.forEach((function(t){var e=function(t,e){return"found"in e?function(t,e){T(!!e.found),e.found.name,e.found.updateTime;var n=Tn(t,e.found.name),r=mn(e.found.updateTime),i=new Zt({mapValue:{fields:e.found.fields}});return new ht(n,r,i,{})}(t,e):"missing"in e?function(t,e){T(!!e.missing),T(!!e.readTime);var n=Tn(t,e.missing),r=mn(e.readTime);return new ft(n,r)}(t,e):E()}(n.D,t);s.set(e.key.toString(),e)})),u=[],[2,(e.forEach((function(t){var e=s.get(t.toString());T(!!e),u.push(e)})),u)]}}))}))}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach((function(t){t instanceof ft||t instanceof ht?n.recordVersion(t):E()})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new Le(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return Object(h.b)(this,void 0,void 0,(function(){var t,e=this;return Object(h.d)(this,(function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=U.fromPath(n);e.mutations.push(new Pe(r,e.precondition(r)))})),[4,function(t,e){return Object(h.b)(this,void 0,void 0,(function(){var n,r,i;return Object(h.d)(this,(function(o){switch(o.label){case 0:return n=I(t),r=On(n.D)+"/documents",i={writes:e.map((function(t){return Nn(n.D,t)}))},[4,n.Mi("Commit",r,i)];case 1:return o.sent(),[2]}}))}))}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}}))}))},t.prototype.recordVersion=function(t){var e;if(t instanceof ht)e=t.version;else{if(!(t instanceof ft))throw E();e=Jt.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new L(R.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?be.updateTime(e):be.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(Jt.min()))throw new L(R.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return be.updateTime(e)}return be.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),ua=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.cc=5,this.rr=new Oo(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.ac()},t.prototype.ac=function(){var t=this;this.rr.Yi((function(){return Object(h.b)(t,void 0,void 0,(function(){var t,e,n=this;return Object(h.d)(this,(function(r){return t=new aa(this.datastore),(e=this.uc(t))&&e.then((function(e){n.asyncQueue.enqueueAndForget((function(){return t.commit().then((function(){n.deferred.resolve(e)})).catch((function(t){n.hc(t)}))}))})).catch((function(t){n.hc(t)})),[2]}))}))}))},t.prototype.uc=function(t){try{var e=this.updateFunction(t);return!j(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.hc=function(t){var e=this;this.cc>0&&this.lc(t)?(this.cc-=1,this.asyncQueue.enqueueAndForget((function(){return e.ac(),Promise.resolve()}))):this.deferred.reject(t)},t.prototype.lc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Fe(e)}return!1},t}(),ca=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=oo.UNAUTHENTICATED,this.clientId=O.u(),this.credentialListener=function(){},this.receivedInitialUser=new dr,this.credentials.setChangeListener((function(t){y("FirestoreClient","Received user=",t.uid),r.user=t,r.credentialListener(t),r.receivedInitialUser.resolve()}))}return t.prototype.getConfiguration=function(){return Object(h.b)(this,void 0,void 0,(function(){return Object(h.d)(this,(function(t){switch(t.label){case 0:return[4,this.receivedInitialUser.promise];case 1:return[2,(t.sent(),{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100})]}}))}))},t.prototype.setCredentialChangeListener=function(t){var e=this;this.credentialListener=t,this.receivedInitialUser.promise.then((function(){return e.credentialListener(e.user)}))},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new L(R.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new dr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((function(){return Object(h.b)(t,void 0,void 0,(function(){var t,n;return Object(h.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=is(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}}))}))})),e.promise},t}();function ha(t,e){return Object(h.b)(this,void 0,void 0,(function(){var n,r,i=this;return Object(h.d)(this,(function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),y("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener((function(n){r.isEqual(n)||(r=n,t.asyncQueue.enqueueRetryable((function(){return Object(h.b)(i,void 0,void 0,(function(){return Object(h.d)(this,(function(t){switch(t.label){case 0:return[4,Li(e.localStore,n)];case 1:return t.sent(),[2]}}))}))})))})),e.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=e,[2]}}))}))}function fa(t,e){return Object(h.b)(this,void 0,void 0,(function(){var n,r;return Object(h.d)(this,(function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,la(t)];case 1:return n=i.sent(),y("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener((function(n){return t.asyncQueue.enqueueRetryable((function(){return function(t,e){return Object(h.b)(this,void 0,void 0,(function(){var n,r;return Object(h.d)(this,(function(i){switch(i.label){case 0:return(n=I(t)).asyncQueue.verifyOperationInProgress(),y("RemoteStore","RemoteStore received new credentials"),r=Vo(n),n.Qr.add(3),[4,xo(n)];case 1:return i.sent(),r&&n.jr.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.Qr.delete(3),[4,ko(n)];case 3:return i.sent(),[2]}}))}))}(e.remoteStore,n)}))})),t.onlineComponents=e,[2]}}))}))}function la(t){return Object(h.b)(this,void 0,void 0,(function(){return Object(h.d)(this,(function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(y("FirestoreClient","Using default OfflineComponentProvider"),[4,ha(t,new na)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}}))}))}function da(t){return Object(h.b)(this,void 0,void 0,(function(){return Object(h.d)(this,(function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(y("FirestoreClient","Using default OnlineComponentProvider"),[4,fa(t,new oa)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}}))}))}function pa(t){return la(t).then((function(t){return t.persistence}))}function ya(t){return la(t).then((function(t){return t.localStore}))}function va(t){return da(t).then((function(t){return t.remoteStore}))}function ga(t){return da(t).then((function(t){return t.syncEngine}))}function ma(t){return Object(h.b)(this,void 0,void 0,(function(){var e,n;return Object(h.d)(this,(function(r){switch(r.label){case 0:return[4,da(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=Os.bind(null,e.syncEngine),n.onUnlisten=Ds.bind(null,e.syncEngine),n)]}}))}))}function ba(t,e,n){var r=this;void 0===n&&(n={});var i=new dr;return t.asyncQueue.enqueueAndForget((function(){return Object(h.b)(r,void 0,void 0,(function(){var r;return Object(h.d)(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new sa({next:function(o){e.enqueueAndForget((function(){return fs(t,s)}));var u=o.docs.has(n);!u&&o.fromCache?i.reject(new L(R.UNAVAILABLE,"Failed to get document because the client is offline.")):u&&o.fromCache&&r&&"server"===r.source?i.reject(new L(R.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new ys(Pt(n.path),o,{includeMetadataChanges:!0,uo:!0});return hs(t,s)},[4,ma(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}}))}))})),i.promise}function wa(t,e,n){var r=this;void 0===n&&(n={});var i=new dr;return t.asyncQueue.enqueueAndForget((function(){return Object(h.b)(r,void 0,void 0,(function(){var r;return Object(h.d)(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new sa({next:function(n){e.enqueueAndForget((function(){return fs(t,s)})),n.fromCache&&"server"===r.source?i.reject(new L(R.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new ys(n,o,{includeMetadataChanges:!0,uo:!0});return hs(t,s)},[4,ma(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}}))}))})),i.promise}var Ea=function(t,e,n,r,i,o){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i,this.autoDetectLongPolling=o},Ta=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),Ia=new Map,_a=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},Oa=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){this.changeListener=t,t(oo.UNAUTHENTICATED)},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Sa=function(){function t(t){var e=this;this.fc=null,this.currentUser=oo.UNAUTHENTICATED,this.receivedInitialUser=!1,this.dc=0,this.changeListener=null,this.forceRefresh=!1,this.fc=function(){e.dc++,e.currentUser=e.wc(),e.receivedInitialUser=!0,e.changeListener&&e.changeListener(e.currentUser)},this.dc=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.fc):(this.fc(null),t.get().then((function(t){e.auth=t,e.fc&&e.auth.addAuthTokenListener(e.fc)}),(function(){})))}return t.prototype.getToken=function(){var t=this,e=this.dc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.dc!==e?(y("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(T("string"==typeof n.accessToken),new _a(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t){this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.fc),this.fc=null,this.changeListener=null},t.prototype.wc=function(){var t=this.auth&&this.auth.getUid();return T(null===t||"string"==typeof t),new oo(t)},t}(),Da=function(){function t(t,e){this._c=t,this.mc=e,this.type="FirstParty",this.user=oo.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.mc},e=this._c.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),t}(),Aa=function(){function t(t,e){this._c=t,this.mc=e}return t.prototype.getToken=function(){return Promise.resolve(new Da(this._c,this.mc))},t.prototype.setChangeListener=function(t){t(oo.FIRST_PARTY)},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function Na(t,e,n){if(!n)throw new L(R.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Ca(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new L(R.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function ja(t,e,n,r){if(!0===e&&!0===r)throw new L(R.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function ka(t){if(!U.isDocumentKey(t))throw new L(R.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function xa(t){if(U.isDocumentKey(t))throw new L(R.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function Ra(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":E()}function La(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new L(R.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Ra(t);throw new L(R.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function Pa(t,e){if(e<=0)throw new L(R.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var Ma=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new L(R.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new L(R.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,ja("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),Fa=function(){function t(t,e){this._persistenceKey="(lite)",this._settings=new Ma({}),this._settingsFrozen=!1,t instanceof Ta?(this._databaseId=t,this._credentials=new Oa):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new L(R.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ta(t.options.projectId)}(t),this._credentials=new Sa(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new L(R.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new L(R.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ma(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new Oa;switch(t.type){case"gapi":var e=t.client;return T(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Aa(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new L(R.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return this,(t=Ia.get(this))&&(y("ComponentProvider","Removing Datastore"),Ia.delete(this),t.terminate()),Promise.resolve();var t},t}(),qa=function(t){this._delegate=t},Va=function(){function t(t,e,n){this._converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Ba(this.firestore,this._converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),Ua=function(){function t(t,e,n){this._converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),Ba=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,Pt(r))||this).firestore=e,i._path=r,i.type="collection",i}return Object(h.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new Va(this.firestore,null,new U(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(Ua);function Ka(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t instanceof qa&&(t=t._delegate),Na("collection","path",e),t instanceof Fa)return xa(n=M.fromString.apply(M,Object(h.f)([e],r))),new Ba(t,null,n);if(!(t instanceof Va||t instanceof Ba))throw new L(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return xa(n=M.fromString.apply(M,Object(h.f)([t.path],r)).child(M.fromString(e))),new Ba(t.firestore,null,n)}function Ga(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t instanceof qa&&(t=t._delegate),1===arguments.length&&(e=O.u()),Na("doc","path",e),t instanceof Fa)return ka(n=M.fromString.apply(M,Object(h.f)([e],r))),new Va(t,null,new U(n));if(!(t instanceof Va||t instanceof Ba))throw new L(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return ka(n=t._path.child(M.fromString.apply(M,Object(h.f)([e],r)))),new Va(t.firestore,t instanceof Ba?t._converter:null,new U(n))}function za(t,e){return t instanceof qa&&(t=t._delegate),e instanceof qa&&(e=e._delegate),(t instanceof Va||t instanceof Ba)&&(e instanceof Va||e instanceof Ba)&&t.firestore===e.firestore&&t.path===e.path&&t._converter===e._converter}function Qa(t,e){return t instanceof qa&&(t=t._delegate),e instanceof qa&&(e=e._delegate),t instanceof Ua&&e instanceof Ua&&t.firestore===e.firestore&&zt(t._query,e._query)&&t._converter===e._converter}var Ha=function(){function t(){var t=this;this.yc=Promise.resolve(),this.gc=[],this.Ec=!1,this.Tc=[],this.Ic=null,this.Ac=!1,this.Rc=[],this.rr=new Oo(this,"async_queue_retry"),this.bc=function(){var e=Io();e&&y("AsyncQueue","Visibility state changed to "+e.visibilityState),t.rr.Zi()};var e=Io();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.bc)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this.Ec},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.vc(),this.Pc(t)},t.prototype.enterRestrictedMode=function(){if(!this.Ec){this.Ec=!0;var t=Io();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.bc)}},t.prototype.enqueue=function(t){return this.vc(),this.Ec?new Promise((function(t){})):this.Pc(t)},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget((function(){return e.gc.push(t),e.Vc()}))},t.prototype.Vc=function(){return Object(h.b)(this,void 0,void 0,(function(){var t,e=this;return Object(h.d)(this,(function(n){switch(n.label){case 0:if(0===this.gc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.gc[0]()];case 2:return n.sent(),this.gc.shift(),this.rr.reset(),[3,4];case 3:if(!wr(t=n.sent()))throw t;return y("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.gc.length>0&&this.rr.Yi((function(){return e.Vc()})),n.label=5;case 5:return[2]}}))}))},t.prototype.Pc=function(t){var e=this,n=this.yc.then((function(){return e.Ac=!0,t().catch((function(t){throw e.Ic=t,e.Ac=!1,v("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((function(t){return e.Ac=!1,t}))}));return this.yc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.vc(),this.Rc.indexOf(t)>-1&&(e=0);var i=rs.createAndSchedule(this,t,e,n,(function(t){return r.Sc(t)}));return this.Tc.push(i),i},t.prototype.vc=function(){this.Ic&&E()},t.prototype.verifyOperationInProgress=function(){},t.prototype.Dc=function(){return Object(h.b)(this,void 0,void 0,(function(){var t;return Object(h.d)(this,(function(e){switch(e.label){case 0:return[4,t=this.yc];case 1:e.sent(),e.label=2;case 2:if(t!==this.yc)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.Cc=function(t){for(var e=0,n=this.Tc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.xc=function(t){var e=this;return this.Dc().then((function(){e.Tc.sort((function(t,e){return t.targetTimeMs-e.targetTimeMs}));for(var n=0,r=e.Tc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.Dc()}))},t.prototype.Nc=function(t){this.Rc.push(t)},t.prototype.Sc=function(t){var e=this.Tc.indexOf(t);this.Tc.splice(e,1)},t}();function Wa(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new dr,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var Ya=-1,Xa=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._queue=new Ha,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return Object(h.c)(e,t),e.prototype._terminate=function(){return this._firestoreClient||$a(this),this._firestoreClient.terminate()},e}(Fa);function Ja(t){return t._firestoreClient||$a(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function $a(t){var e=t._freezeSettings(),n=function(t,e,n){return new Ea(t,e,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling)}(t._databaseId,t._persistenceKey,e);t._firestoreClient=new ca(t._credentials,t._queue,n)}function Za(t,e,n){var r=this,i=new dr;return t.asyncQueue.enqueue((function(){return Object(h.b)(r,void 0,void 0,(function(){var r;return Object(h.d)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,ha(t,n)];case 1:return o.sent(),[4,fa(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===R.FAILED_PRECONDITION||t.code===R.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}}))}))})).then((function(){return i.promise}))}function tu(t){if(t._initialized||t._terminated)throw new L(R.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var eu=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new L(R.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new V(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),nu=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(B.fromBase64String(e))}catch(e){throw new L(R.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(B.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),ru=function(t){this._methodName=t},iu=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new L(R.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new L(R.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return S(this._lat,t._lat)||S(this._long,t._long)},t}(),ou=/^__.*__$/,su=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new Ae(t,this.data,this.fieldMask,e,this.fieldTransforms):new De(t,this.data,e,this.fieldTransforms)},t}(),au=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new Ae(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function uu(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw E()}}var cu=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.D=n,this.ignoreUndefinedProperties=r,void 0===i&&this.$c(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Fc",{get:function(){return this.settings.Fc},enumerable:!1,configurable:!0}),t.prototype.Oc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.D,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.kc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Oc({path:n,Mc:!1});return r.Lc(t),r},t.prototype.Bc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Oc({path:n,Mc:!1});return r.$c(),r},t.prototype.qc=function(t){return this.Oc({path:void 0,Mc:!0})},t.prototype.Uc=function(t){return Nu(t,this.settings.methodName,this.settings.Qc||!1,this.path,this.settings.Kc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find((function(e){return t.isPrefixOf(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.isPrefixOf(e.field)}))},t.prototype.$c=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Lc(this.path.get(t))},t.prototype.Lc=function(t){if(0===t.length)throw this.Uc("Document fields must not be empty");if(uu(this.Fc)&&ou.test(t))throw this.Uc('Document fields cannot begin and end with "__"')},t}(),hu=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.D=n||_o(t)}return t.prototype.Wc=function(t,e,n,r){return void 0===r&&(r=!1),new cu({Fc:t,methodName:e,Kc:n,path:V.emptyPath(),Mc:!1,Qc:r},this.databaseId,this.D,this.ignoreUndefinedProperties)},t}();function fu(t){var e=t._freezeSettings(),n=_o(t._databaseId);return new hu(t._databaseId,!!e.ignoreUndefinedProperties,n)}function lu(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Wc(o.merge||o.mergeFields?2:0,e,n,i);Ou("Data must be an object, but it was:",s,r);var u,a,c=Iu(r,s);if(o.merge)u=new $t(s.fieldMask),a=s.fieldTransforms;else if(o.mergeFields){for(var h=[],f=0,l=o.mergeFields;f<l.length;f++){var d=Su(e,l[f],n);if(!s.contains(d))throw new L(R.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");Cu(h,d)||h.push(d)}u=new $t(h),a=s.fieldTransforms.filter((function(t){return u.covers(t.field)}))}else u=null,a=s.fieldTransforms;return new su(new Zt(c),u,a)}var du=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(h.c)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Fc)throw 1===t.Fc?t.Uc(this._methodName+"() can only appear at the top level of your update data"):t.Uc(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(ru);function pu(t,e,n){return new cu({Fc:3,Kc:e.settings.Kc,methodName:t._methodName,Mc:n},e.databaseId,e.D,e.ignoreUndefinedProperties)}var yu=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(h.c)(e,t),e.prototype._toFieldTransform=function(t){return new ge(t.path,new ce)},e.prototype.isEqual=function(t){return t instanceof e},e}(ru),vu=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).jc=n,r}return Object(h.c)(e,t),e.prototype._toFieldTransform=function(t){var e=pu(this,t,!0),n=this.jc.map((function(t){return Tu(t,e)})),r=new he(n);return new ge(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(ru),gu=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).jc=n,r}return Object(h.c)(e,t),e.prototype._toFieldTransform=function(t){var e=pu(this,t,!0),n=this.jc.map((function(t){return Tu(t,e)})),r=new le(n);return new ge(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(ru),mu=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Gc=n,r}return Object(h.c)(e,t),e.prototype._toFieldTransform=function(t){var e=new pe(t.D,ie(t.D,this.Gc));return new ge(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(ru);function bu(t,e,n,r){var i=t.Wc(1,e,n);Ou("Data must be an object, but it was:",i,r);var o=[],s=new te;C(r,(function(t,r){var u=Au(e,t,n);r instanceof qa&&(r=r._delegate);var a=i.Bc(u);if(r instanceof du)o.push(u);else{var c=Tu(r,a);null!=c&&(o.push(u),s.set(u,c))}}));var u=new $t(o);return new au(s.v(),u,i.fieldTransforms)}function wu(t,e,n,r,i,o){var s=t.Wc(1,e,n),u=[Su(e,r,n)],a=[i];if(o.length%2!=0)throw new L(R.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)u.push(Su(e,o[c])),a.push(o[c+1]);for(var h=[],f=new te,l=u.length-1;l>=0;--l)if(!Cu(h,u[l])){var d=u[l],p=a[l];p instanceof qa&&(p=p._delegate);var y=s.Bc(d);if(p instanceof du)h.push(d);else{var v=Tu(p,y);null!=v&&(h.push(d),f.set(d,v))}}var m=new $t(h);return new au(f.v(),m,s.fieldTransforms)}function Eu(t,e,n,r){return void 0===r&&(r=!1),Tu(n,t.Wc(r?4:3,e))}function Tu(t,e){if(t instanceof qa&&(t=t._delegate),_u(t))return Ou("Unsupported field value:",e,t),Iu(t,e);if(t instanceof ru)return function(t,e){if(!uu(e.Fc))throw e.Uc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Uc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Mc&&4!==e.Fc)throw e.Uc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Tu(o[i],e.qc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(t instanceof qa&&(t=t._delegate),null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return ie(e.D,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=H.fromDate(t);return{timestampValue:yn(e.D,n)}}if(t instanceof H)return n=new H(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:yn(e.D,n)};if(t instanceof iu)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof nu)return{bytesValue:vn(e.D,t._byteString)};if(t instanceof Va){n=e.databaseId;var r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Uc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:bn(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Uc("Unsupported field value: "+Ra(t))}(t,e)}function Iu(t,e){var n={};return q(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):C(t,(function(t,r){var i=Tu(r,e.kc(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function _u(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof H||t instanceof iu||t instanceof nu||t instanceof Va||t instanceof ru)}function Ou(t,e,n){if(!_u(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=Ra(n);throw"an object"===r?e.Uc(t+" a custom object"):e.Uc(t+" "+r)}}function Su(t,e,n){if(e instanceof qa&&(e=e._delegate),e instanceof eu)return e._internalPath;if("string"==typeof e)return Au(t,e);throw Nu("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Du=new RegExp("[~\\*/\\[\\]]");function Au(t,e,n){if(e.search(Du)>=0)throw Nu("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(eu.bind.apply(eu,Object(h.f)([void 0],e.split(".")))))._internalPath}catch(r){throw Nu("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function Nu(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,u="Function "+e+"() called with invalid data";n&&(u+=" (via `toFirestore()`)");var a="";return(o||s)&&(a+=" (found",o&&(a+=" in field "+r),s&&(a+=" in document "+i),a+=")"),new L(R.INVALID_ARGUMENT,(u+=". ")+t+a)}function Cu(t,e){return t.some((function(t){return t.isEqual(e)}))}var ju=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Va(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new ku(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.toProto())}},t.prototype.get=function(t){if(this._document){var e=this._document.data().field(xu("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),ku=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(h.c)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(ju);function xu(t,e){return"string"==typeof e?Au(t,e):e instanceof qa?e._delegate._internalPath:e._internalPath}var Ru=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Lu=function(t){function e(e,n,r,i,o,s){var u=this;return(u=t.call(this,e,n,r,i,s)||this)._firestore=e,u._firestoreImpl=e,u.metadata=o,u}return Object(h.c)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Pu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.toProto(),t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data().field(xu("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(ju),Pu=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(h.c)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(Lu),Mu=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Ru(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach((function(r){t.call(e,new Pu(n._firestore,n._userDataWriter,r.key,r,new Ru(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query._converter))}))},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new L(R.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map((function(e){var r=new Pu(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Ru(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query._converter);return e.doc,{type:"added",doc:r,oldIndex:-1,newIndex:n++}}))}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var n=new Pu(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Ru(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query._converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:Fu(e.type),doc:n,oldIndex:i,newIndex:o}}))}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function Fu(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return E()}}function qu(t,e){return t instanceof Lu&&e instanceof Lu?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Mu&&e instanceof Mu&&t._firestore===e._firestore&&Qa(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Vu(t){if(Ft(t)&&0===t.explicitOrderBy.length)throw new L(R.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Uu=function(){};function Bu(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var Ku=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).zc=e,i.Hc=n,i.Jc=r,i.type="where",i}return Object(h.c)(e,t),e.prototype._apply=function(t){var e=fu(t.firestore),n=function(t,e,n,r,i,o,s){var u;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new L(R.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Xu(s,o);for(var a=[],c=0,h=s;c<h.length;c++){var f=h[c];a.push(Yu(r,t,f))}u={arrayValue:{values:a}}}else u=Yu(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Xu(s,o),u=Eu(n,"where",s,"in"===o||"not-in"===o);var l=bt.create(i,o,u);return function(t,e){if(e.g()){var n=Vt(t);if(null!==n&&!n.isEqual(e.field))throw new L(R.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=qt(t);null!==r&&Ju(t,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw i===e.op?new L(R.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new L(R.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(t._query,0,e,t.firestore._databaseId,this.zc,this.Hc,this.Jc);return new Ua(t.firestore,t._converter,function(t,e){var n=t.filters.concat([e]);return new Rt(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(Uu),Gu=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).zc=e,r.Yc=n,r.type="orderBy",r}return Object(h.c)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new L(R.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new L(R.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Ct(e,n);return function(t,e){if(null===qt(t)){var n=Vt(t);null!==n&&Ju(t,n,e.field)}}(t,r),r}(t._query,this.zc,this.Yc);return new Ua(t.firestore,t._converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new Rt(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(Uu),zu=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Xc=n,i.Zc=r,i}return Object(h.c)(e,t),e.prototype._apply=function(t){return new Ua(t.firestore,t._converter,Gt(t._query,this.Xc,this.Zc))},e}(Uu),Qu=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.ta=n,i.ea=r,i}return Object(h.c)(e,t),e.prototype._apply=function(t){var e=Wu(t,this.type,this.ta,this.ea);return new Ua(t.firestore,t._converter,function(t,e){return new Rt(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(Uu),Hu=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.ta=n,i.ea=r,i}return Object(h.c)(e,t),e.prototype._apply=function(t){var e=Wu(t,this.type,this.ta,this.ea);return new Ua(t.firestore,t._converter,function(t,e){return new Rt(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(Uu);function Wu(t,e,n,r){if(n[0]instanceof qa&&(n[0]=n[0]._delegate),n[0]instanceof ju)return function(t,e,n,r,i){if(!r)throw new L(R.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,u=Bt(t);s<u.length;s++){var a=u[s];if(a.field.isKeyField())o.push(it(e,r.key));else{var c=r.field(a.field);if(W(c))throw new L(R.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=a.field.canonicalString();throw new L(R.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new At(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=fu(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new L(R.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var u=[],a=0;a<i.length;a++){var c=i[a];if(s[a].field.isKeyField()){if("string"!=typeof c)throw new L(R.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Ut(t)&&-1!==c.indexOf("/"))throw new L(R.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(M.fromString(c));if(!U.isDocumentKey(h))throw new L(R.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var f=new U(h);u.push(it(e,f))}else{var l=Eu(n,r,c);u.push(l)}}return new At(u,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function Yu(t,e,n){if(n instanceof qa&&(n=n._delegate),"string"==typeof n){if(""===n)throw new L(R.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ut(e)&&-1!==n.indexOf("/"))throw new L(R.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(M.fromString(n));if(!U.isDocumentKey(r))throw new L(R.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return it(t,new U(r))}if(n instanceof Va)return it(t,n._key);throw new L(R.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Ra(n)+".")}function Xu(t,e){if(!Array.isArray(t)||0===t.length)throw new L(R.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new L(R.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Ju(t,e,n){if(!n.isEqual(e))throw new L(R.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var $u=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),X(t)){case 0:return null;case 1:return t.booleanValue;case 2:return z(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Q(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw E()}},t.prototype.convertObject=function(t,e){var n=this,r={};return C(t.fields||{},(function(t,i){r[t]=n.convertValue(i,e)})),r},t.prototype.convertGeoPoint=function(t){return new iu(z(t.latitude),z(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map((function(t){return n.convertValue(t,e)}))},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=Y(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(rt(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=G(t);return new H(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=M.fromString(t);T(Gn(n));var r=new Ta(n.get(1),n.get(3)),i=new U(n.popFirst(5));return r.isEqual(e)||v("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function Zu(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var tc=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(h.c)(e,t),e.prototype.convertBytes=function(t){return new nu(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Va(this.firestore,null,e)},e}($u),ec=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=fu(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=nc(t,this._firestore),i=Zu(r._converter,e,n),o=lu(this._dataReader,"WriteBatch.set",r._key,i,null!==r._converter,n);return this._mutations.push(o.toMutation(r._key,be.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=nc(t,this._firestore);return e instanceof qa&&(e=e._delegate),o="string"==typeof e||e instanceof eu?wu(this._dataReader,"WriteBatch.update",s._key,e,n,r):bu(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,be.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=nc(t,this._firestore);return this._mutations=this._mutations.concat(new Le(e._key,be.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new L(R.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function nc(t,e){if(t instanceof qa&&(t=t._delegate),t.firestore!==e)throw new L(R.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var rc=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(h.c)(e,t),e.prototype.convertBytes=function(t){return new nu(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Va(this.firestore,null,e)},e}($u);function ic(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=La(t,Va);var o=La(t.firestore,Xa),s=fu(o);return e instanceof qa&&(e=e._delegate),sc(o,[("string"==typeof e||e instanceof eu?wu(s,"updateDoc",t._key,e,n,r):bu(s,"updateDoc",t._key,e)).toMutation(t._key,be.exists(!0))])}function oc(t){for(var e,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t instanceof qa&&(t=t._delegate);var s={includeMetadataChanges:!1},u=0;"object"!=typeof i[u]||Wa(i[u])||(s=i[u],u++);var a,c,f,l={includeMetadataChanges:s.includeMetadataChanges};if(Wa(i[u])){var d=i[u];i[u]=null===(e=d.next)||void 0===e?void 0:e.bind(d),i[u+1]=null===(n=d.error)||void 0===n?void 0:n.bind(d),i[u+2]=null===(r=d.complete)||void 0===r?void 0:r.bind(d)}if(t instanceof Va)c=La(t.firestore,Xa),f=Pt(t._key.path),a={next:function(e){i[u]&&i[u](ac(c,t,e))},error:i[u+1],complete:i[u+2]};else{var y=La(t,Ua);c=La(y.firestore,Xa),f=y._query;var p=new rc(c);a={next:function(t){i[u]&&i[u](new Mu(c,p,y,t))},error:i[u+1],complete:i[u+2]},Vu(t._query)}return function(t,e,n,r){var i=this,o=new sa(r),s=new ys(e,o,n);return t.asyncQueue.enqueueAndForget((function(){return Object(h.b)(i,void 0,void 0,(function(){var e;return Object(h.d)(this,(function(n){switch(n.label){case 0:return e=hs,[4,ma(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}}))}))})),function(){o.Xo(),t.asyncQueue.enqueueAndForget((function(){return Object(h.b)(i,void 0,void 0,(function(){var e;return Object(h.d)(this,(function(n){switch(n.label){case 0:return e=fs,[4,ma(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}}))}))}))}}(Ja(c),f,l,a)}function sc(t,e){return function(t,e){var n=this,r=new dr;return t.asyncQueue.enqueueAndForget((function(){return Object(h.b)(n,void 0,void 0,(function(){var n;return Object(h.d)(this,(function(i){switch(i.label){case 0:return n=As,[4,ga(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(Ja(t),e)}function ac(t,e,n){var r=n.docs.get(e._key),i=new rc(t);return new Lu(t,i,e._key,r,new Ru(n.hasPendingWrites,n.fromCache),e._converter)}var uc=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return Object(h.c)(e,t),e.prototype.get=function(e){var n=this,r=nc(e,this._firestore),i=new rc(this._firestore);return t.prototype.get.call(this,e).then((function(t){return new Lu(n._firestore,i,r._key,t._document,new Ru(!1,!1),r._converter)}))},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=fu(t)}return t.prototype.get=function(t){var e=this,n=nc(t,this._firestore),r=new tc(this._firestore);return this._transaction.lookup([n._key]).then((function(t){if(!t||1!==t.length)return E();var i=t[0];if(i instanceof ft)return new ju(e._firestore,r,n._key,null,n._converter);if(i instanceof ht)return new ju(e._firestore,r,i.key,i,n._converter);throw E()}))},t.prototype.set=function(t,e,n){var r=nc(t,this._firestore),i=Zu(r._converter,e,n),o=lu(this._dataReader,"Transaction.set",r._key,i,null!==r._converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=nc(t,this._firestore);return e instanceof qa&&(e=e._delegate),o="string"==typeof e||e instanceof eu?wu(this._dataReader,"Transaction.update",s._key,e,n,r):bu(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=nc(t,this._firestore);return this._transaction.delete(e._key),this},t}());function cc(){if("undefined"==typeof Uint8Array)throw new L(R.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function hc(){if("undefined"==typeof atob)throw new L(R.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var fc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(h.c)(e,t),e.fromBase64String=function(t){return hc(),new e(nu.fromBase64String(t))},e.fromUint8Array=function(t){return cc(),new e(nu.fromUint8Array(t))},e.prototype.toBase64=function(){return hc(),this._delegate.toBase64()},e.prototype.toUint8Array=function(){return cc(),this._delegate.toUint8Array()},e.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},e.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},e}(qa),lc=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){tu(t=La(t,Xa));var n=Ja(t),r=t._freezeSettings(),i=new oa;return Za(n,i,new ra(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){tu(t=La(t,Xa));var e=Ja(t),n=t._freezeSettings(),r=new oa;return Za(e,r,new ia(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new L(R.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new dr;return t._queue.enqueueAndForgetEvenWhileRestricted((function(){return Object(h.b)(e,void 0,void 0,(function(){var e;return Object(h.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return Object(h.b)(this,void 0,void 0,(function(){var e;return Object(h.d)(this,(function(n){switch(n.label){case 0:return vr.At()?(e=t+"main",[4,vr.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(Ai(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}}))}))})),n.promise}(t._delegate)},t}(),dc=function(t){function e(e,n,r){var i=this;return(i=t.call(this,n)||this).na=r,i.INTERNAL={delete:function(){return i.terminate()}},e instanceof Ta||(i.sa=e),i}return Object(h.c)(e,t),Object.defineProperty(e.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),e.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this._delegate._getSettings()),t)).merge,this._delegate._setSettings(t)},e.prototype.useEmulator=function(t,e){!function(t,e,n){var r=(t=La(t,Fa))._getSettings();"firestore.googleapis.com"!==r.host&&r.host!==e&&m("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},r),{host:e+":"+n,ssl:!1}))}(this._delegate,t,e)},e.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return Object(h.b)(e,void 0,void 0,(function(){var e,n;return Object(h.d)(this,(function(r){switch(r.label){case 0:return[4,pa(t)];case 1:return e=r.sent(),[4,va(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=I(t);return e.Qr.delete(0),ko(e)}(n))]}}))}))}))}(Ja(La(this._delegate,Xa)))},e.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return Object(h.b)(e,void 0,void 0,(function(){var e,n;return Object(h.d)(this,(function(r){switch(r.label){case 0:return[4,pa(t)];case 1:return e=r.sent(),[4,va(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return Object(h.b)(this,void 0,void 0,(function(){var e;return Object(h.d)(this,(function(n){switch(n.label){case 0:return(e=I(t)).Qr.add(0),[4,xo(e)];case 1:return n.sent(),e.jr.set("Offline"),[2]}}))}))}(n))]}}))}))}))}(Ja(La(this._delegate,Xa)))},e.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&ja("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.na.enableMultiTabIndexedDbPersistence(this):this.na.enableIndexedDbPersistence(this,n)},e.prototype.clearPersistence=function(){return this.na.clearIndexedDbPersistence(this)},e.prototype.terminate=function(){return this.sa&&(this.sa._removeServiceInstance("firestore"),this.sa._removeServiceInstance("firestore-exp")),this._delegate._delete()},e.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new dr;return t.asyncQueue.enqueueAndForget((function(){return Object(h.b)(e,void 0,void 0,(function(){var e;return Object(h.d)(this,(function(r){switch(r.label){case 0:return e=Rs,[4,ga(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}}))}))})),n.promise}(Ja(La(this._delegate,Xa)))},e.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new sa(e);return t.asyncQueue.enqueueAndForget((function(){return Object(h.b)(n,void 0,void 0,(function(){var e;return Object(h.d)(this,(function(n){switch(n.label){case 0:return e=function(t,e){I(t).Zr.add(e),e.next()},[4,ma(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))})),function(){r.Xo(),t.asyncQueue.enqueueAndForget((function(){return Object(h.b)(n,void 0,void 0,(function(){var e;return Object(h.d)(this,(function(n){switch(n.label){case 0:return e=function(t,e){I(t).Zr.delete(e)},[4,ma(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))}))}}(Ja(t=La(t,Xa)),Wa(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(e.prototype,"app",{get:function(){if(!this.sa)throw new L(R.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.sa},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new Ac(this,Ka(this._delegate,t))}catch(t){throw wc(t,"collection()","Firestore.collection()")}},e.prototype.doc=function(t){try{return new bc(this,Ga(this._delegate,t))}catch(t){throw wc(t,"doc()","Firestore.doc()")}},e.prototype.collectionGroup=function(t){try{return new Oc(this,function(t,e){if(t=La(t,Fa),Na("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new L(R.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Ua(t,null,function(t){return new Rt(M.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw wc(t,"collectionGroup()","Firestore.collectionGroup()")}},e.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new dr;return t.asyncQueue.enqueueAndForget((function(){return Object(h.b)(n,void 0,void 0,(function(){var n;return Object(h.d)(this,(function(i){switch(i.label){case 0:return[4,function(t){return da(t).then((function(t){return t.datastore}))}(t)];case 1:return n=i.sent(),new ua(t.asyncQueue,n,e,r).run(),[2]}}))}))})),r.promise}(Ja(t),(function(n){return e(new uc(t,n))}))}(this._delegate,(function(n){return t(new vc(e,n))}))},e.prototype.batch=function(){var t=this;return Ja(this._delegate),new gc(new ec(this._delegate,(function(e){return sc(t._delegate,e)})))},e.prototype.loadBundle=function(t){throw new L(R.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},e.prototype.namedQuery=function(t){throw new L(R.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},e}(qa),pc=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(h.c)(e,t),e.prototype.convertBytes=function(t){return new fc(new nu(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return bc.ia(e,this.firestore,null)},e}($u);function yc(t){var e;e=t,l.setLogLevel(e)}var vc=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this)._firestore=e,r._userDataWriter=new pc(e),r}return Object(h.c)(e,t),e.prototype.get=function(t){var e=this,n=Nc(t);return this._delegate.get(n).then((function(t){return new Ic(e._firestore,new Lu(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n._converter))}))},e.prototype.set=function(t,e,n){var r=Nc(t);return n?(Ca("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},e.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Nc(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(h.f)([s,e,n],i)),this},e.prototype.delete=function(t){var e=Nc(t);return this._delegate.delete(e),this},e}(qa),gc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(h.c)(e,t),e.prototype.set=function(t,e,n){var r=Nc(t);return n?(Ca("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},e.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Nc(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(h.f)([s,e,n],i)),this},e.prototype.delete=function(t){var e=Nc(t);return this._delegate.delete(e),this},e.prototype.commit=function(){return this._delegate.commit()},e}(qa),mc=function(t){function e(e,n,r){var i=this;return(i=t.call(this,r)||this)._firestore=e,i._userDataWriter=n,i}return Object(h.c)(e,t),e.prototype.fromFirestore=function(t,e){var n=new Pu(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new _c(this._firestore,n),null!=e?e:{})},e.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},e.ra=function(t,n){var r=e.oa,i=r.get(t);i||(i=new WeakMap,r.set(t,i));var o=i.get(n);return o||(o=new e(t,new pc(t),n),i.set(n,o)),o},e}(qa);mc.oa=new WeakMap;var bc=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).firestore=e,r._userDataWriter=new pc(e),r}return Object(h.c)(e,t),e.ca=function(t,n,r){if(t.length%2!=0)throw new L(R.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new e(n,new Va(n._delegate,r,new U(t)))},e.ia=function(t,n,r){return new e(n,new Va(n._delegate,r,t))},Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new Ac(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new Ac(this.firestore,Ka(this._delegate,t))}catch(t){throw wc(t,"collection()","DocumentReference.collection()")}},e.prototype.isEqual=function(t){return t instanceof qa&&(t=t._delegate),t instanceof Va&&za(this._delegate,t)},e.prototype.set=function(t,e){e=Ca("DocumentReference.set",e);try{return function(t,e,n){t=La(t,Va);var r=La(t.firestore,Xa),i=Zu(t._converter,e,n);return sc(r,[lu(fu(r),"setDoc",t._key,i,null!==t._converter,n).toMutation(t._key,be.none())])}(this._delegate,t,e)}catch(t){throw wc(t,"setDoc()","DocumentReference.set()")}},e.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?ic(this._delegate,t):ic.apply(void 0,Object(h.f)([this._delegate,t,e],n))}catch(t){throw wc(t,"updateDoc()","DocumentReference.update()")}},e.prototype.delete=function(){return sc(La((t=this._delegate).firestore,Xa),[new Le(t._key,be.none())]);var t},e.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Ec(e),i=Tc(e,(function(e){return new Ic(t.firestore,new Lu(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate._converter))}));return oc(this._delegate,r,i)},e.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=La(t,Va);var e=La(t.firestore,Xa),n=Ja(e),r=new rc(e);return function(t,e){var n=this,r=new dr;return t.asyncQueue.enqueueAndForget((function(){return Object(h.b)(n,void 0,void 0,(function(){var n;return Object(h.d)(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(h.b)(this,void 0,void 0,(function(){var r,i;return Object(h.d)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=I(t);return n.persistence.runTransaction("read document","readonly",(function(t){return n.Kn.In(t,e)}))}(t,e)];case 1:return(i=o.sent())instanceof ht?n.resolve(i):i instanceof ft?n.resolve(null):n.reject(new L(R.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=is(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}}))}))},[4,ya(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t._key).then((function(n){return new Lu(e,r,t._key,n,new Ru(n instanceof ht&&n.hasLocalMutations,!0),t._converter)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=La(t,Va);var e=La(t.firestore,Xa);return ba(Ja(e),t._key,{source:"server"}).then((function(n){return ac(e,t,n)}))}(this._delegate):function(t){t=La(t,Va);var e=La(t.firestore,Xa);return ba(Ja(e),t._key).then((function(n){return ac(e,t,n)}))}(this._delegate)).then((function(t){return new Ic(e.firestore,new Lu(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate._converter))}))},e.prototype.withConverter=function(t){return new e(this.firestore,t?this._delegate.withConverter(mc.ra(this.firestore,t)):this._delegate.withConverter(null))},e}(qa);function wc(t,e,n){return t.message=t.message.replace(e,n),t}function Ec(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!Wa(r))return r}return{}}function Tc(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=Wa(t[0])?t[0]:Wa(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var Ic=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this)._firestore=e,r}return Object(h.c)(e,t),Object.defineProperty(e.prototype,"ref",{get:function(){return new bc(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),e.prototype.data=function(t){return this._delegate.data(t)},e.prototype.get=function(t,e){return this._delegate.get(t,e)},e.prototype.isEqual=function(t){return qu(this._delegate,t._delegate)},e}(qa),_c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(h.c)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(Ic),Oc=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).firestore=e,r._userDataWriter=new pc(e),r}return Object(h.c)(e,t),e.prototype.where=function(t,n,r){try{return new e(this.firestore,Bu(this._delegate,function(t,e,n){var r=e,i=xu("where",t);return new Ku(i,r,n)}(t,n,r)))}catch(t){throw wc(t,/(orderBy|where)\(\)/,"Query.$1()")}},e.prototype.orderBy=function(t,n){try{return new e(this.firestore,Bu(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=xu("orderBy",t);return new Gu(r,n)}(t,n)))}catch(t){throw wc(t,/(orderBy|where)\(\)/,"Query.$1()")}},e.prototype.limit=function(t){try{return new e(this.firestore,Bu(this._delegate,function(t){return Pa("limit",t),new zu("limit",t,"F")}(t)))}catch(t){throw wc(t,"limit()","Query.limit()")}},e.prototype.limitToLast=function(t){try{return new e(this.firestore,Bu(this._delegate,function(t){return Pa("limitToLast",t),new zu("limitToLast",t,"L")}(t)))}catch(t){throw wc(t,"limitToLast()","Query.limitToLast()")}},e.prototype.startAt=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,Bu(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Qu("startAt",t,!0)}.apply(void 0,t)))}catch(t){throw wc(t,"startAt()","Query.startAt()")}},e.prototype.startAfter=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,Bu(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Qu("startAfter",t,!1)}.apply(void 0,t)))}catch(t){throw wc(t,"startAfter()","Query.startAfter()")}},e.prototype.endBefore=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,Bu(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Hu("endBefore",t,!0)}.apply(void 0,t)))}catch(t){throw wc(t,"endBefore()","Query.endBefore()")}},e.prototype.endAt=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,Bu(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Hu("endAt",t,!1)}.apply(void 0,t)))}catch(t){throw wc(t,"endAt()","Query.endAt()")}},e.prototype.isEqual=function(t){return Qa(this._delegate,t._delegate)},e.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=La(t,Ua);var e=La(t.firestore,Xa),n=Ja(e),r=new rc(e);return function(t,e){var n=this,r=new dr;return t.asyncQueue.enqueueAndForget((function(){return Object(h.b)(n,void 0,void 0,(function(){var n;return Object(h.d)(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(h.b)(this,void 0,void 0,(function(){var r,i,o,s,u;return Object(h.d)(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,Ki(t,e,!0)];case 1:return u=a.sent(),r=new Es(e,u.jn),i=r.Io(u.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=a.sent(),u=is(s,"Failed to execute query '"+e+" against cache"),n.reject(u),[3,3];case 3:return[2]}}))}))},[4,ya(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t._query).then((function(n){return new Mu(e,r,t,n)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=La(t,Ua);var e=La(t.firestore,Xa),n=Ja(e),r=new rc(e);return wa(n,t._query,{source:"server"}).then((function(n){return new Mu(e,r,t,n)}))}(this._delegate):function(t){t=La(t,Ua);var e=La(t.firestore,Xa),n=Ja(e),r=new rc(e);return Vu(t._query),wa(n,t._query).then((function(n){return new Mu(e,r,t,n)}))}(this._delegate)).then((function(t){return new Dc(e.firestore,new Mu(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))}))},e.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Ec(e),i=Tc(e,(function(e){return new Dc(t.firestore,new Mu(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))}));return oc(this._delegate,r,i)},e.prototype.withConverter=function(t){return new e(this.firestore,t?this._delegate.withConverter(mc.ra(this.firestore,t)):this._delegate.withConverter(null))},e}(qa),Sc=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this)._firestore=e,r}return Object(h.c)(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"doc",{get:function(){return new _c(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),e}(qa),Dc=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this)._firestore=e,r}return Object(h.c)(e,t),Object.defineProperty(e.prototype,"query",{get:function(){return new Oc(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map((function(e){return new _c(t._firestore,e)}))},enumerable:!1,configurable:!0}),e.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map((function(t){return new Sc(e._firestore,t)}))},e.prototype.forEach=function(t,e){var n=this;this._delegate.forEach((function(r){t.call(e,new _c(n._firestore,r))}))},e.prototype.isEqual=function(t){return qu(this._delegate,t._delegate)},e}(qa),Ac=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return Object(h.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new bc(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new bc(this.firestore,void 0===t?Ga(this._delegate):Ga(this._delegate,t))}catch(t){throw wc(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=La(t.firestore,Xa),r=Ga(t),i=Zu(t._converter,e);return sc(n,[lu(fu(t.firestore),"addDoc",r._key,i,null!==t._converter,{}).toMutation(r._key,be.exists(!1))]).then((function(){return r}))}(this._delegate,t).then((function(t){return new bc(e.firestore,t)}))},e.prototype.isEqual=function(t){return za(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,t?this._delegate.withConverter(mc.ra(this.firestore,t)):this._delegate.withConverter(null))},e}(Oc);function Nc(t){return t instanceof qa&&(t=t._delegate),La(t,Va)}var Cc=function(t){function e(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.call(this,new(eu.bind.apply(eu,Object(h.f)([void 0],e))))||this}return Object(h.c)(e,t),e.documentId=function(){return new e(V.keyField().canonicalString())},e.prototype.isEqual=function(t){return t instanceof qa&&(t=t._delegate),t instanceof eu&&this._delegate._internalPath.isEqual(t._internalPath)},e}(qa),jc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(h.c)(e,t),e.serverTimestamp=function(){var t=new yu("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new e(t)},e.delete=function(){var t=new du("deleteField");return t._methodName="FieldValue.delete",new e(t)},e.arrayUnion=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new vu("arrayUnion",t)}.apply(void 0,t);return r._methodName="FieldValue.arrayUnion",new e(r)},e.arrayRemove=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new gu("arrayRemove",t)}.apply(void 0,t);return r._methodName="FieldValue.arrayRemove",new e(r)},e.increment=function(t){var n=function(t){return new mu("increment",t)}(t);return n._methodName="FieldValue.increment",new e(n)},e.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},e}(qa)}).call(this,n(189))},482:function(t,e,n){"use strict";n.r(e);var r,o=n(5),c=(n(140),n(46),n(433),n(464)),h=n(115),f={Firestore:c.f,GeoPoint:c.r,Timestamp:c.d,Blob:c.e,Transaction:c.n,WriteBatch:c.a,DocumentReference:c.b,DocumentSnapshot:c.j,Query:c.l,QueryDocumentSnapshot:c.q,QuerySnapshot:c.p,CollectionReference:c.m,FieldPath:c.o,FieldValue:c.k,setLogLevel:c.i,CACHE_SIZE_UNLIMITED:c.g};(function(t,e){t.INTERNAL.registerComponent(new h.a("firestore",(function(t){return function(t,s){return new c.f(t,new c.c(t,s),new c.h)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},f)))})(r=o.a),r.registerVersion("@firebase/firestore","2.2.1")}}]);